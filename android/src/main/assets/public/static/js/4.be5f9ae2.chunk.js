(self.webpackChunkmaidaan=self.webpackChunkmaidaan||[]).push([[4],{24100:t=>{t.exports=function(t){var n=[];return t.replace(r,(function(t,r,s){var a=r.toLowerCase();for(s=function(t){var e=t.match(i);return e?e.map(Number):[]}(s),"m"==a&&s.length>2&&(n.push([r].concat(s.splice(0,2))),a="l",r="m"==r?"l":"L");;){if(s.length==e[a])return s.unshift(r),n.push(s);if(s.length<e[a])throw new Error("malformed path data");n.push([r].concat(s.splice(0,e[a])))}})),n};var e={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},r=/([astvzqmhlc])([^astvzqmhlc]*)/gi;var i=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi},31049:(t,e,r)=>{"use strict";var i=r(91478);class n{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this._cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this._cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this._cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:r,clientHeight:i}=this._resizeTo;t=r,e=i}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this._cancelResize(),this._cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}n.extension=i.Ag.Application;var s=r(96493),a=r(41456);class o{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,s.d.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?a.R.shared:new a.R,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}o.extension=i.Ag.Application,i.XO.add(n),i.XO.add(o)},60769:(t,e,r)=>{"use strict";var i=r(91478);class n{constructor(t){this._renderer=t}push(t,e,r){this._renderer.renderPipes.batch.break(r),r.add({renderPipeId:"filter",canBundle:!1,action:"pushFilter",container:e,filterEffect:t})}pop(t,e,r){this._renderer.renderPipes.batch.break(r),r.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}execute(t){"pushFilter"===t.action?this._renderer.filter.push(t):"popFilter"===t.action&&this._renderer.filter.pop()}destroy(){this._renderer=null}}n.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"filter"};var s=r(33596),a=r(31960),o=r(2590),l=r(69801),h=r(5222),u=r(7663),c=r(3202),d=r(16650),f=r(66373),p=r(88263);const g=new s.u;function m(t,e){e.clear(),x(t,e),e.isValid||e.set(0,0,0,0);const r=t.renderGroup||t.parentRenderGroup;return e.applyMatrix(r.worldTransform),e}function x(t,e){if(7!==t.localDisplayStatus||!t.measurable)return;const r=!!t.effects.length;let i=e;if((t.renderGroup||r)&&(i=p.o.get().clear()),t.boundsArea)e.addRect(t.boundsArea,t.worldTransform);else{if(t.renderPipeId){const e=t.bounds;i.addFrame(e.minX,e.minY,e.maxX,e.maxY,t.groupTransform)}const e=t.children;for(let t=0;t<e.length;t++)x(e[t],i)}if(r){let r=!1;const n=t.renderGroup||t.parentRenderGroup;for(let e=0;e<t.effects.length;e++)t.effects[e].addBounds&&(r||(r=!0,i.applyMatrix(n.worldTransform)),t.effects[e].addBounds(i,!0));r&&(i.applyMatrix(n.worldTransform.copyTo(g).invert()),e.addBounds(i,t.relativeGroupTransform)),e.addBounds(i),p.o.return(i)}else t.renderGroup&&(e.addBounds(i,t.relativeGroupTransform),p.o.return(i))}var _=r(60279);const y=new l.V({attributes:{aPosition:{buffer:new Float32Array([0,0,1,0,1,1,0,1]),format:"float32x2",stride:8,offset:0}},indexBuffer:new Uint32Array([0,1,2,0,2,3])});class v{constructor(t){this._filterStackIndex=0,this._filterStack=[],this._filterGlobalUniforms=new h.k({uInputSize:{value:new Float32Array(4),type:"vec4<f32>"},uInputPixel:{value:new Float32Array(4),type:"vec4<f32>"},uInputClamp:{value:new Float32Array(4),type:"vec4<f32>"},uOutputFrame:{value:new Float32Array(4),type:"vec4<f32>"},uGlobalFrame:{value:new Float32Array(4),type:"vec4<f32>"},uOutputTexture:{value:new Float32Array(4),type:"vec4<f32>"}}),this._globalFilterBindGroup=new o.T({}),this.renderer=t}get activeBackTexture(){var t;return null===(t=this._activeFilterData)||void 0===t?void 0:t.backTexture}push(t){const e=this.renderer,r=t.filterEffect.filters;this._filterStack[this._filterStackIndex]||(this._filterStack[this._filterStackIndex]=this._getFilterData());const i=this._filterStack[this._filterStackIndex];if(this._filterStackIndex++,0===r.length)return void(i.skip=!0);const n=i.bounds;if(t.renderables?function(t,e){e.clear();const r=e.matrix;for(let i=0;i<t.length;i++){const r=t[i];r.globalDisplayStatus<7||(e.matrix=r.worldTransform,e.addBounds(r.bounds))}e.matrix=r}(t.renderables,n):t.filterEffect.filterArea?(n.clear(),n.addRect(t.filterEffect.filterArea),n.applyMatrix(t.container.worldTransform)):m(t.container,n),t.container){const e=(t.container.renderGroup||t.container.parentRenderGroup).cacheToLocalTransform;e&&n.applyMatrix(e)}const s=e.renderTarget.renderTarget.colorTexture.source;let a=1/0,o=0,l=!0,h=!1,u=!1,d=!0;for(let c=0;c<r.length;c++){var f,p;const t=r[c];a=Math.min(a,"inherit"===t.resolution?s._resolution:t.resolution),o+=t.padding,"off"===t.antialias?l=!1:"inherit"===t.antialias&&l&&(l=s.antialias),t.clipToViewport||(d=!1);if(!!!(t.compatibleRenderers&e.type)){u=!1;break}if(t.blendRequired&&null!==(f=null===(p=e.backBuffer)||void 0===p?void 0:p.useBackBuffer)&&void 0!==f&&!f){(0,_.R)("Blend filter requires backBuffer on WebGL renderer to be enabled. Set `useBackBuffer: true` in the renderer options."),u=!1;break}u=t.enabled||u,h||(h=t.blendRequired)}if(u){if(d){const t=e.renderTarget.rootViewPort,r=e.renderTarget.renderTarget.resolution;n.fitBounds(0,t.width/r,0,t.height/r)}n.scale(a).ceil().scale(1/a).pad(0|o),n.isPositive?(i.skip=!1,i.bounds=n,i.blendRequired=h,i.container=t.container,i.filterEffect=t.filterEffect,i.previousRenderSurface=e.renderTarget.renderSurface,i.inputTexture=c.W.getOptimalTexture(n.width,n.height,a,l),e.renderTarget.bind(i.inputTexture,!0),e.globalUniforms.push({offset:n})):i.skip=!0}else i.skip=!0}pop(){const t=this.renderer;this._filterStackIndex--;const e=this._filterStack[this._filterStackIndex];if(e.skip)return;this._activeFilterData=e;const r=e.inputTexture,i=e.bounds;let n=u.g.EMPTY;if(t.renderTarget.finishRenderPass(),e.blendRequired){const r=this._filterStackIndex>0?this._filterStack[this._filterStackIndex-1].bounds:null,s=t.renderTarget.getRenderTarget(e.previousRenderSurface);n=this.getBackTexture(s,i,r)}e.backTexture=n;const s=e.filterEffect.filters;if(this._globalFilterBindGroup.setResource(r.source.style,2),this._globalFilterBindGroup.setResource(n.source,3),t.globalUniforms.pop(),1===s.length)s[0].apply(this,r,e.previousRenderSurface,!1),c.W.returnTexture(r);else{let t=e.inputTexture,r=c.W.getOptimalTexture(i.width,i.height,t.source._resolution,!1),n=0;for(n=0;n<s.length-1;++n){s[n].apply(this,t,r,!0);const e=t;t=r,r=e}s[n].apply(this,t,e.previousRenderSurface,!1),c.W.returnTexture(t),c.W.returnTexture(r)}e.blendRequired&&c.W.returnTexture(n)}getBackTexture(t,e,r){const i=t.colorTexture.source._resolution,n=c.W.getOptimalTexture(e.width,e.height,i,!1);let s=e.minX,a=e.minY;r&&(s-=r.minX,a-=r.minY),s=Math.floor(s*i),a=Math.floor(a*i);const o=Math.ceil(e.width*i),l=Math.ceil(e.height*i);return this.renderer.renderTarget.copyToTexture(t,n,{x:s,y:a},{width:o,height:l},{x:0,y:0}),n}applyFilter(t,e,r,i){const n=this.renderer,s=this._filterStack[this._filterStackIndex],o=s.bounds,l=a.b.shared,h=s.previousRenderSurface===r;let c=this.renderer.renderTarget.rootRenderTarget.colorTexture.source._resolution,f=this._filterStackIndex-1;for(;f>0&&this._filterStack[f].skip;)--f;f>0&&(c=this._filterStack[f].inputTexture.source._resolution);const p=this._filterGlobalUniforms,g=p.uniforms,m=g.uOutputFrame,x=g.uInputSize,_=g.uInputPixel,v=g.uInputClamp,b=g.uGlobalFrame,S=g.uOutputTexture;if(h){let t=this._filterStackIndex;for(;t>0;){t--;const e=this._filterStack[this._filterStackIndex-1];if(!e.skip){l.x=e.bounds.minX,l.y=e.bounds.minY;break}}m[0]=o.minX-l.x,m[1]=o.minY-l.y}else m[0]=0,m[1]=0;m[2]=e.frame.width,m[3]=e.frame.height,x[0]=e.source.width,x[1]=e.source.height,x[2]=1/x[0],x[3]=1/x[1],_[0]=e.source.pixelWidth,_[1]=e.source.pixelHeight,_[2]=1/_[0],_[3]=1/_[1],v[0]=.5*_[2],v[1]=.5*_[3],v[2]=e.frame.width*x[2]-.5*_[2],v[3]=e.frame.height*x[3]-.5*_[3];const w=this.renderer.renderTarget.rootRenderTarget.colorTexture;b[0]=l.x*c,b[1]=l.y*c,b[2]=w.source.width*c,b[3]=w.source.height*c;const T=this.renderer.renderTarget.getRenderTarget(r);if(n.renderTarget.bind(r,!!i),r instanceof u.g?(S[0]=r.frame.width,S[1]=r.frame.height):(S[0]=T.width,S[1]=T.height),S[2]=T.isRoot?-1:1,p.update(),n.renderPipes.uniformBatch){const t=n.renderPipes.uniformBatch.getUboResource(p);this._globalFilterBindGroup.setResource(t,0)}else this._globalFilterBindGroup.setResource(p,0);this._globalFilterBindGroup.setResource(e.source,1),this._globalFilterBindGroup.setResource(e.source.style,2),t.groups[0]=this._globalFilterBindGroup,n.encoder.draw({geometry:y,shader:t,state:t._state,topology:"triangle-list"}),n.type===d.W.WEBGL&&n.renderTarget.finishRenderPass()}_getFilterData(){return{skip:!1,inputTexture:null,bounds:new f.c,container:null,filterEffect:null,blendRequired:!1,previousRenderSurface:null}}calculateSpriteMatrix(t,e){const r=this._activeFilterData,i=t.set(r.inputTexture._source.width,0,0,r.inputTexture._source.height,r.bounds.minX,r.bounds.minY),n=e.worldTransform.copyTo(s.u.shared),a=e.renderGroup||e.parentRenderGroup;return a&&a.cacheToLocalTransform&&n.prepend(a.cacheToLocalTransform),n.invert(),i.prepend(n),i.scale(1/e.texture.frame.width,1/e.texture.frame.height),i.translate(e.anchor.x,e.anchor.y),i}}v.extension={type:[i.Ag.WebGLSystem,i.Ag.WebGPUSystem],name:"filter"},i.XO.add(v),i.XO.add(n)},94719:(t,e,r)=>{"use strict";r.d(e,{a:()=>o});var i=r(10087);const n=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function s(t){let e="";for(let r=0;r<t;++r)r>0&&(e+="\nelse "),r<t-1&&(e+="if(test == ".concat(r,".0){}"));return e}let a=null;function o(){var t;if(a)return a;const e=(0,i.W)();return a=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),a=function(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const r=e.createShader(e.FRAGMENT_SHADER);try{for(;;){const i=n.replace(/%forloop%/gi,s(t));if(e.shaderSource(r,i),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))break;t=t/2|0}}finally{e.deleteShader(r)}return t}(a,e),null===(t=e.getExtension("WEBGL_lose_context"))||void 0===t||t.loseContext(),a}},89569:(t,e,r)=>{"use strict";r.d(e,{I:()=>C,v:()=>P});var i=r(89379),n=r(95920),s=r(47699),a=r(60279);function o(t,e,r){if(t)for(const i in t){const n=e[i.toLocaleLowerCase()];if(n){let e=t[i];"header"===i&&(e=e.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),r&&n.push("//----".concat(r,"----//")),n.push(e)}else(0,a.R)("".concat(i," placement hook does not exist in shader"))}}const l=/\{\{(.*?)\}\}/g;function h(t){var e,r;const i={};return(null!==(e=null===(r=t.match(l))||void 0===r?void 0:r.map((t=>t.replace(/[{()}]/g,""))))&&void 0!==e?e:[]).forEach((t=>{i[t]=[]})),i}function u(t,e){let r;const i=/@in\s+([^;]+);/g;for(;null!==(r=i.exec(t));)e.push(r[1])}function c(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=[];u(e,i),t.forEach((t=>{t.header&&u(t.header,i)}));const n=i;r&&n.sort();const s=n.map(((t,e)=>"       @location(".concat(e,") ").concat(t,","))).join("\n");let a=e.replace(/@in\s+[^;]+;\s*/g,"");return a=a.replace("{{in}}","\n".concat(s,"\n")),a}function d(t,e){let r;const i=/@out\s+([^;]+);/g;for(;null!==(r=i.exec(t));)e.push(r[1])}function f(t,e){let r=t;for(const i in e){const t=e[i];r=t.join("\n").length?r.replace("{{".concat(i,"}}"),"//-----".concat(i," START-----//\n").concat(t.join("\n"),"\n//----").concat(i," FINISH----//")):r.replace("{{".concat(i,"}}"),"")}return r}const p=Object.create(null),g=new Map;let m=0;function x(t){let{template:e,bits:r}=t;const i=_(e,r);if(p[i])return p[i];const{vertex:n,fragment:s}=function(t,e){const r=e.map((t=>t.vertex)).filter((t=>!!t)),i=e.map((t=>t.fragment)).filter((t=>!!t));let n=c(r,t.vertex,!0);n=function(t,e){const r=[];d(e,r),t.forEach((t=>{t.header&&d(t.header,r)}));let i=0;const n=r.sort().map((t=>t.indexOf("builtin")>-1?t:"@location(".concat(i++,") ").concat(t))).join(",\n"),s=r.sort().map((t=>"       var ".concat(t.replace(/@.*?\s+/g,""),";"))).join("\n"),a="return VSOutput(\n            ".concat(r.sort().map((t=>" ".concat(function(t){const e=/\b(\w+)\s*:/g.exec(t);return e?e[1]:""}(t)))).join(",\n"),");");let o=e.replace(/@out\s+[^;]+;\s*/g,"");return o=o.replace("{{struct}}","\n".concat(n,"\n")),o=o.replace("{{start}}","\n".concat(s,"\n")),o=o.replace("{{return}}","\n".concat(a,"\n")),o}(r,n);const s=c(i,t.fragment,!0);return{vertex:n,fragment:s}}(e,r);return p[i]=y(n,s,r),p[i]}function _(t,e){return e.map((t=>(g.has(t)||g.set(t,m++),g.get(t)))).sort(((t,e)=>t-e)).join("-")+t.vertex+t.fragment}function y(t,e,r){const i=h(t),n=h(e);return r.forEach((t=>{o(t.vertex,i,t.name),o(t.fragment,n,t.name)})),{vertex:f(t,i),fragment:f(e,n)}}const v="\n    @in aPosition: vec2<f32>;\n    @in aUV: vec2<f32>;\n\n    @out @builtin(position) vPosition: vec4<f32>;\n    @out vUV : vec2<f32>;\n    @out vColor : vec4<f32>;\n\n    {{header}}\n\n    struct VSOutput {\n        {{struct}}\n    };\n\n    @vertex\n    fn main( {{in}} ) -> VSOutput {\n\n        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;\n        var modelMatrix = mat3x3<f32>(\n            1.0, 0.0, 0.0,\n            0.0, 1.0, 0.0,\n            0.0, 0.0, 1.0\n          );\n        var position = aPosition;\n        var uv = aUV;\n\n        {{start}}\n        \n        vColor = vec4<f32>(1., 1., 1., 1.);\n\n        {{main}}\n\n        vUV = uv;\n\n        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;\n\n        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);\n       \n        vColor *= globalUniforms.uWorldColorAlpha;\n\n        {{end}}\n\n        {{return}}\n    };\n",b="\n    @in vUV : vec2<f32>;\n    @in vColor : vec4<f32>;\n   \n    {{header}}\n\n    @fragment\n    fn main(\n        {{in}}\n      ) -> @location(0) vec4<f32> {\n        \n        {{start}}\n\n        var outColor:vec4<f32>;\n      \n        {{main}}\n        \n        var finalColor:vec4<f32> = outColor * vColor;\n\n        {{end}}\n\n        return finalColor;\n      };\n",S="\n    in vec2 aPosition;\n    in vec2 aUV;\n\n    out vec4 vColor;\n    out vec2 vUV;\n\n    {{header}}\n\n    void main(void){\n\n        mat3 worldTransformMatrix = uWorldTransformMatrix;\n        mat3 modelMatrix = mat3(\n            1.0, 0.0, 0.0,\n            0.0, 1.0, 0.0,\n            0.0, 0.0, 1.0\n          );\n        vec2 position = aPosition;\n        vec2 uv = aUV;\n        \n        {{start}}\n        \n        vColor = vec4(1.);\n        \n        {{main}}\n        \n        vUV = uv;\n        \n        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;\n\n        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n\n        vColor *= uWorldColorAlpha;\n\n        {{end}}\n    }\n",w="\n   \n    in vec4 vColor;\n    in vec2 vUV;\n\n    out vec4 finalColor;\n\n    {{header}}\n\n    void main(void) {\n        \n        {{start}}\n\n        vec4 outColor;\n      \n        {{main}}\n        \n        finalColor = outColor * vColor;\n        \n        {{end}}\n    }\n",T={name:"global-uniforms-bit",vertex:{header:"\n        struct GlobalUniforms {\n            uProjectionMatrix:mat3x3<f32>,\n            uWorldTransformMatrix:mat3x3<f32>,\n            uWorldColorAlpha: vec4<f32>,\n            uResolution: vec2<f32>,\n        }\n\n        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;\n        "}},M={name:"global-uniforms-bit",vertex:{header:"\n          uniform mat3 uProjectionMatrix;\n          uniform mat3 uWorldTransformMatrix;\n          uniform vec4 uWorldColorAlpha;\n          uniform vec2 uResolution;\n        "}};function P(t){let{bits:e,name:r}=t;const i=x({template:{fragment:b,vertex:v},bits:[T,...e]});return s.B.from({name:r,vertex:{source:i.vertex,entryPoint:"main"},fragment:{source:i.fragment,entryPoint:"main"}})}function C(t){let{bits:e,name:r}=t;return new n.M((0,i.A)({name:r},function(t){let{template:e,bits:r}=t;const i=_(e,r);return p[i]||(p[i]=y(e.vertex,e.fragment,r)),p[i]}({template:{vertex:S,fragment:w},bits:[M,...e]})))}},63144:(t,e,r)=>{"use strict";r.d(e,{F:()=>i,a:()=>n});const i={name:"color-bit",vertex:{header:"\n            @in aColor: vec4<f32>;\n        ",main:"\n            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);\n        "}},n={name:"color-bit",vertex:{header:"\n            in vec4 aColor;\n        ",main:"\n            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);\n        "}}},21193:(t,e,r)=>{"use strict";r.d(e,{P:()=>h,_:()=>a});const i={};function n(t){const e=[];if(1===t)e.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),e.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let r=0;for(let i=0;i<t;i++)e.push("@group(1) @binding(".concat(r++,") var textureSource").concat(i+1,": texture_2d<f32>;")),e.push("@group(1) @binding(".concat(r++,") var textureSampler").concat(i+1,": sampler;"))}return e.join("\n")}function s(t){const e=[];if(1===t)e.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{e.push("switch vTextureId {");for(let r=0;r<t;r++)r===t-1?e.push("  default:{"):e.push("  case ".concat(r,":{")),e.push("      outColor = textureSampleGrad(textureSource".concat(r+1,", textureSampler").concat(r+1,", vUV, uvDx, uvDy);")),e.push("      break;}");e.push("}")}return e.join("\n")}function a(t){return i[t]||(i[t]={name:"texture-batch-bit",vertex:{header:"\n                @in aTextureIdAndRound: vec2<u32>;\n                @out @interpolate(flat) vTextureId : u32;\n            ",main:"\n                vTextureId = aTextureIdAndRound.y;\n            ",end:"\n                if(aTextureIdAndRound.x == 1)\n                {\n                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n                }\n            "},fragment:{header:"\n                @in @interpolate(flat) vTextureId: u32;\n\n                ".concat(n(t),"\n            "),main:"\n                var uvDx = dpdx(vUV);\n                var uvDy = dpdy(vUV);\n\n                ".concat(s(t),"\n            ")}}),i[t]}const o={};function l(t){const e=[];for(let r=0;r<t;r++)r>0&&e.push("else"),r<t-1&&e.push("if(vTextureId < ".concat(r,".5)")),e.push("{"),e.push("\toutColor = texture(uTextures[".concat(r,"], vUV);")),e.push("}");return e.join("\n")}function h(t){return o[t]||(o[t]={name:"texture-batch-bit",vertex:{header:"\n                in vec2 aTextureIdAndRound;\n                out float vTextureId;\n\n            ",main:"\n                vTextureId = aTextureIdAndRound.y;\n            ",end:"\n                if(aTextureIdAndRound.x == 1.)\n                {\n                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n                }\n            "},fragment:{header:"\n                in float vTextureId;\n\n                uniform sampler2D uTextures[".concat(t,"];\n\n            "),main:"\n\n                ".concat(l(t),"\n            ")}}),o[t]}},84994:(t,e,r)=>{"use strict";r.d(e,{b:()=>i,m:()=>n});const i={name:"round-pixels-bit",vertex:{header:"\n            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32> \n            {\n                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n            }\n        "}},n={name:"round-pixels-bit",vertex:{header:"   \n            vec2 roundPixels(vec2 position, vec2 targetSize)\n            {       \n                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n            }\n        "}}},95920:(t,e,r)=>{"use strict";r.d(e,{M:()=>f});var i=r(89379),n=r(30801),s=r(10087);let a;function o(){if(!a){a="mediump";const t=(0,s.W)();if(t&&t.getShaderPrecisionFormat){const e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);a=e.precision?"highp":"mediump"}}return a}const l={},h={};const u={stripVersion:function(t,e){return e?t.replace("#version 300 es",""):t},ensurePrecision:function(t,e,r){const i=r?e.maxSupportedFragmentPrecision:e.maxSupportedVertexPrecision;if("precision"!==t.substring(0,9)){let n=r?e.requestedFragmentPrecision:e.requestedVertexPrecision;return"highp"===n&&"highp"!==i&&(n="mediump"),"precision ".concat(n," float;\n").concat(t)}return"highp"!==i&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t},addProgramDefines:function(t,e,r){return e?t:r?(t=t.replace("out vec4 finalColor;",""),"\n        \n        #ifdef GL_ES // This checks if it is WebGL1\n        #define in varying\n        #define finalColor gl_FragColor\n        #define texture texture2D\n        #endif\n        ".concat(t,"\n        ")):"\n        \n        #ifdef GL_ES // This checks if it is WebGL1\n        #define in attribute\n        #define out varying\n        #endif\n        ".concat(t,"\n        ")},setProgramName:function(t,e){let{name:r="pixi-program"}=e,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];r=r.replace(/\s+/g,"-"),r+=i?"-fragment":"-vertex";const n=i?l:h;if(n[r]?(n[r]++,r+="-".concat(n[r])):n[r]=1,-1!==t.indexOf("#define SHADER_NAME"))return t;const s="#define SHADER_NAME ".concat(r);return"".concat(s,"\n").concat(t)},insertVersion:function(t,e){return e?"#version 300 es\n".concat(t):t}},c=Object.create(null),d=class t{constructor(e){const r=-1!==(e=(0,i.A)((0,i.A)({},t.defaultOptions),e)).fragment.indexOf("#version 300 es"),s={stripVersion:r,ensurePrecision:{requestedFragmentPrecision:e.preferredFragmentPrecision,requestedVertexPrecision:e.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:o()},setProgramName:{name:e.name},addProgramDefines:r,insertVersion:r};let a=e.fragment,l=e.vertex;Object.keys(u).forEach((t=>{const e=s[t];a=u[t](a,e,!0),l=u[t](l,e,!1)})),this.fragment=a,this.vertex=l,this.transformFeedbackVaryings=e.transformFeedbackVaryings,this._key=(0,n.X)("".concat(this.vertex,":").concat(this.fragment),"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null}static from(e){const r="".concat(e.vertex,":").concat(e.fragment);return c[r]||(c[r]=new t(e)),c[r]}};d.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let f=d},59963:(t,e,r)=>{"use strict";r.d(e,{n:()=>s});var i=r(5222);const n={};function s(t){let e=n[t];if(e)return e;const r=new Int32Array(t);for(let i=0;i<t;i++)r[i]=i;return e=n[t]=new i.k({uTextures:{value:r,type:"i32",size:t}},{isStatic:!0}),e}},10087:(t,e,r)=>{"use strict";r.d(e,{W:()=>s});var i=r(23144);let n;function s(){var t;if(!n||null!==(t=n)&&void 0!==t&&t.isContextLost()){const t=i.e.get().createCanvas();n=t.getContext("webgl",{})}return n}},2590:(t,e,r)=>{"use strict";r.d(e,{T:()=>i});class i{constructor(t){this.resources=Object.create(null),this._dirty=!0;let e=0;for(const r in t){const i=t[r];this.setResource(i,e++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const t=[];let e=0;for(const r in this.resources)t[e++]=this.resources[r]._resourceId;this._key=t.join("|")}setResource(t,e){var r;const i=this.resources[e];if(t!==i){var n;if(i)null===(n=t.off)||void 0===n||n.call(t,"change",this.onResourceChange,this);null===(r=t.on)||void 0===r||r.call(t,"change",this.onResourceChange,this),this.resources[e]=t,this._dirty=!0}}getResource(t){return this.resources[t]}_touch(t){const e=this.resources;for(const r in e)e[r]._touched=t}destroy(){const t=this.resources;for(const r in t){var e;const i=t[r];null===(e=i.off)||void 0===e||e.call(i,"change",this.onResourceChange,this)}this.resources=null}onResourceChange(t){if(this._dirty=!0,t.destroyed){const e=this.resources;for(const r in e)e[r]===t&&(e[r]=null)}else this._updateKey()}}},47699:(t,e,r)=>{"use strict";r.d(e,{B:()=>h});var i=r(30801),n=r(87393);const s={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function a(t){var e,r,i;const n=/@group\((\d+)\)/,s=/@binding\((\d+)\)/,a=/var(<[^>]+>)? (\w+)/,o=/:\s*(\w+)/,l=/(\w+)\s*:\s*([\w\<\>]+)/g,h=/struct\s+(\w+)/,u=null===(e=t.match(/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g))||void 0===e?void 0:e.map((t=>({group:parseInt(t.match(n)[1],10),binding:parseInt(t.match(s)[1],10),name:t.match(a)[2],isUniform:"<uniform>"===t.match(a)[1],type:t.match(o)[1]})));if(!u)return{groups:[],structs:[]};const c=null!==(r=null===(i=t.match(/struct\s+(\w+)\s*{([^}]+)}/g))||void 0===i?void 0:i.map((t=>{const e=t.match(h)[1],r=t.match(l).reduce(((t,e)=>{const[r,i]=e.split(":");return t[r.trim()]=i.trim(),t}),{});return r?{name:e,members:r}:null})).filter((t=>{let{name:e}=t;return u.some((t=>t.type===e))})))&&void 0!==r?r:[];return{groups:u,structs:c}}var o=(t=>(t[t.VERTEX=1]="VERTEX",t[t.FRAGMENT=2]="FRAGMENT",t[t.COMPUTE=4]="COMPUTE",t))(o||{});const l=Object.create(null);class h{constructor(t){var e,r;this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:i,vertex:n,layout:s,gpuLayout:l,name:h}=t;if(this.name=h,this.fragment=i,this.vertex=n,i.source===n.source){const t=a(i.source);this.structsAndGroups=t}else{const t=a(n.source),e=a(i.source);this.structsAndGroups=function(t,e){const r=new Set,i=new Set;return{structs:[...t.structs,...e.structs].filter((t=>!r.has(t.name)&&(r.add(t.name),!0))),groups:[...t.groups,...e.groups].filter((t=>{const e="".concat(t.name,"-").concat(t.binding);return!i.has(e)&&(i.add(e),!0)}))}}(t,e)}this.layout=null!==s&&void 0!==s?s:function(t){let{groups:e}=t;const r=[];for(let i=0;i<e.length;i++){const t=e[i];r[t.group]||(r[t.group]={}),r[t.group][t.name]=t.binding}return r}(this.structsAndGroups),this.gpuLayout=null!==l&&void 0!==l?l:function(t){let{groups:e}=t;const r=[];for(let i=0;i<e.length;i++){const t=e[i];r[t.group]||(r[t.group]=[]),t.isUniform?r[t.group].push({binding:t.binding,visibility:o.VERTEX|o.FRAGMENT,buffer:{type:"uniform"}}):"sampler"===t.type?r[t.group].push({binding:t.binding,visibility:o.FRAGMENT,sampler:{type:"filtering"}}):"texture_2d"===t.type&&r[t.group].push({binding:t.binding,visibility:o.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return r}(this.structsAndGroups),this.autoAssignGlobalUniforms=!(void 0===(null===(e=this.layout[0])||void 0===e?void 0:e.globalUniforms)),this.autoAssignLocalUniforms=!(void 0===(null===(r=this.layout[1])||void 0===r?void 0:r.localUniforms)),this._generateProgramKey()}_generateProgramKey(){const{vertex:t,fragment:e}=this,r=t.source+e.source+t.entryPoint+e.entryPoint;this._layoutKey=(0,i.X)(r,"program")}get attributeData(){var t;return null!==(t=this._attributeData)&&void 0!==t||(this._attributeData=function(t){let{source:e,entryPoint:r}=t;const i={},a=e.indexOf("fn ".concat(r));if(-1!==a){const t=e.indexOf("->",a);if(-1!==t){const r=e.substring(a,t),l=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;let h;for(;null!==(h=l.exec(r));){var o;const t=null!==(o=s[h[3]])&&void 0!==o?o:"float32";i[h[2]]={location:parseInt(h[1],10),format:t,stride:(0,n.m)(t).stride,offset:0,instance:!1,start:0}}}}return i}(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null}static from(t){const e="".concat(t.vertex.source,":").concat(t.fragment.source,":").concat(t.fragment.entryPoint,":").concat(t.vertex.entryPoint);return l[e]||(l[e]=new h(t)),l[e]}}},95202:(t,e,r)=>{"use strict";r.d(e,{h:()=>a});var i=r(28379),n=r(42026),s=r(96333);class a extends i.A{constructor(t){var e,r;let{data:i,size:s}=t;const{usage:a,label:o,shrinkToFit:l}=t;super(),this.uid=(0,n.L)("buffer"),this._resourceType="buffer",this._resourceId=(0,n.L)("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,i instanceof Array&&(i=new Float32Array(i)),this._data=i,null!==(e=s)&&void 0!==e||(s=null===(r=i)||void 0===r?void 0:r.byteLength);const h=!!i;this.descriptor={size:s,usage:a,mappedAtCreation:h,label:o},this.shrinkToFit=null===l||void 0===l||l}get data(){return this._data}set data(t){this.setDataWithSize(t,t.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&s.S.STATIC)}set static(t){t?this.descriptor.usage|=s.S.STATIC:this.descriptor.usage&=~s.S.STATIC}setDataWithSize(t,e,r){if(this._updateID++,this._updateSize=e*t.BYTES_PER_ELEMENT,this._data===t)return void(r&&this.emit("update",this));const i=this._data;this._data=t,this._dataInt32=null,i&&i.length===t.length||!this.shrinkToFit&&i&&t.byteLength<i.byteLength?r&&this.emit("update",this):(this.descriptor.size=t.byteLength,this._resourceId=(0,n.L)("resource"),this.emit("change",this))}update(t){this._updateSize=null!==t&&void 0!==t?t:this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}},96333:(t,e,r)=>{"use strict";r.d(e,{S:()=>i});var i=(t=>(t[t.MAP_READ=1]="MAP_READ",t[t.MAP_WRITE=2]="MAP_WRITE",t[t.COPY_SRC=4]="COPY_SRC",t[t.COPY_DST=8]="COPY_DST",t[t.INDEX=16]="INDEX",t[t.VERTEX=32]="VERTEX",t[t.UNIFORM=64]="UNIFORM",t[t.STORAGE=128]="STORAGE",t[t.INDIRECT=256]="INDIRECT",t[t.QUERY_RESOLVE=512]="QUERY_RESOLVE",t[t.STATIC=1024]="STATIC",t))(i||{})},69801:(t,e,r)=>{"use strict";r.d(e,{V:()=>h});var i=r(28379),n=r(66373),s=r(42026),a=r(95202),o=r(96333);function l(t,e){if(!(t instanceof a.h)){let r=e?o.S.INDEX:o.S.VERTEX;t instanceof Array&&(e?(t=new Uint32Array(t),r=o.S.INDEX|o.S.COPY_DST):(t=new Float32Array(t),r=o.S.VERTEX|o.S.COPY_DST)),t=new a.h({data:t,label:e?"index-mesh-buffer":"vertex-mesh-buffer",usage:r})}return t}class h extends i.A{constructor(){var t;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.uid=(0,s.L)("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new n.c,this._boundsDirty=!0;const{attributes:r,indexBuffer:i,topology:a}=e;if(this.buffers=[],this.attributes={},r)for(const n in r)this.addAttribute(n,r[n]);this.instanceCount=null!==(t=e.instanceCount)&&void 0!==t?t:1,i&&this.addIndex(i),this.topology=a||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(t){return this.attributes[t]}getIndex(){return this.indexBuffer}getBuffer(t){return this.getAttribute(t).buffer}getSize(){for(const t in this.attributes){const e=this.attributes[t];return e.buffer.data.length/(e.stride/4||e.size)}return 0}addAttribute(t,e){const r=function(t){return(t instanceof a.h||Array.isArray(t)||t.BYTES_PER_ELEMENT)&&(t={buffer:t}),t.buffer=l(t.buffer,!1),t}(e);-1===this.buffers.indexOf(r.buffer)&&(this.buffers.push(r.buffer),r.buffer.on("update",this.onBufferUpdate,this),r.buffer.on("change",this.onBufferUpdate,this)),this.attributes[t]=r}addIndex(t){this.indexBuffer=l(t,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,function(t,e,r){const i=t.getAttribute(e);if(!i)return r.minX=0,r.minY=0,r.maxX=0,r.maxY=0,r;const n=i.buffer.data;let s=1/0,a=1/0,o=-1/0,l=-1/0;const h=n.BYTES_PER_ELEMENT,u=(i.offset||0)/h,c=(i.stride||8)/h;for(let d=u;d<n.length;d+=c){const t=n[d],e=n[d+1];t>o&&(o=t),e>l&&(l=e),t<s&&(s=t),e<a&&(a=e)}return r.minX=s,r.minY=a,r.maxX=o,r.maxY=l,r}(this,"aPosition",this._bounds)):this._bounds}destroy(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.emit("destroy",this),this.removeAllListeners(),t&&this.buffers.forEach((t=>t.destroy())),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}},87393:(t,e,r)=>{"use strict";r.d(e,{m:()=>n});const i={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function n(t){var e;return null!==(e=i[t])&&void 0!==e?e:i.float32}},53636:(t,e,r)=>{"use strict";r.d(e,{M:()=>d});var i=r(89379),n=r(80045),s=r(28379),a=r(95920),o=r(2590),l=r(47699),h=r(16650),u=r(5222);const c=["gpu","gl"];class d extends s.A{constructor(t){super(),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[];let{gpuProgram:e,glProgram:r,groups:i,resources:n,compatibleRenderers:s,groupMap:a}=t;this.gpuProgram=e,this.glProgram=r,void 0===s&&(s=0,e&&(s|=h.W.WEBGPU),r&&(s|=h.W.WEBGL)),this.compatibleRenderers=s;const l={};if(n||i||(n={}),n&&i)throw new Error("[Shader] Cannot have both resources and groups");if(!e&&i&&!a)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!e&&i&&a)for(const o in a)for(const t in a[o]){const e=a[o][t];l[e]={group:o,binding:t,name:e}}else if(e&&i&&!a){const t=e.structsAndGroups.groups;a={},t.forEach((t=>{a[t.group]=a[t.group]||{},a[t.group][t.binding]=t.name,l[t.name]=t}))}else if(n){if(i={},a={},e){e.structsAndGroups.groups.forEach((t=>{a[t.group]=a[t.group]||{},a[t.group][t.binding]=t.name,l[t.name]=t}))}let t=0;for(const e in n)l[e]||(i[99]||(i[99]=new o.T,this._ownedBindGroups.push(i[99])),l[e]={group:99,binding:t,name:e},a[99]=a[99]||{},a[99][t]=e,t++);for(const e in n){const t=e;let r=n[e];r.source||r._resourceType||(r=new u.k(r));const s=l[t];s&&(i[s.group]||(i[s.group]=new o.T,this._ownedBindGroups.push(i[s.group])),i[s.group].setResource(r,s.binding))}}this.groups=i,this._uniformBindMap=a,this.resources=this._buildResourceAccessor(i,l)}addResource(t,e,r){var i,n;(i=this._uniformBindMap)[e]||(i[e]={}),(n=this._uniformBindMap[e])[r]||(n[r]=t),this.groups[e]||(this.groups[e]=new o.T,this._ownedBindGroups.push(this.groups[e]))}_buildResourceAccessor(t,e){const r={};for(const i in e){const n=e[i];Object.defineProperty(r,n.name,{get:()=>t[n.group].getResource(n.binding),set(e){t[n.group].setResource(e,n.binding)}})}return r}destroy(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e,r;(this.emit("destroy",this),t)&&(null===(e=this.gpuProgram)||void 0===e||e.destroy(),null===(r=this.glProgram)||void 0===r||r.destroy());this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach((t=>{t.destroy()})),this._ownedBindGroups=null,this.resources=null,this.groups=null}static from(t){const{gpu:e,gl:r}=t,s=(0,n.A)(t,c);let o,h;return e&&(o=l.B.from(e)),r&&(h=a.M.from(r)),new d((0,i.A)({gpuProgram:o,glProgram:h},s))}}},5222:(t,e,r)=>{"use strict";r.d(e,{k:()=>u});var i=r(89379),n=r(42026),s=r(30801);const a=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],o=a.reduce(((t,e)=>(t[e]=!0,t)),{});function l(t,e){switch(t){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*e);case"vec3<f32>":return new Float32Array(3*e);case"vec4<f32>":return new Float32Array(4*e);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const h=class t{constructor(e,r){this._touched=0,this.uid=(0,n.L)("uniform"),this._resourceType="uniformGroup",this._resourceId=(0,n.L)("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,r=(0,i.A)((0,i.A)({},t.defaultOptions),r),this.uniformStructures=e;const h={};for(const t in e){var u,c;const r=e[t];if(r.name=t,r.size=null!==(u=r.size)&&void 0!==u?u:1,!o[r.type])throw new Error("Uniform type ".concat(r.type," is not supported. Supported uniform types are: ").concat(a.join(", ")));null!==(c=r.value)&&void 0!==c||(r.value=l(r.type,r.size)),h[t]=r.value}this.uniforms=h,this._dirtyId=1,this.ubo=r.ubo,this.isStatic=r.isStatic,this._signature=(0,s.X)(Object.keys(h).map((t=>"".concat(t,"-").concat(e[t].type))).join("-"),"uniform-group")}update(){this._dirtyId++}};h.defaultOptions={ubo:!1,isStatic:!1};let u=h},90576:(t,e,r)=>{"use strict";r.d(e,{U:()=>s});const i={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8,min:9,max:10},n=class t{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}set cullMode(t){"none"!==t?(this.culling=!0,this.clockwiseFrontFace="front"===t):this.culling=!1}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend="none"!==t,this._blendMode=t,this._blendModeId=i[t]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return"[pixi.js/core:State blendMode=".concat(this.blendMode," clockwiseFrontFace=").concat(this.clockwiseFrontFace," culling=").concat(this.culling," depthMask=").concat(this.depthMask," polygonOffset=").concat(this.polygonOffset,"]")}static for2d(){const e=new t;return e.depthTest=!1,e.blend=!0,e}};n.default2d=n.for2d();let s=n},77820:(t,e,r)=>{"use strict";r.d(e,{i:()=>n});const i={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};function n(t,e){return"no-premultiply-alpha"===e.alphaMode&&i[t]||t}},59445:(t,e,r)=>{"use strict";r.d(e,{N:()=>s});var i=r(23144),n=r(8186);const s=new class{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(t,e){const r=i.e.get().createCanvas();r.width=t,r.height=e;const n=r.getContext("2d");return{canvas:r,context:n}}getOptimalCanvasAndContext(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;t=Math.ceil(t*r-1e-6),e=Math.ceil(e*r-1e-6);const i=((t=(0,n.U5)(t))<<17)+((e=(0,n.U5)(e))<<1);this._canvasPool[i]||(this._canvasPool[i]=[]);let s=this._canvasPool[i].pop();return s||(s=this._createCanvasAndContext(t,e)),s}returnCanvasAndContext(t){const e=t.canvas,{width:r,height:i}=e,n=(r<<17)+(i<<1);t.context.clearRect(0,0,r,i),this._canvasPool[n].push(t)}clear(){this._canvasPool={}}}},30801:(t,e,r)=>{"use strict";r.d(e,{X:()=>s});const i=Object.create(null),n=Object.create(null);function s(t,e){let r=n[t];return void 0===r&&(void 0===i[e]&&(i[e]=1),n[t]=r=i[e]++),r}},16650:(t,e,r)=>{"use strict";r.d(e,{W:()=>i});var i=(t=>(t[t.WEBGL=1]="WEBGL",t[t.WEBGPU=2]="WEBGPU",t[t.BOTH=3]="BOTH",t))(i||{})},29385:(t,e,r)=>{"use strict";function i(t,e,r){const i=(t>>24&255)/255;e[r++]=(255&t)/255*i,e[r++]=(t>>8&255)/255*i,e[r++]=(t>>16&255)/255*i,e[r++]=i}r.d(e,{V:()=>i})},31878:(t,e,r)=>{"use strict";var i=r(91478),n=r(55535),s=r(90576),a=r(69769),o=r(29385),l=r(69211);class h{constructor(t,e){this.state=s.U.for2d(),this._graphicsBatchesHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this.renderer=t,this._adaptor=e,this._adaptor.init(),this.renderer.renderableGC.addManagedHash(this,"_graphicsBatchesHash")}validateRenderable(t){const e=t.context,r=!!this._graphicsBatchesHash[t.uid],i=this.renderer.graphicsContext.updateGpuContext(e);return!(!i.isBatchable&&r===i.isBatchable)}addRenderable(t,e){const r=this.renderer.graphicsContext.updateGpuContext(t.context);t.didViewUpdate&&this._rebuild(t),r.isBatchable?this._addToBatcher(t,e):(this.renderer.renderPipes.batch.break(e),e.add(t))}updateRenderable(t){const e=this._graphicsBatchesHash[t.uid];if(e)for(let r=0;r<e.length;r++){const t=e[r];t._batcher.updateElement(t)}}destroyRenderable(t){this._graphicsBatchesHash[t.uid]&&this._removeBatchForRenderable(t.uid),t.off("destroyed",this._destroyRenderableBound)}execute(t){if(!t.isRenderable)return;const e=this.renderer,r=t.context;if(!e.graphicsContext.getGpuContext(r).batches.length)return;const i=r.customShader||this._adaptor.shader;this.state.blendMode=t.groupBlendMode;const n=i.resources.localUniforms.uniforms;n.uTransformMatrix=t.groupTransform,n.uRound=e._roundPixels|t._roundPixels,(0,o.V)(t.groupColorAlpha,n.uColor,0),this._adaptor.execute(this,t)}_rebuild(t){const e=!!this._graphicsBatchesHash[t.uid],r=this.renderer.graphicsContext.updateGpuContext(t.context);e&&this._removeBatchForRenderable(t.uid),r.isBatchable&&this._initBatchesForRenderable(t),t.batched=r.isBatchable}_addToBatcher(t,e){const r=this.renderer.renderPipes.batch,i=this._getBatchesForRenderable(t);for(let n=0;n<i.length;n++){const t=i[n];r.addToBatch(t,e)}}_getBatchesForRenderable(t){return this._graphicsBatchesHash[t.uid]||this._initBatchesForRenderable(t)}_initBatchesForRenderable(t){const e=t.context,r=this.renderer.graphicsContext.getGpuContext(e),i=this.renderer._roundPixels|t._roundPixels,n=r.batches.map((e=>{const r=a.Z.get(l.G);return e.copyTo(r),r.renderable=t,r.roundPixels=i,r}));return void 0===this._graphicsBatchesHash[t.uid]&&t.on("destroyed",this._destroyRenderableBound),this._graphicsBatchesHash[t.uid]=n,n}_removeBatchForRenderable(t){this._graphicsBatchesHash[t].forEach((t=>{a.Z.return(t)})),this._graphicsBatchesHash[t]=null}destroy(){this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null;for(const t in this._graphicsBatchesHash)this._removeBatchForRenderable(t);this._graphicsBatchesHash=null}}h.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"graphics"},i.XO.add(h),i.XO.add(n.GH)},69211:(t,e,r)=>{"use strict";r.d(e,{G:()=>a});var i=r(33596),n=r(96225);const s=new i.u;class a{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,e=t>>16|65280&t|(255&t)<<16,r=this.renderable;return r?(0,n.u)(e,r.groupColor)+(this.alpha*r.groupAlpha*255<<24):e+(255*this.alpha<<24)}get transform(){var t;return(null===(t=this.renderable)||void 0===t?void 0:t.groupTransform)||s}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}}},97861:(t,e,r)=>{"use strict";r.d(e,{T:()=>X});var i=r(89379),n=r(28379),s=r(75242),a=r(33596),o=r(31960),l=r(7663),h=r(42026),u=r(14811),c=r(66373),d=r(60279),f=r(24100);var p=r(44307);class g{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.type="circle",this.x=t,this.y=e,this.radius=r}clone(){return new g(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const r=this.radius*this.radius;let i=this.x-t,n=this.y-e;return i*=i,n*=n,i+n<=r}strokeContains(t,e,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;if(0===this.radius)return!1;const n=this.x-t,s=this.y-e,a=this.radius,o=(1-i)*r,l=Math.sqrt(n*n+s*s);return l<=a+o&&l>a-(r-o)}getBounds(t){return t||(t=new p.M),t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=2*this.radius,t.height=2*this.radius,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return"[pixi.js/math:Circle x=".concat(this.x," y=").concat(this.y," radius=").concat(this.radius,"]")}}class m{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.type="ellipse",this.x=t,this.y=e,this.halfWidth=r,this.halfHeight=i}clone(){return new m(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let r=(t-this.x)/this.halfWidth,i=(e-this.y)/this.halfHeight;return r*=r,i*=i,r+i<=1}strokeContains(t,e,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;const{halfWidth:n,halfHeight:s}=this;if(n<=0||s<=0)return!1;const a=r*(1-i),o=r-a,l=n-o,h=s-o,u=n+a,c=s+a,d=t-this.x,f=e-this.y;return d*d/(l*l)+f*f/(h*h)>1&&d*d/(u*u)+f*f/(c*c)<=1}getBounds(t){return t||(t=new p.M),t.x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=2*this.halfWidth,t.height=2*this.halfHeight,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return"[pixi.js/math:Ellipse x=".concat(this.x," y=").concat(this.y," halfWidth=").concat(this.halfWidth," halfHeight=").concat(this.halfHeight,"]")}}function x(t,e,r,i,n,s){const a=n-r,o=s-i,l=a*a+o*o;let h,u,c=-1;0!==l&&(c=((t-r)*a+(e-i)*o)/l),c<0?(h=r,u=i):c>1?(h=n,u=s):(h=r+c*a,u=i+c*o);const d=t-h,f=e-u;return d*d+f*f}class _{constructor(){this.type="polygon";for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];let i=Array.isArray(e[0])?e[0]:e;if("number"!==typeof i[0]){const t=[];for(let e=0,r=i.length;e<r;e++)t.push(i[e].x,i[e].y);i=t}this.points=i,this.closePath=!0}clone(){const t=this.points.slice(),e=new _(t);return e.closePath=this.closePath,e}contains(t,e){let r=!1;const i=this.points.length/2;for(let n=0,s=i-1;n<i;s=n++){const i=this.points[2*n],a=this.points[2*n+1],o=this.points[2*s],l=this.points[2*s+1];a>e!==l>e&&t<(e-a)/(l-a)*(o-i)+i&&(r=!r)}return r}strokeContains(t,e,r){const i=r*r,n=i*(1-(arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5)),s=i-n,{points:a}=this,o=a.length-(this.closePath?0:2);for(let l=0;l<o;l+=2){const r=a[l],i=a[l+1],o=a[(l+2)%a.length],h=a[(l+3)%a.length];if(x(t,e,r,i,o,h)<=(Math.sign((o-r)*(e-i)-(h-i)*(t-r))<0?s:n))return!0}return!1}getBounds(t){t||(t=new p.M);const e=this.points;let r=1/0,i=-1/0,n=1/0,s=-1/0;for(let a=0,o=e.length;a<o;a+=2){const t=e[a],o=e[a+1];r=t<r?t:r,i=t>i?t:i,n=o<n?o:n,s=o>s?o:s}return t.x=r,t.width=i-r,t.y=n,t.height=s-n,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return"[pixi.js/math:PolygoncloseStroke=".concat(this.closePath,"points=").concat(this.points.reduce(((t,e)=>"".concat(t,", ").concat(e)),""),"]")}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return this.points[this.points.length-2]}get y(){return this.points[this.points.length-1]}}const y=(t,e,r,i,n,s,a)=>{const o=t-r,l=e-i,h=Math.sqrt(o*o+l*l);return h>=n-s&&h<=n+a};class v{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20;this.type="roundedRectangle",this.x=t,this.y=e,this.width=r,this.height=i,this.radius=n}getBounds(t){return t||(t=new p.M),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new v(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let i=t-(this.x+r),n=e-(this.y+r);const s=r*r;if(i*i+n*n<=s)return!0;if(i=t-(this.x+this.width-r),i*i+n*n<=s)return!0;if(n=e-(this.y+this.height-r),i*i+n*n<=s)return!0;if(i=t-(this.x+r),i*i+n*n<=s)return!0}return!1}strokeContains(t,e,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;const{x:n,y:s,width:a,height:o,radius:l}=this,h=r*(1-i),u=r-h,c=n+l,d=s+l,f=n+a,p=s+o;return(t>=n-h&&t<=n+u||t>=f-u&&t<=f+h)&&e>=d&&e<=d+(o-2*l)||((e>=s-h&&e<=s+u||e>=p-u&&e<=p+h)&&t>=c&&t<=c+(a-2*l)||(t<c&&e<d&&y(t,e,c,d,l,u,h)||t>f-l&&e<d&&y(t,e,f-l,d,l,u,h)||t>f-l&&e>p-l&&y(t,e,f-l,p-l,l,u,h)||t<c&&e>p-l&&y(t,e,c,p-l,l,u,h)))}toString(){return"[pixi.js/math:RoundedRectangle x=".concat(this.x," y=").concat(this.y,"width=").concat(this.width," height=").concat(this.height," radius=").concat(this.radius,"]")}}var b=r(55535);const S=1.1920929e-7;function w(t,e,r,i,n,s,a,o,l,h){let u=(1-Math.min(.99,Math.max(0,null!==h&&void 0!==h?h:b.GH.defaultOptions.bezierSmoothness)))/1;return u*=u,function(t,e,r,i,n,s,a,o,l,h){T(t,e,r,i,n,s,a,o,l,h,0),l.push(a,o)}(e,r,i,n,s,a,o,l,t,u),t}function T(t,e,r,i,n,s,a,o,l,h,u){if(u>8)return;Math.PI;const c=(t+r)/2,d=(e+i)/2,f=(r+n)/2,p=(i+s)/2,g=(n+a)/2,m=(s+o)/2,x=(c+f)/2,_=(d+p)/2,y=(f+g)/2,v=(p+m)/2,b=(x+y)/2,w=(_+v)/2;if(u>0){let u=a-t,c=o-e;const d=Math.abs((r-a)*c-(i-o)*u),f=Math.abs((n-a)*c-(s-o)*u);if(d>S&&f>S){if((d+f)*(d+f)<=h*(u*u+c*c))return void l.push(b,w)}else if(d>S){if(d*d<=h*(u*u+c*c))return void l.push(b,w)}else if(f>S){if(f*f<=h*(u*u+c*c))return void l.push(b,w)}else if(u=b-(t+a)/2,c=w-(e+o)/2,u*u+c*c<=h)return void l.push(b,w)}T(t,e,c,d,x,_,b,w,l,h,u+1),T(b,w,y,v,g,m,a,o,l,h,u+1)}function M(t,e,r,i,n,s,a,o){let l=(1-Math.min(.99,Math.max(0,null!==o&&void 0!==o?o:b.GH.defaultOptions.bezierSmoothness)))/1;return l*=l,function(t,e,r,i,n,s,a,o){P(a,t,e,r,i,n,s,o,0),a.push(n,s)}(e,r,i,n,s,a,t,l),t}function P(t,e,r,i,n,s,a,o,l){if(l>8)return;Math.PI;const h=(e+i)/2,u=(r+n)/2,c=(i+s)/2,d=(n+a)/2,f=(h+c)/2,p=(u+d)/2;let g=s-e,m=a-r;const x=Math.abs((i-s)*m-(n-a)*g);if(x>1.1920929e-7){if(x*x<=o*(g*g+m*m))return void t.push(f,p)}else if(g=f-(e+s)/2,m=p-(r+a)/2,g*g+m*m<=o)return void t.push(f,p);P(t,e,r,h,u,f,p,o,l+1),P(t,f,p,c,d,s,a,o,l+1)}function C(t,e,r,i,n,s,a,o){let l=Math.abs(n-s);(!a&&n>s||a&&s>n)&&(l=2*Math.PI-l),o||(o=Math.max(6,Math.floor(6*Math.pow(i,1/3)*(l/Math.PI))));let h=l/(o=Math.max(o,3)),u=n;h*=a?-1:1;for(let c=0;c<o+1;c++){const n=e+Math.cos(u)*i,s=r+Math.sin(u)*i;t.push(n,s),u+=h}}const A=2*Math.PI,k={centerX:0,centerY:0,ang1:0,ang2:0},B=(t,e,r,i,n,s,a,o)=>{let{x:l,y:h}=t;l*=e,h*=r;const u=i*l-n*h,c=n*l+i*h;return o.x=u+s,o.y=c+a,o};function R(t,e){const r=-1.5707963267948966===e?-.551915024494:4/3*Math.tan(e/4),i=1.5707963267948966===e?.551915024494:r,n=Math.cos(t),s=Math.sin(t),a=Math.cos(t+e),o=Math.sin(t+e);return[{x:n-s*i,y:s+n*i},{x:a+o*i,y:o-a*i},{x:a,y:o}]}const z=(t,e,r,i)=>{let n=t*r+e*i;return n>1&&(n=1),n<-1&&(n=-1),(t*i-e*r<0?-1:1)*Math.acos(n)};function U(t,e,r,i,n,s,a){let o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;if(0===s||0===a)return;const u=Math.sin(o*A/360),c=Math.cos(o*A/360),d=c*(e-i)/2+u*(r-n)/2,f=-u*(e-i)/2+c*(r-n)/2;if(0===d&&0===f)return;s=Math.abs(s),a=Math.abs(a);const p=Math.pow(d,2)/Math.pow(s,2)+Math.pow(f,2)/Math.pow(a,2);p>1&&(s*=Math.sqrt(p),a*=Math.sqrt(p)),((t,e,r,i,n,s,a,o,l,h,u,c,d)=>{const f=Math.pow(n,2),p=Math.pow(s,2),g=Math.pow(u,2),m=Math.pow(c,2);let x=f*p-f*m-p*g;x<0&&(x=0),x/=f*m+p*g,x=Math.sqrt(x)*(a===o?-1:1);const _=x*n/s*c,y=x*-s/n*u,v=h*_-l*y+(t+r)/2,b=l*_+h*y+(e+i)/2,S=(u-_)/n,w=(c-y)/s,T=(-u-_)/n,M=(-c-y)/s,P=z(1,0,S,w);let C=z(S,w,T,M);0===o&&C>0&&(C-=A),1===o&&C<0&&(C+=A),d.centerX=v,d.centerY=b,d.ang1=P,d.ang2=C})(e,r,i,n,s,a,l,h,u,c,d,f,k);let{ang1:g,ang2:m}=k;const{centerX:x,centerY:_}=k;let y=Math.abs(m)/(A/4);Math.abs(1-y)<1e-7&&(y=1);const v=Math.max(Math.ceil(y),1);m/=v;let b=t[t.length-2],S=t[t.length-1];const T={x:0,y:0};for(let M=0;M<v;M++){const e=R(g,m),{x:r,y:i}=B(e[0],s,a,c,u,x,_,T),{x:n,y:o}=B(e[1],s,a,c,u,x,_,T),{x:l,y:h}=B(e[2],s,a,c,u,x,_,T);w(t,b,S,r,i,n,o,l,h),b=l,S=h,g+=m}}const F=new p.M;class I{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new c.c,this._graphicsPath2D=t}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const r=this._currentPoly.points,i=r[r.length-2],n=r[r.length-1];return i===t&&n===e||r.push(t,e),this}arc(t,e,r,i,n,s){this._ensurePoly(!1);return C(this._currentPoly.points,t,e,r,i,n,s),this}arcTo(t,e,r,i,n){this._ensurePoly();return function(t,e,r,i,n,s){const a=t[t.length-2],o=t[t.length-1]-r,l=a-e,h=n-r,u=i-e,c=Math.abs(o*u-l*h);if(c<1e-8||0===s)return void(t[t.length-2]===e&&t[t.length-1]===r||t.push(e,r));const d=o*o+l*l,f=h*h+u*u,p=o*h+l*u,g=s*Math.sqrt(d)/c,m=s*Math.sqrt(f)/c,x=g*p/d,_=m*p/f,y=g*u+m*l,v=g*h+m*o,b=l*(m+x),S=o*(m+x),w=u*(g+_),T=h*(g+_);C(t,y+e,v+r,s,Math.atan2(S-v,b-y),Math.atan2(T-v,w-y),l*h>u*o)}(this._currentPoly.points,t,e,r,i,n),this}arcToSvg(t,e,r,i,n,s,a){return U(this._currentPoly.points,this._currentPoly.lastX,this._currentPoly.lastY,s,a,t,e,r,i,n),this}bezierCurveTo(t,e,r,i,n,s,a){this._ensurePoly();const o=this._currentPoly;return w(this._currentPoly.points,o.lastX,o.lastY,t,e,r,i,n,s,a),this}quadraticCurveTo(t,e,r,i,n){this._ensurePoly();const s=this._currentPoly;return M(this._currentPoly.points,s.lastX,s.lastY,t,e,r,i,n),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0)).transform(e);for(let r=0;r<t.instructions.length;r++){const e=t.instructions[r];this[e.action](...e.data)}return this}finish(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.endPoly(t)}rect(t,e,r,i,n){return this.drawShape(new p.M(t,e,r,i),n),this}circle(t,e,r,i){return this.drawShape(new g(t,e,r),i),this}poly(t,e,r){const i=new _(t);return i.closePath=e,this.drawShape(i,r),this}regularPoly(t,e,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5?arguments[5]:void 0;i=Math.max(0|i,3);const a=-1*Math.PI/2+n,o=2*Math.PI/i,l=[];for(let h=0;h<i;h++){const i=a-h*o;l.push(t+r*Math.cos(i),e+r*Math.sin(i))}return this.poly(l,!0,s),this}roundPoly(t,e,r,i,n){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6?arguments[6]:void 0;if(i=Math.max(0|i,3),n<=0)return this.regularPoly(t,e,r,i,s);const o=r*Math.sin(Math.PI/i)-.001;n=Math.min(n,o);const l=-1*Math.PI/2+s,h=2*Math.PI/i,u=(i-2)*Math.PI/i/2;for(let c=0;c<i;c++){const i=c*h+l,s=t+r*Math.cos(i),o=e+r*Math.sin(i),d=i+Math.PI+u,f=i-Math.PI-u,p=s+n*Math.cos(d),g=o+n*Math.sin(d),m=s+n*Math.cos(f),x=o+n*Math.sin(f);0===c?this.moveTo(p,g):this.lineTo(p,g),this.quadraticCurveTo(s,o,m,x,a)}return this.closePath()}roundShape(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;return t.length<3?this:(r?function(t,e,r,i){const n=(t,e)=>Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2),s=(t,e,r)=>({x:t.x+(e.x-t.x)*r,y:t.y+(e.y-t.y)*r}),a=e.length;for(let l=0;l<a;l++){var o;const h=e[(l+1)%a],u=null!==(o=h.radius)&&void 0!==o?o:r;if(u<=0){0===l?t.moveTo(h.x,h.y):t.lineTo(h.x,h.y);continue}const c=e[l],d=e[(l+2)%a],f=n(c,h);let p;p=f<1e-4?h:s(h,c,Math.min(f/2,u)/f);const g=n(d,h);let m;m=g<1e-4?h:s(h,d,Math.min(g/2,u)/g),0===l?t.moveTo(p.x,p.y):t.lineTo(p.x,p.y),t.quadraticCurveTo(h.x,h.y,m.x,m.y,i)}}(this,t,e,i):function(t,e,r){const i=(t,e)=>{const r=e.x-t.x,i=e.y-t.y,n=Math.sqrt(r*r+i*i);return{len:n,nx:r/n,ny:i/n}},n=(e,r)=>{0===e?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y)};let s=e[e.length-1];for(let o=0;o<e.length;o++){var a;const l=e[o%e.length],h=null!==(a=l.radius)&&void 0!==a?a:r;if(h<=0){n(o,l),s=l;continue}const u=e[(o+1)%e.length],c=i(l,s),d=i(l,u);if(c.len<1e-4||d.len<1e-4){n(o,l),s=l;continue}let f=Math.asin(c.nx*d.ny-c.ny*d.nx),p=1,g=!1;c.nx*d.nx-c.ny*-d.ny<0?f<0?f=Math.PI+f:(f=Math.PI-f,p=-1,g=!0):f>0&&(p=-1,g=!0);const m=f/2;let x,_=Math.abs(Math.cos(m)*h/Math.sin(m));_>Math.min(c.len/2,d.len/2)?(_=Math.min(c.len/2,d.len/2),x=Math.abs(_*Math.sin(m)/Math.cos(m))):x=h;const y=l.x+d.nx*_+-d.ny*x*p,v=l.y+d.ny*_+d.nx*x*p,b=Math.atan2(c.ny,c.nx)+Math.PI/2*p,S=Math.atan2(d.ny,d.nx)-Math.PI/2*p;0===o&&t.moveTo(y+Math.cos(b)*x,v+Math.sin(b)*x),t.arc(y,v,x,b,S,g),s=l}}(this,t,e),this.closePath())}filletRect(t,e,r,i,n){if(0===n)return this.rect(t,e,r,i);const s=Math.min(r,i)/2,a=Math.min(s,Math.max(-s,n)),o=t+r,l=e+i,h=a<0?-a:0,u=Math.abs(a);return this.moveTo(t,e+u).arcTo(t+h,e+h,t+u,e,u).lineTo(o-u,e).arcTo(o-h,e+h,o,e+u,u).lineTo(o,l-u).arcTo(o-h,l-h,t+r-u,l,u).lineTo(t+u,l).arcTo(t+h,l-h,t,l-u,u).closePath()}chamferRect(t,e,r,i,n,s){if(n<=0)return this.rect(t,e,r,i);const a=Math.min(n,Math.min(r,i)/2),o=t+r,l=e+i,h=[t+a,e,o-a,e,o,e+a,o,l-a,o-a,l,t+a,l,t,l-a,t,e+a];for(let u=h.length-1;u>=2;u-=2)h[u]===h[u-2]&&h[u-1]===h[u-3]&&h.splice(u-1,2);return this.poly(h,!0,s)}ellipse(t,e,r,i,n){return this.drawShape(new m(t,e,r,i),n),this}roundRect(t,e,r,i,n,s){return this.drawShape(new v(t,e,r,i,n),s),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let r=this._currentPoly;return r&&this.endPoly(),r=new _,r.points.push(t,e),this._currentPoly=r,this}endPoly(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this._currentPoly&&(this._currentPoly=new _,t)){const t=this.shapePrimitives[this.shapePrimitives.length-1];if(t){let e=t.shape.x,r=t.shape.y;if(t.transform&&!t.transform.isIdentity()){const i=t.transform,n=e;e=i.a*e+i.c*r+i.tx,r=i.b*n+i.d*r+i.ty}this._currentPoly.points.push(e,r)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const r=t.instructions[e];this[r.action](...r.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let r=0;r<e.length;r++){const i=e[r],n=i.shape.getBounds(F);i.transform?t.addRect(n,i.transform):t.addRect(n)}return t}}class E{constructor(t){var e;(this.instructions=[],this.uid=(0,h.L)("graphicsPath"),this._dirty=!0,"string"===typeof t)?function(t,e){const r=f(t),i=[];let n=null,s=0,a=0;for(let o=0;o<r.length;o++){const t=r[o],l=t[0],h=t;switch(l){case"M":s=h[1],a=h[2],e.moveTo(s,a);break;case"m":s+=h[1],a+=h[2],e.moveTo(s,a);break;case"H":s=h[1],e.lineTo(s,a);break;case"h":s+=h[1],e.lineTo(s,a);break;case"V":a=h[1],e.lineTo(s,a);break;case"v":a+=h[1],e.lineTo(s,a);break;case"L":s=h[1],a=h[2],e.lineTo(s,a);break;case"l":s+=h[1],a+=h[2],e.lineTo(s,a);break;case"C":s=h[5],a=h[6],e.bezierCurveTo(h[1],h[2],h[3],h[4],s,a);break;case"c":e.bezierCurveTo(s+h[1],a+h[2],s+h[3],a+h[4],s+h[5],a+h[6]),s+=h[5],a+=h[6];break;case"S":s=h[3],a=h[4],e.bezierCurveToShort(h[1],h[2],s,a);break;case"s":e.bezierCurveToShort(s+h[1],a+h[2],s+h[3],a+h[4]),s+=h[3],a+=h[4];break;case"Q":s=h[3],a=h[4],e.quadraticCurveTo(h[1],h[2],s,a);break;case"q":e.quadraticCurveTo(s+h[1],a+h[2],s+h[3],a+h[4]),s+=h[3],a+=h[4];break;case"T":s=h[1],a=h[2],e.quadraticCurveToShort(s,a);break;case"t":s+=h[1],a+=h[2],e.quadraticCurveToShort(s,a);break;case"A":s=h[6],a=h[7],e.arcToSvg(h[1],h[2],h[3],h[4],h[5],s,a);break;case"a":s+=h[6],a+=h[7],e.arcToSvg(h[1],h[2],h[3],h[4],h[5],s,a);break;case"Z":case"z":e.closePath(),i.length>0&&(n=i.pop(),n?(s=n.startX,a=n.startY):(s=0,a=0)),n=null;break;default:(0,d.R)("Unknown SVG path command: ".concat(l))}"Z"!==l&&"z"!==l&&null===n&&(n={startX:s,startY:a},i.push(n))}}(t,this):this.instructions=null!==(e=null===t||void 0===t?void 0:t.slice())&&void 0!==e?e:[]}get shapePath(){return this._shapePath||(this._shapePath=new I(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.instructions.push({action:"arc",data:e}),this._dirty=!0,this}arcTo(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.instructions.push({action:"arcTo",data:e}),this._dirty=!0,this}arcToSvg(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.instructions.push({action:"arcToSvg",data:e}),this._dirty=!0,this}bezierCurveTo(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.instructions.push({action:"bezierCurveTo",data:e}),this._dirty=!0,this}bezierCurveToShort(t,e,r,i,n){const s=this.instructions[this.instructions.length-1],a=this.getLastPoint(o.b.shared);let l=0,h=0;if(s&&"bezierCurveTo"===s.action){l=s.data[2],h=s.data[3];const t=a.x,e=a.y;l=t+(t-l),h=e+(e-h)}else l=a.x,h=a.y;return this.instructions.push({action:"bezierCurveTo",data:[l,h,t,e,r,i,n]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.instructions.push({action:"ellipse",data:e}),this._dirty=!0,this}lineTo(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.instructions.push({action:"lineTo",data:e}),this._dirty=!0,this}moveTo(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.instructions.push({action:"moveTo",data:e}),this}quadraticCurveTo(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.instructions.push({action:"quadraticCurveTo",data:e}),this._dirty=!0,this}quadraticCurveToShort(t,e,r){const i=this.instructions[this.instructions.length-1],n=this.getLastPoint(o.b.shared);let s=0,a=0;if(i&&"quadraticCurveTo"===i.action){s=i.data[0],a=i.data[1];const t=n.x,e=n.y;s=t+(t-s),a=e+(e-a)}else s=n.x,a=n.y;return this.instructions.push({action:"quadraticCurveTo",data:[s,a,t,e,r]}),this._dirty=!0,this}rect(t,e,r,i,n){return this.instructions.push({action:"rect",data:[t,e,r,i,n]}),this._dirty=!0,this}circle(t,e,r,i){return this.instructions.push({action:"circle",data:[t,e,r,i]}),this._dirty=!0,this}roundRect(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.instructions.push({action:"roundRect",data:e}),this._dirty=!0,this}poly(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.instructions.push({action:"poly",data:e}),this._dirty=!0,this}regularPoly(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.instructions.push({action:"regularPoly",data:e}),this._dirty=!0,this}roundPoly(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.instructions.push({action:"roundPoly",data:e}),this._dirty=!0,this}roundShape(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.instructions.push({action:"roundShape",data:e}),this._dirty=!0,this}filletRect(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.instructions.push({action:"filletRect",data:e}),this._dirty=!0,this}chamferRect(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.instructions.push({action:"chamferRect",data:e}),this._dirty=!0,this}star(t,e,r,i,n,s,a){n||(n=i/2);const o=-1*Math.PI/2+s,l=2*r,h=2*Math.PI/l,u=[];for(let c=0;c<l;c++){const r=c%2?n:i,s=c*h+o;u.push(t+r*Math.cos(s),e+r*Math.sin(s))}return this.poly(u,!0,a),this}clone(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const e=new E;if(t)for(let r=0;r<this.instructions.length;r++){const t=this.instructions[r];e.instructions.push({action:t.action,data:t.data.slice()})}else e.instructions=this.instructions.slice();return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,r=t.b,i=t.c,n=t.d,s=t.tx,a=t.ty;let o=0,l=0,h=0,u=0,c=0,f=0,p=0,g=0;for(let m=0;m<this.instructions.length;m++){const x=this.instructions[m],_=x.data;switch(x.action){case"moveTo":case"lineTo":o=_[0],l=_[1],_[0]=e*o+i*l+s,_[1]=r*o+n*l+a;break;case"bezierCurveTo":h=_[0],u=_[1],c=_[2],f=_[3],o=_[4],l=_[5],_[0]=e*h+i*u+s,_[1]=r*h+n*u+a,_[2]=e*c+i*f+s,_[3]=r*c+n*f+a,_[4]=e*o+i*l+s,_[5]=r*o+n*l+a;break;case"quadraticCurveTo":h=_[0],u=_[1],o=_[2],l=_[3],_[0]=e*h+i*u+s,_[1]=r*h+n*u+a,_[2]=e*o+i*l+s,_[3]=r*o+n*l+a;break;case"arcToSvg":o=_[5],l=_[6],p=_[0],g=_[1],_[0]=e*p+i*g,_[1]=r*p+n*g,_[5]=e*o+i*l+s,_[6]=r*o+n*l+a;break;case"circle":_[4]=G(_[3],t);break;case"rect":_[4]=G(_[4],t);break;case"ellipse":_[8]=G(_[8],t);break;case"roundRect":_[5]=G(_[5],t);break;case"addPath":_[0].transform(t);break;case"poly":_[2]=G(_[2],t);break;default:(0,d.R)("unknown transform action",x.action)}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,r=this.instructions[e];if(!r)return t.x=0,t.y=0,t;for(;"closePath"===r.action;){if(e--,e<0)return t.x=0,t.y=0,t;r=this.instructions[e]}switch(r.action){case"moveTo":case"lineTo":t.x=r.data[0],t.y=r.data[1];break;case"quadraticCurveTo":t.x=r.data[2],t.y=r.data[3];break;case"bezierCurveTo":t.x=r.data[4],t.y=r.data[5];break;case"arc":case"arcToSvg":t.x=r.data[5],t.y=r.data[6];break;case"addPath":r.data[0].getLastPoint(t)}return t}}function G(t,e){return t?t.prepend(e):e.clone()}function W(t,e){if("string"===typeof t){const e=document.createElement("div");e.innerHTML=t.trim(),t=e.querySelector("svg")}return V(t,{context:e,path:new E},null,null),e}function V(t,e,r,n){const a=t.children,{fillStyle:o,strokeStyle:l}=function(t){const e=t.getAttribute("style"),r={},i={};let n=!1,a=!1;if(e){const t=e.split(";");for(let e=0;e<t.length;e++){const o=t[e],[l,h]=o.split(":");switch(l){case"stroke":"none"!==h&&(r.color=s.Q.shared.setValue(h).toNumber(),a=!0);break;case"stroke-width":r.width=Number(h);break;case"fill":"none"!==h&&(n=!0,i.color=s.Q.shared.setValue(h).toNumber());break;case"fill-opacity":i.alpha=Number(h);break;case"stroke-opacity":r.alpha=Number(h);break;case"opacity":i.alpha=Number(h),r.alpha=Number(h)}}}else{const e=t.getAttribute("stroke");e&&"none"!==e&&(a=!0,r.color=s.Q.shared.setValue(e).toNumber(),r.width=O(t,"stroke-width",1));const o=t.getAttribute("fill");o&&"none"!==o&&(n=!0,i.color=s.Q.shared.setValue(o).toNumber())}return{strokeStyle:a?r:null,fillStyle:n?i:null}}(t);let h,u,c,d,f,p,g,m,x,_,y,v,b,S,w,T,M;switch(o&&r?r=(0,i.A)((0,i.A)({},r),o):o&&(r=o),l&&n?n=(0,i.A)((0,i.A)({},n),l):l&&(n=l),e.context.fillStyle=r,e.context.strokeStyle=n,t.nodeName.toLowerCase()){case"path":S=t.getAttribute("d"),w=new E(S),e.context.path(w),r&&e.context.fill(),n&&e.context.stroke();break;case"circle":g=O(t,"cx",0),m=O(t,"cy",0),x=O(t,"r",0),e.context.ellipse(g,m,x,x),r&&e.context.fill(),n&&e.context.stroke();break;case"rect":h=O(t,"x",0),u=O(t,"y",0),T=O(t,"width",0),M=O(t,"height",0),_=O(t,"rx",0),y=O(t,"ry",0),_||y?e.context.roundRect(h,u,T,M,_||y):e.context.rect(h,u,T,M),r&&e.context.fill(),n&&e.context.stroke();break;case"ellipse":g=O(t,"cx",0),m=O(t,"cy",0),_=O(t,"rx",0),y=O(t,"ry",0),e.context.beginPath(),e.context.ellipse(g,m,_,y),r&&e.context.fill(),n&&e.context.stroke();break;case"line":c=O(t,"x1",0),d=O(t,"y1",0),f=O(t,"x2",0),p=O(t,"y2",0),e.context.beginPath(),e.context.moveTo(c,d),e.context.lineTo(f,p),n&&e.context.stroke();break;case"polygon":b=t.getAttribute("points"),v=b.match(/\d+/g).map((t=>parseInt(t,10))),e.context.poly(v,!0),r&&e.context.fill(),n&&e.context.stroke();break;case"polyline":b=t.getAttribute("points"),v=b.match(/\d+/g).map((t=>parseInt(t,10))),e.context.poly(v,!1),n&&e.context.stroke();break;case"g":case"svg":break;default:console.info("[SVG parser] <".concat(t.nodeName,"> elements unsupported"))}for(let i=0;i<a.length;i++)V(a[i],e,r,n)}function O(t,e,r){const i=t.getAttribute(e);return i?Number(i):r}var D=r(84839);const L=new o.b,H=new a.u,j=class t extends n.A{constructor(){super(...arguments),this.uid=(0,h.L)("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new E,this._transform=new a.u,this._fillStyle=(0,i.A)({},t.defaultFillStyle),this._strokeStyle=(0,i.A)({},t.defaultStrokeStyle),this._stateStack=[],this._tick=0,this._bounds=new c.c,this._boundsDirty=!0}clone(){const e=new t;return e.batchMode=this.batchMode,e.instructions=this.instructions.slice(),e._activePath=this._activePath.clone(),e._transform=this._transform.clone(),e._fillStyle=(0,i.A)({},this._fillStyle),e._strokeStyle=(0,i.A)({},this._strokeStyle),e._stateStack=this._stateStack.slice(),e._bounds=this._bounds.clone(),e._boundsDirty=!0,e}get fillStyle(){return this._fillStyle}set fillStyle(e){this._fillStyle=(0,D.w)(e,t.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(e){this._strokeStyle=(0,D.T)(e,t.defaultStrokeStyle)}setFillStyle(e){return this._fillStyle=(0,D.w)(e,t.defaultFillStyle),this}setStrokeStyle(e){return this._strokeStyle=(0,D.w)(e,t.defaultStrokeStyle),this}texture(t,e,r,i,n,a){return this.instructions.push({action:"texture",data:{image:t,dx:r||0,dy:i||0,dw:n||t.frame.width,dh:a||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e?s.Q.shared.setValue(e).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new E,this}fill(e,r){let i;const n=this.instructions[this.instructions.length-1];return i=0===this._tick&&n&&"stroke"===n.action?n.data.path:this._activePath.clone(),i?(null!=e&&(void 0!==r&&"number"===typeof e&&((0,u.t6)(u.lj,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),e={color:e,alpha:r}),this._fillStyle=(0,D.w)(e,t.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:i}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(o.b.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(e){let r;const i=this.instructions[this.instructions.length-1];return r=0===this._tick&&i&&"fill"===i.action?i.data.path:this._activePath.clone(),r?(null!=e&&(this._strokeStyle=(0,D.T)(e,t.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:r}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],r=this._activePath.clone();if(e&&("stroke"===e.action||"fill"===e.action)){if(!e.data.hole){e.data.hole=r;break}e.data.hole.addPath(r)}}return this._initNextPathLocation(),this}arc(t,e,r,i,n,s){this._tick++;const a=this._transform;return this._activePath.arc(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,r,i,n,s),this}arcTo(t,e,r,i,n){this._tick++;const s=this._transform;return this._activePath.arcTo(s.a*t+s.c*e+s.tx,s.b*t+s.d*e+s.ty,s.a*r+s.c*i+s.tx,s.b*r+s.d*i+s.ty,n),this}arcToSvg(t,e,r,i,n,s,a){this._tick++;const o=this._transform;return this._activePath.arcToSvg(t,e,r,i,n,o.a*s+o.c*a+o.tx,o.b*s+o.d*a+o.ty),this}bezierCurveTo(t,e,r,i,n,s,a){this._tick++;const o=this._transform;return this._activePath.bezierCurveTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*r+o.c*i+o.tx,o.b*r+o.d*i+o.ty,o.a*n+o.c*s+o.tx,o.b*n+o.d*s+o.ty,a),this}closePath(){var t;return this._tick++,null===(t=this._activePath)||void 0===t||t.closePath(),this}ellipse(t,e,r,i){return this._tick++,this._activePath.ellipse(t,e,r,i,this._transform.clone()),this}circle(t,e,r){return this._tick++,this._activePath.circle(t,e,r,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const r=this._transform;return this._activePath.lineTo(r.a*t+r.c*e+r.tx,r.b*t+r.d*e+r.ty),this}moveTo(t,e){this._tick++;const r=this._transform,i=this._activePath.instructions,n=r.a*t+r.c*e+r.tx,s=r.b*t+r.d*e+r.ty;return 1===i.length&&"moveTo"===i[0].action?(i[0].data[0]=n,i[0].data[1]=s,this):(this._activePath.moveTo(n,s),this)}quadraticCurveTo(t,e,r,i,n){this._tick++;const s=this._transform;return this._activePath.quadraticCurveTo(s.a*t+s.c*e+s.tx,s.b*t+s.d*e+s.ty,s.a*r+s.c*i+s.tx,s.b*r+s.d*i+s.ty,n),this}rect(t,e,r,i){return this._tick++,this._activePath.rect(t,e,r,i,this._transform.clone()),this}roundRect(t,e,r,i,n){return this._tick++,this._activePath.roundRect(t,e,r,i,n,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5?arguments[5]:void 0;return this._tick++,this._activePath.regularPoly(t,e,r,i,n,s),this}roundPoly(t,e,r,i,n,s){return this._tick++,this._activePath.roundPoly(t,e,r,i,n,s),this}roundShape(t,e,r,i){return this._tick++,this._activePath.roundShape(t,e,r,i),this}filletRect(t,e,r,i,n){return this._tick++,this._activePath.filletRect(t,e,r,i,n),this}chamferRect(t,e,r,i,n,s){return this._tick++,this._activePath.chamferRect(t,e,r,i,n,s),this}star(t,e,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._tick++,this._activePath.star(t,e,r,i,n,s,this._transform.clone()),this}svg(t){return this._tick++,W(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:(0,i.A)({},this._fillStyle),strokeStyle:(0,i.A)({},this._strokeStyle)}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return this._transform.scale(t,e),this}setTransform(t,e,r,i,n,s){return t instanceof a.u?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,r,i,n,s),this)}transform(t,e,r,i,n,s){return t instanceof a.u?(this._transform.append(t),this):(H.set(t,e,r,i,n,s),this._transform.append(H),this)}translate(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this.dirty||(this.emit("update",this,16),this.dirty=!0,this._boundsDirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const r=this.instructions[e],i=r.action;if("fill"===i){const e=r.data;t.addBounds(e.path.bounds)}else if("texture"===i){const e=r.data;t.addFrame(e.dx,e.dy,e.dx+e.dw,e.dy+e.dh,e.transform)}if("stroke"===i){const e=r.data,i=e.style.alignment,n=e.style.width*(1-i),s=e.path.bounds;t.addFrame(s.minX-n,s.minY-n,s.maxX+n,s.maxY+n)}}return t}containsPoint(t){if(!this.bounds.containsPoint(t.x,t.y))return!1;const e=this.instructions;let r=!1;for(let n=0;n<e.length;n++){const s=e[n],a=s.data,o=a.path;if(!s.action||!o)continue;const l=a.style,h=o.shapePath.shapePrimitives;for(let e=0;e<h.length;e++){const n=h[e].shape;if(!l||!n)continue;const o=h[e].transform,u=o?o.applyInverse(t,L):t;if("fill"===s.action)r=n.contains(u.x,u.y);else{const t=l;r=n.strokeContains(u.x,u.y,t.width,t.alignment)}const c=a.hole;if(c){var i;const t=null===(i=c.shapePath)||void 0===i?void 0:i.shapePrimitives;if(t)for(let e=0;e<t.length;e++)t[e].shape.contains(u.x,u.y)&&(r=!1)}if(r)return!0}}return r}destroy(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners();if("boolean"===typeof t?t:null===t||void 0===t?void 0:t.texture){const e="boolean"===typeof t?t:null===t||void 0===t?void 0:t.textureSource;this._fillStyle.texture&&this._fillStyle.texture.destroy(e),this._strokeStyle.texture&&this._strokeStyle.texture.destroy(e)}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};j.defaultFillStyle={color:16777215,alpha:1,texture:l.g.WHITE,matrix:null,fill:null},j.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:l.g.WHITE,matrix:null,fill:null,pixelLine:!1};let X=j},55535:(t,e,r)=>{"use strict";r.d(e,{GH:()=>dt});var i=r(91478),n=r(2590),s=r(7663),a=r(94719);const o={};function l(t,e){let r=2166136261;for(let i=0;i<e;i++)r^=t[i].uid,r=Math.imul(r,16777619),r>>>=0;return o[r]||function(t,e,r){const i={};let l=0;h||(h=(0,a.a)());for(let n=0;n<h;n++){const r=n<e?t[n]:s.g.EMPTY.source;i[l++]=r.source,i[l++]=r.style}const u=new n.T(i);return o[r]=u,u}(t,e,r)}let h=0;var u=r(89379),c=r(42026),d=r(81013);function f(t,e){const r=t.byteLength/8|0,i=new Float64Array(t,0,r);new Float64Array(e,0,r).set(i);const n=t.byteLength-8*r;if(n>0){const i=new Uint8Array(t,8*r,n);new Uint8Array(e,8*r,n).set(i)}}var p=r(77820);class g{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let t=0;t<this.count;t++){const e=this.textures[t];this.textures[t]=null,this.ids[e.uid]=null}this.count=0}}class m{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new g,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}const x=[];let _=0;function y(){return _>0?x[--_]:new m}function v(t){x[_++]=t}let b=0;const S=class t{constructor(){var e;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.uid=(0,c.L)("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],t.defaultOptions.maxTextures=null!==(e=t.defaultOptions.maxTextures)&&void 0!==e?e:(0,a.a)(),r=(0,u.A)((0,u.A)({},t.defaultOptions),r);const{maxTextures:i,attributesInitialSize:n,indicesInitialSize:s}=r;this.attributeBuffer=new d.u(4*n),this.indexBuffer=new Uint16Array(s),this.maxTextures=i}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let t=0;t<this.batchIndex;t++)v(this.batches[t]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(t){this._elements[this.elementSize++]=t,t._indexStart=this.indexSize,t._attributeStart=this.attributeSize,t._batcher=this,this.indexSize+=t.indexSize,this.attributeSize+=t.attributeSize*this.vertexSize}checkAndUpdateTexture(t,e){const r=t._batch.textures.ids[e._source.uid];return!(!r&&0!==r)&&(t._textureId=r,t.texture=e,!0)}updateElement(t){this.dirty=!0;const e=this.attributeBuffer;t.packAsQuad?this.packQuadAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId):this.packAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId)}break(t){const e=this._elements;if(!e[this.elementStart])return;let r=y(),i=r.textures;i.clear();const n=e[this.elementStart];let s=(0,p.i)(n.blendMode,n.texture._source),a=n.topology;4*this.attributeSize>this.attributeBuffer.size&&this._resizeAttributeBuffer(4*this.attributeSize),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const o=this.attributeBuffer.float32View,l=this.attributeBuffer.uint32View,h=this.indexBuffer;let u=this._batchIndexSize,c=this._batchIndexStart,d="startBatch";const f=this.maxTextures;for(let g=this.elementStart;g<this.elementSize;++g){const n=e[g];e[g]=null;const m=n.texture._source,x=(0,p.i)(n.blendMode,m),_=s!==x||a!==n.topology;m._batchTick!==b||_?(m._batchTick=b,(i.count>=f||_)&&(this._finishBatch(r,c,u-c,i,s,a,t,d),d="renderBatch",c=u,s=x,a=n.topology,r=y(),i=r.textures,i.clear(),++b),n._textureId=m._textureBindLocation=i.count,i.ids[m.uid]=i.count,i.textures[i.count++]=m,n._batch=r,u+=n.indexSize,n.packAsQuad?(this.packQuadAttributes(n,o,l,n._attributeStart,n._textureId),this.packQuadIndex(h,n._indexStart,n._attributeStart/this.vertexSize)):(this.packAttributes(n,o,l,n._attributeStart,n._textureId),this.packIndex(n,h,n._indexStart,n._attributeStart/this.vertexSize))):(n._textureId=m._textureBindLocation,u+=n.indexSize,n.packAsQuad?(this.packQuadAttributes(n,o,l,n._attributeStart,n._textureId),this.packQuadIndex(h,n._indexStart,n._attributeStart/this.vertexSize)):(this.packAttributes(n,o,l,n._attributeStart,n._textureId),this.packIndex(n,h,n._indexStart,n._attributeStart/this.vertexSize)),n._batch=r)}i.count>0&&(this._finishBatch(r,c,u-c,i,s,a,t,d),c=u,++b),this.elementStart=this.elementSize,this._batchIndexStart=c,this._batchIndexSize=u}_finishBatch(t,e,r,i,n,s,a,o){t.gpuBindGroup=null,t.bindGroup=null,t.action=o,t.batcher=this,t.textures=i,t.blendMode=n,t.topology=s,t.start=e,t.size=r,++b,this.batches[this.batchIndex++]=t,a.add(t)}finish(t){this.break(t)}ensureAttributeBuffer(t){4*t<=this.attributeBuffer.size||this._resizeAttributeBuffer(4*t)}ensureIndexBuffer(t){t<=this.indexBuffer.length||this._resizeIndexBuffer(t)}_resizeAttributeBuffer(t){const e=Math.max(t,2*this.attributeBuffer.size),r=new d.u(e);f(this.attributeBuffer.rawBinaryData,r.rawBinaryData),this.attributeBuffer=r}_resizeIndexBuffer(t){const e=this.indexBuffer;let r=Math.max(t,1.5*e.length);r+=r%2;const i=r>65535?new Uint32Array(r):new Uint16Array(r);if(i.BYTES_PER_ELEMENT!==e.BYTES_PER_ELEMENT)for(let n=0;n<e.length;n++)i[n]=e[n];else f(e.buffer,i.buffer);this.indexBuffer=i}packQuadIndex(t,e,r){t[e]=r+0,t[e+1]=r+1,t[e+2]=r+2,t[e+3]=r+0,t[e+4]=r+2,t[e+5]=r+3}packIndex(t,e,r,i){const n=t.indices,s=t.indexSize,a=t.indexOffset,o=t.attributeOffset;for(let l=0;l<s;l++)e[r++]=i+n[l+a]-o}destroy(){for(let t=0;t<this.batches.length;t++)v(this.batches[t]);this.batches=null;for(let t=0;t<this._elements.length;t++)this._elements[t]._batch=null;this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}};S.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let w=S;var T=r(95202),M=r(96333),P=r(69801);const C=new Float32Array(1),A=new Uint32Array(1);class k extends P.V{constructor(){const t=new T.h({data:C,label:"attribute-batch-buffer",usage:M.S.VERTEX|M.S.COPY_DST,shrinkToFit:!1});super({attributes:{aPosition:{buffer:t,format:"float32x2",stride:24,offset:0},aUV:{buffer:t,format:"float32x2",stride:24,offset:8},aColor:{buffer:t,format:"unorm8x4",stride:24,offset:16},aTextureIdAndRound:{buffer:t,format:"uint16x2",stride:24,offset:20}},indexBuffer:new T.h({data:A,label:"index-batch-buffer",usage:M.S.INDEX|M.S.COPY_DST,shrinkToFit:!1})})}}var B=r(89569),R=r(63144),z=r(21193),U=r(84994),F=r(59963),I=r(53636);class E extends I.M{constructor(t){super({glProgram:(0,B.I)({name:"batch",bits:[R.a,(0,z.P)(t),U.m]}),gpuProgram:(0,B.v)({name:"batch",bits:[R.F,(0,z._)(t),U.b]}),resources:{batchSamplers:(0,F.n)(t)}})}}let G=null;const W=class t extends w{constructor(){super(...arguments),this.geometry=new k,this.shader=G||(G=new E(this.maxTextures)),this.name=t.extension.name,this.vertexSize=6}packAttributes(t,e,r,i,n){const s=n<<16|65535&t.roundPixels,a=t.transform,o=a.a,l=a.b,h=a.c,u=a.d,c=a.tx,d=a.ty,{positions:f,uvs:p}=t,g=t.color,m=t.attributeOffset,x=m+t.attributeSize;for(let _=m;_<x;_++){const t=2*_,n=f[t],a=f[t+1];e[i++]=o*n+h*a+c,e[i++]=u*a+l*n+d,e[i++]=p[t],e[i++]=p[t+1],r[i++]=g,r[i++]=s}}packQuadAttributes(t,e,r,i,n){const s=t.texture,a=t.transform,o=a.a,l=a.b,h=a.c,u=a.d,c=a.tx,d=a.ty,f=t.bounds,p=f.maxX,g=f.minX,m=f.maxY,x=f.minY,_=s.uvs,y=t.color,v=n<<16|65535&t.roundPixels;e[i+0]=o*g+h*x+c,e[i+1]=u*x+l*g+d,e[i+2]=_.x0,e[i+3]=_.y0,r[i+4]=y,r[i+5]=v,e[i+6]=o*p+h*x+c,e[i+7]=u*x+l*p+d,e[i+8]=_.x1,e[i+9]=_.y1,r[i+10]=y,r[i+11]=v,e[i+12]=o*p+h*m+c,e[i+13]=u*m+l*p+d,e[i+14]=_.x2,e[i+15]=_.y2,r[i+16]=y,r[i+17]=v,e[i+18]=o*g+h*m+c,e[i+19]=u*m+l*g+d,e[i+20]=_.x3,e[i+21]=_.y3,r[i+22]=y,r[i+23]=v}};W.extension={type:[i.Ag.Batcher],name:"default"};let V=W;var O=r(80347),D=r(14811),L=r(69769),H=r(44307);function j(t,e,r,i,n){const s=e.a,a=e.b,o=e.c,l=e.d,h=e.tx,u=e.ty;r||(r=0),i||(i=2),n||(n=t.length/i-r);let c=r*i;for(let d=0;d<n;d++){const e=t[c],r=t[c+1];t[c]=s*e+o*r+h,t[c+1]=a*e+l*r+u,c+=i}}var X=r(69211);const N={extension:{type:i.Ag.ShapeBuilder,name:"circle"},build(t,e){let r,i,n,s,a,o;if("circle"===t.type){const e=t;r=e.x,i=e.y,a=o=e.radius,n=s=0}else if("ellipse"===t.type){const e=t;r=e.x,i=e.y,a=e.halfWidth,o=e.halfHeight,n=s=0}else{const e=t,l=e.width/2,h=e.height/2;r=e.x+l,i=e.y+h,a=o=Math.max(0,Math.min(e.radius,Math.min(l,h))),n=l-a,s=h-o}if(!(a>=0&&o>=0&&n>=0&&s>=0))return e;const l=Math.ceil(2.3*Math.sqrt(a+o)),h=8*l+(n?4:0)+(s?4:0);if(0===h)return e;if(0===l)return e[0]=e[6]=r+n,e[1]=e[3]=i+s,e[2]=e[4]=r-n,e[5]=e[7]=i-s,e;let u=0,c=4*l+(n?2:0)+2,d=c,f=h,p=n+a,g=s,m=r+p,x=r-p,_=i+g;if(e[u++]=m,e[u++]=_,e[--c]=_,e[--c]=x,s){const t=i-g;e[d++]=x,e[d++]=t,e[--f]=t,e[--f]=m}for(let v=1;v<l;v++){const t=Math.PI/2*(v/l),h=n+Math.cos(t)*a,p=s+Math.sin(t)*o,g=r+h,m=r-h,x=i+p,_=i-p;e[u++]=g,e[u++]=x,e[--c]=x,e[--c]=m,e[d++]=m,e[d++]=_,e[--f]=_,e[--f]=g}p=n,g=s+o,m=r+p,x=r-p,_=i+g;const y=i-g;return e[u++]=m,e[u++]=_,e[--f]=y,e[--f]=m,n&&(e[u++]=x,e[u++]=_,e[--f]=y,e[--f]=x),e},triangulate(t,e,r,i,n,s){if(0===t.length)return;let a=0,o=0;for(let u=0;u<t.length;u+=2)a+=t[u],o+=t[u+1];a/=t.length/2,o/=t.length/2;let l=i;e[l*r]=a,e[l*r+1]=o;const h=l++;for(let u=0;u<t.length;u+=2)e[l*r]=t[u],e[l*r+1]=t[u+1],u>0&&(n[s++]=l,n[s++]=h,n[s++]=l-1),l++;n[s++]=h+1,n[s++]=h,n[s++]=l-1}},Y=(0,u.A)((0,u.A)({},N),{},{extension:(0,u.A)((0,u.A)({},N.extension),{},{name:"ellipse"})}),K=(0,u.A)((0,u.A)({},N),{},{extension:(0,u.A)((0,u.A)({},N.extension),{},{name:"roundedRectangle"})});var q=r(31960);const Q=1e-4;function Z(t,e,r,i,n,s,a,o){let l,h;a?(l=i,h=-r):(l=-i,h=r);const u=t-r*n+l,c=e-i*n+h,d=t+r*s+l,f=e+i*s+h;return o.push(u,c),o.push(d,f),2}function J(t,e,r,i,n,s,a,o){const l=r-t,h=i-e;let u=Math.atan2(l,h),c=Math.atan2(n-t,s-e);o&&u<c?u+=2*Math.PI:!o&&u>c&&(c+=2*Math.PI);let d=u;const f=c-u,p=Math.abs(f),g=Math.sqrt(l*l+h*h),m=1+(15*p*Math.sqrt(g)/Math.PI|0),x=f/m;if(d+=x,o){a.push(t,e),a.push(r,i);for(let r=1,i=d;r<m;r++,i+=x)a.push(t,e),a.push(t+Math.sin(i)*g,e+Math.cos(i)*g);a.push(t,e),a.push(n,s)}else{a.push(r,i),a.push(t,e);for(let r=1,i=d;r<m;r++,i+=x)a.push(t+Math.sin(i)*g,e+Math.cos(i)*g),a.push(t,e);a.push(n,s),a.push(t,e)}return 2*m}var $=r(10973);function tt(t,e,r,i,n,s,a){const o=$(t,e,2);if(!o)return;for(let h=0;h<o.length;h+=3)s[a++]=o[h]+n,s[a++]=o[h+1]+n,s[a++]=o[h+2]+n;let l=n*i;for(let h=0;h<t.length;h+=2)r[l]=t[h],r[l+1]=t[h+1],l+=i}const et=[],rt={extension:{type:i.Ag.ShapeBuilder,name:"polygon"},build(t,e){for(let r=0;r<t.points.length;r++)e[r]=t.points[r];return e},triangulate(t,e,r,i,n,s){tt(t,et,e,r,i,n,s)}},it={extension:{type:i.Ag.ShapeBuilder,name:"rectangle"},build(t,e){const r=t,i=r.x,n=r.y,s=r.width,a=r.height;return s>=0&&a>=0?(e[0]=i,e[1]=n,e[2]=i+s,e[3]=n,e[4]=i+s,e[5]=n+a,e[6]=i,e[7]=n+a,e):e},triangulate(t,e,r,i,n,s){let a=0;e[(i*=r)+a]=t[0],e[i+a+1]=t[1],a+=r,e[i+a]=t[2],e[i+a+1]=t[3],a+=r,e[i+a]=t[6],e[i+a+1]=t[7],a+=r,e[i+a]=t[4],e[i+a+1]=t[5],a+=r;const o=i/r;n[s++]=o,n[s++]=o+1,n[s++]=o+2,n[s++]=o+1,n[s++]=o+3,n[s++]=o+2}},nt={extension:{type:i.Ag.ShapeBuilder,name:"triangle"},build:(t,e)=>(e[0]=t.x,e[1]=t.y,e[2]=t.x2,e[3]=t.y2,e[4]=t.x3,e[5]=t.y3,e),triangulate(t,e,r,i,n,s){let a=0;e[(i*=r)+a]=t[0],e[i+a+1]=t[1],a+=r,e[i+a]=t[2],e[i+a+1]=t[3],a+=r,e[i+a]=t[4],e[i+a+1]=t[5];const o=i/r;n[s++]=o,n[s++]=o+1,n[s++]=o+2}},st={};i.XO.handleByMap(i.Ag.ShapeBuilder,st),i.XO.add(it,rt,nt,N,Y,K);const at=new H.M;function ot(t,e,r){const{vertices:i,uvs:n,indices:s}=r,a=s.length,o=i.length/2,l=[],h=st.rectangle,u=at,c=t.image;u.x=t.dx,u.y=t.dy,u.width=t.dw,u.height=t.dh;const d=t.transform;h.build(u,l),d&&j(l,d),h.triangulate(l,i,2,o,s,a);const f=c.uvs;n.push(f.x0,f.y0,f.x1,f.y1,f.x3,f.y3,f.x2,f.y2);const p=L.Z.get(X.G);p.indexOffset=a,p.indexSize=s.length-a,p.attributeOffset=o,p.attributeSize=i.length/2-o,p.baseColor=t.style,p.alpha=t.alpha,p.texture=c,p.geometryData=r,e.push(p)}function lt(t,e,r,i,n,a){const{vertices:o,uvs:l,indices:h}=a,u=t.shapePrimitives.length-1;t.shapePrimitives.forEach(((t,c)=>{let{shape:d,transform:f}=t;const p=h.length,g=o.length/2,m=[],x=st[d.type];let _="triangle-list";if(x.build(d,m),f&&j(m,f),i){var y;const t=null===(y=d.closePath)||void 0===y||y,r=e;r.pixelLine?(!function(t,e,r,i){const n=Q;if(0===t.length)return;const s=t[0],a=t[1],o=t[t.length-2],l=t[t.length-1],h=e||Math.abs(s-o)<n&&Math.abs(a-l)<n,u=r,c=t.length/2,d=u.length/2;for(let f=0;f<c;f++)u.push(t[2*f]),u.push(t[2*f+1]);for(let f=0;f<c-1;f++)i.push(d+f,d+f+1);h&&i.push(d+c-1,d)}(m,t,o,h),_="line-list"):function(t,e,r,i,n,s){const a=Q;if(0===t.length)return;const o=e;let l=o.alignment;if(.5!==e.alignment){let e=function(t){const e=t.length;if(e<6)return 1;let r=0;for(let i=0,n=t[e-2],s=t[e-1];i<e;i+=2){const e=t[i],a=t[i+1];r+=(e-n)*(a+s),n=e,s=a}return r<0?-1:1}(t);r&&(e*=-1),l=(l-.5)*e+.5}const h=new q.b(t[0],t[1]),u=new q.b(t[t.length-2],t[t.length-1]),c=i,d=Math.abs(h.x-u.x)<a&&Math.abs(h.y-u.y)<a;if(c){t=t.slice(),d&&(t.pop(),t.pop(),u.set(t[t.length-2],t[t.length-1]));const e=.5*(h.x+u.x),r=.5*(u.y+h.y);t.unshift(e,r),t.push(e,r)}const f=n,p=t.length/2;let g=t.length;const m=f.length/2,x=o.width/2,_=x*x,y=o.miterLimit*o.miterLimit;let v=t[0],b=t[1],S=t[2],w=t[3],T=0,M=0,P=-(b-w),C=v-S,A=0,k=0,B=Math.sqrt(P*P+C*C);P/=B,C/=B,P*=x,C*=x;const R=2*(1-l),z=2*l;c||("round"===o.cap?g+=J(v-P*(R-z)*.5,b-C*(R-z)*.5,v-P*R,b-C*R,v+P*z,b+C*z,f,!0)+2:"square"===o.cap&&(g+=Z(v,b,P,C,R,z,!0,f))),f.push(v-P*R,b-C*R),f.push(v+P*z,b+C*z);for(let U=1;U<p-1;++U){v=t[2*(U-1)],b=t[2*(U-1)+1],S=t[2*U],w=t[2*U+1],T=t[2*(U+1)],M=t[2*(U+1)+1],P=-(b-w),C=v-S,B=Math.sqrt(P*P+C*C),P/=B,C/=B,P*=x,C*=x,A=-(w-M),k=S-T,B=Math.sqrt(A*A+k*k),A/=B,k/=B,A*=x,k*=x;const e=S-v,r=b-w,i=S-T,n=M-w,s=e*i+r*n,a=r*i-n*e,l=a<0;if(Math.abs(a)<.001*Math.abs(s)){f.push(S-P*R,w-C*R),f.push(S+P*z,w+C*z),s>=0&&("round"===o.join?g+=J(S,w,S-P*R,w-C*R,S-A*R,w-k*R,f,!1)+4:g+=2,f.push(S-A*z,w-k*z),f.push(S+A*R,w+k*R));continue}const h=(-P+v)*(-C+w)-(-P+S)*(-C+b),u=(-A+T)*(-k+w)-(-A+S)*(-k+M),c=(e*u-i*h)/a,d=(n*h-r*u)/a,p=(c-S)*(c-S)+(d-w)*(d-w),m=S+(c-S)*R,F=w+(d-w)*R,I=S-(c-S)*z,E=w-(d-w)*z,G=l?R:z;p<=Math.min(e*e+r*r,i*i+n*n)+G*G*_?"bevel"===o.join||p/_>y?(l?(f.push(m,F),f.push(S+P*z,w+C*z),f.push(m,F),f.push(S+A*z,w+k*z)):(f.push(S-P*R,w-C*R),f.push(I,E),f.push(S-A*R,w-k*R),f.push(I,E)),g+=2):"round"===o.join?l?(f.push(m,F),f.push(S+P*z,w+C*z),g+=J(S,w,S+P*z,w+C*z,S+A*z,w+k*z,f,!0)+4,f.push(m,F),f.push(S+A*z,w+k*z)):(f.push(S-P*R,w-C*R),f.push(I,E),g+=J(S,w,S-P*R,w-C*R,S-A*R,w-k*R,f,!1)+4,f.push(S-A*R,w-k*R),f.push(I,E)):(f.push(m,F),f.push(I,E)):(f.push(S-P*R,w-C*R),f.push(S+P*z,w+C*z),"round"===o.join?g+=l?J(S,w,S+P*z,w+C*z,S+A*z,w+k*z,f,!0)+2:J(S,w,S-P*R,w-C*R,S-A*R,w-k*R,f,!1)+2:"miter"===o.join&&p/_<=y&&(l?(f.push(I,E),f.push(I,E)):(f.push(m,F),f.push(m,F)),g+=2),f.push(S-A*R,w-k*R),f.push(S+A*z,w+k*z),g+=2)}v=t[2*(p-2)],b=t[2*(p-2)+1],S=t[2*(p-1)],w=t[2*(p-1)+1],P=-(b-w),C=v-S,B=Math.sqrt(P*P+C*C),P/=B,C/=B,P*=x,C*=x,f.push(S-P*R,w-C*R),f.push(S+P*z,w+C*z),c||("round"===o.cap?g+=J(S-P*(R-z)*.5,w-C*(R-z)*.5,S-P*R,w-C*R,S+P*z,w+C*z,f,!1)+2:"square"===o.cap&&(g+=Z(S,w,P,C,R,z,!1,f)));for(let U=m;U<g+m-2;++U)v=f[2*U],b=f[2*U+1],S=f[2*(U+1)],w=f[2*(U+1)+1],T=f[2*(U+2)],M=f[2*(U+2)+1],Math.abs(v*(w-M)+S*(M-b)+T*(b-w))<1e-8||s.push(U,U+1,U+2)}(m,r,!1,t,o,h)}else if(r&&u===c){0!==u&&console.warn("[Pixi Graphics] only the last shape have be cut out");const t=[],e=m.slice(),i=function(t){if(!t)return[];const e=t.shapePrimitives,r=[];for(let i=0;i<e.length;i++){const t=e[i].shape,n=[];st[t.type].build(t,n),r.push(n)}return r}(r.shapePath);i.forEach((r=>{t.push(e.length/2),e.push(...r)})),tt(e,t,o,2,g,h,p)}else x.triangulate(m,o,2,g,h,p);const v=l.length/2,b=e.texture;if(b!==s.g.WHITE){const t=e.matrix;t&&(f&&t.append(f.clone().invert()),function(t,e,r,i,n,s,a){let o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=0;r*=e,n*=s;const h=o.a,u=o.b,c=o.c,d=o.d,f=o.tx,p=o.ty;for(;l<a;){const a=t[r],o=t[r+1];i[n]=h*a+c*o+f,i[n+1]=u*a+d*o+p,n+=s,r+=e,l++}}(o,2,g,l,v,2,o.length/2-g,t))}else!function(t,e,r,i){let n=0;for(e*=r;n<i;)t[e]=0,t[e+1]=0,e+=r,n++}(l,v,2,o.length/2-g);const S=L.Z.get(X.G);S.indexOffset=p,S.indexSize=h.length-p,S.attributeOffset=g,S.attributeSize=o.length/2-g,S.baseColor=e.color,S.alpha=e.alpha,S.texture=b,S.geometryData=a,S.topology=_,n.push(S)}))}class ht{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class ut{constructor(){this.batcher=new V,this.instructions=new O.L}init(){this.instructions.reset()}get geometry(){return(0,D.t6)(D.Ek,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}}const ct=class t{constructor(t){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),t.renderableGC.addManagedHash(this,"_gpuContextHash"),t.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(e){var r;t.defaultOptions.bezierSmoothness=null!==(r=null===e||void 0===e?void 0:e.bezierSmoothness)&&void 0!==r?r:t.defaultOptions.bezierSmoothness}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){let e=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){e?this._cleanGraphicsContextData(t):e=this._initContext(t),function(t,e){const{geometryData:r,batches:i}=e;i.length=0,r.indices.length=0,r.vertices.length=0,r.uvs.length=0;for(let n=0;n<t.instructions.length;n++){const e=t.instructions[n];if("texture"===e.action)ot(e.data,i,r);else if("fill"===e.action||"stroke"===e.action){const t="stroke"===e.action,n=e.data.path.shapePath,s=e.data.style,a=e.data.hole;t&&a&&lt(a.shapePath,s,null,!0,i,r),lt(n,s,a,t,i,r)}}}(t,e);const r=t.batchMode;t.customShader||"no-batch"===r?e.isBatchable=!1:"auto"===r&&(e.isBatchable=e.geometryData.vertices.length<400),t.dirty=!1}return e}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_initContextRenderData(t){const e=L.Z.get(ut),{batches:r,geometryData:i}=this._gpuContextHash[t.uid],n=i.vertices.length,s=i.indices.length;for(let l=0;l<r.length;l++)r[l].applyTransform=!1;const a=e.batcher;a.ensureAttributeBuffer(n),a.ensureIndexBuffer(s),a.begin();for(let l=0;l<r.length;l++){const t=r[l];a.add(t)}a.finish(e.instructions);const o=a.geometry;o.indexBuffer.setDataWithSize(a.indexBuffer,a.indexSize,!0),o.buffers[0].setDataWithSize(a.attributeBuffer.float32View,a.attributeSize,!0);const h=a.batches;for(let u=0;u<h.length;u++){const t=h[u];t.bindGroup=l(t.textures.textures,t.textures.count)}return this._graphicsDataContextHash[t.uid]=e,e}_initContext(t){const e=new ht;return e.context=t,this._gpuContextHash[t.uid]=e,t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(t){const e=this._gpuContextHash[t.uid];e.isBatchable||this._graphicsDataContextHash[t.uid]&&(L.Z.return(this.getContextRenderData(t)),this._graphicsDataContextHash[t.uid]=null),e.batches&&e.batches.forEach((t=>{L.Z.return(t)}))}destroy(){for(const t in this._gpuContextHash)this._gpuContextHash[t]&&this.onGraphicsContextDestroy(this._gpuContextHash[t].context)}};ct.extension={type:[i.Ag.WebGLSystem,i.Ag.WebGPUSystem,i.Ag.CanvasSystem],name:"graphicsContext"},ct.defaultOptions={bezierSmoothness:.5};let dt=ct},34325:(t,e,r)=>{"use strict";r.d(e,{_:()=>u});var i=r(75242),n=r(23144),s=r(33596),a=r(33682),o=r(7663),l=r(42026);const h=class t{constructor(t,e,r,i){this.uid=(0,l.L)("fillGradient"),this.type="linear",this.gradientStops=[],this._styleKey=null,this.x0=t,this.y0=e,this.x1=r,this.y1=i}addColorStop(t,e){return this.gradientStops.push({offset:t,color:i.Q.shared.setValue(e).toHexa()}),this._styleKey=null,this}buildLinearGradient(){if(this.texture)return;const e=t.defaultTextureSize,{gradientStops:r}=this,i=n.e.get().createCanvas();i.width=e,i.height=e;const l=i.getContext("2d"),h=l.createLinearGradient(0,0,t.defaultTextureSize,1);for(let t=0;t<r.length;t++){const e=r[t];h.addColorStop(e.offset,e.color)}l.fillStyle=h,l.fillRect(0,0,e,e),this.texture=new o.g({source:new a.b({resource:i,addressModeU:"clamp-to-edge",addressModeV:"repeat"})});const{x0:u,y0:c,x1:d,y1:f}=this,p=new s.u,g=d-u,m=f-c,x=Math.sqrt(g*g+m*m),_=Math.atan2(m,g);p.translate(-u,-c),p.scale(1/e,1/e),p.rotate(-_),p.scale(256/x,1),this.transform=p,this._styleKey=null}get styleKey(){if(this._styleKey)return this._styleKey;const t=this.gradientStops.map((t=>"".concat(t.offset,"-").concat(t.color))).join("-"),e=this.texture.uid,r=this.transform.toArray().join("-");return"fill-gradient-".concat(this.uid,"-").concat(t,"-").concat(e,"-").concat(r,"-").concat(this.x0,"-").concat(this.y0,"-").concat(this.x1,"-").concat(this.y1)}};h.defaultTextureSize=256;let u=h},41201:(t,e,r)=>{"use strict";r.d(e,{m:()=>a});var i=r(33596),n=r(42026);const s={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class a{constructor(t,e){this.uid=(0,n.L)("fillPattern"),this.transform=new i.u,this._styleKey=null,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=s[e].addressModeU,t.source.style.addressModeV=s[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._styleKey=null}get styleKey(){return this._styleKey||(this._styleKey="fill-pattern-".concat(this.uid,"-").concat(this.texture.uid,"-").concat(this.transform.toArray().join("-"))),this._styleKey}}},84839:(t,e,r)=>{"use strict";r.d(e,{T:()=>m,w:()=>g});var i=r(80045),n=r(89379),s=r(75242),a=r(33596),o=r(7663),l=r(34325),h=r(41201);const u=["width","alignment","miterLimit","cap","join","pixelLine"];function c(t){return t instanceof h.m}function d(t){return t instanceof l._}function f(t,e,r){return t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,(0,n.A)((0,n.A)({},r),t)}function p(t,e,r){return e.buildLinearGradient(),t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,(0,n.A)((0,n.A)({},r),t)}function g(t,e){if(void 0===t||null===t)return null;const r={},i=t;return function(t){return s.Q.isColorLike(t)}(t)?function(t,e,r){const i=s.Q.shared.setValue(null!==e&&void 0!==e?e:0);return t.color=i.toNumber(),t.alpha=1===i.alpha?r.alpha:i.alpha,t.texture=o.g.WHITE,(0,n.A)((0,n.A)({},r),t)}(r,t,e):c(t)?f(r,t,e):d(t)?p(r,t,e):i.fill&&c(i.fill)?f(i,i.fill,e):i.fill&&d(i.fill)?p(i,i.fill,e):function(t,e){const r=(0,n.A)((0,n.A)({},e),t);if(r.texture){if(r.texture!==o.g.WHITE){var i;const t=(null===(i=r.matrix)||void 0===i?void 0:i.clone().invert())||new a.u;t.translate(r.texture.frame.x,r.texture.frame.y),t.scale(1/r.texture.source.width,1/r.texture.source.height),r.matrix=t}const t=r.texture.source.style;"clamp-to-edge"===t.addressMode&&(t.addressMode="repeat",t.update())}const l=s.Q.shared.setValue(r.color);return r.alpha*=l.alpha,r.color=l.toNumber(),r.matrix=r.matrix?r.matrix.clone():null,r}(i,e)}function m(t,e){const{width:r,alignment:s,miterLimit:a,cap:o,join:l,pixelLine:h}=e,c=g(t,(0,i.A)(e,u));return c?(0,n.A)({width:r,alignment:s,miterLimit:a,cap:o,join:l,pixelLine:h},c):null}},64207:(t,e,r)=>{"use strict";var i=r(91478),n=r(33596),s=r(2590),a=r(5222),o=r(77820),l=r(69769),h=r(29385),u=r(40475);class c{constructor(t,e){this.localUniforms=new a.k({uTransformMatrix:{value:new n.u,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),this.localUniformsBindGroup=new s.T({0:this.localUniforms}),this._meshDataHash=Object.create(null),this._gpuBatchableMeshHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this.renderer=t,this._adaptor=e,this._adaptor.init(),t.renderableGC.addManagedHash(this,"_gpuBatchableMeshHash"),t.renderableGC.addManagedHash(this,"_meshDataHash")}validateRenderable(t){const e=this._getMeshData(t),r=e.batched,i=t.batched;if(e.batched=i,r!==i)return!0;if(i){const r=t._geometry;if(r.indices.length!==e.indexSize||r.positions.length!==e.vertexSize)return e.indexSize=r.indices.length,e.vertexSize=r.positions.length,!0;const i=this._getBatchableMesh(t);return!i._batcher.checkAndUpdateTexture(i,t.texture)}return!1}addRenderable(t,e){const r=this.renderer.renderPipes.batch,{batched:i}=this._getMeshData(t);if(i){const i=this._getBatchableMesh(t);i.texture=t._texture,i.geometry=t._geometry,r.addToBatch(i,e)}else r.break(e),e.add(t)}updateRenderable(t){if(t.batched){const e=this._gpuBatchableMeshHash[t.uid];e.texture=t._texture,e.geometry=t._geometry,e._batcher.updateElement(e)}}destroyRenderable(t){this._meshDataHash[t.uid]=null;const e=this._gpuBatchableMeshHash[t.uid];e&&(l.Z.return(e),this._gpuBatchableMeshHash[t.uid]=null),t.off("destroyed",this._destroyRenderableBound)}execute(t){if(!t.isRenderable)return;t.state.blendMode=(0,o.i)(t.groupBlendMode,t.texture._source);const e=this.localUniforms;e.uniforms.uTransformMatrix=t.groupTransform,e.uniforms.uRound=this.renderer._roundPixels|t._roundPixels,e.update(),(0,h.V)(t.groupColorAlpha,e.uniforms.uColor,0),this._adaptor.execute(this,t)}_getMeshData(t){return this._meshDataHash[t.uid]||this._initMeshData(t)}_initMeshData(t){var e,r;return this._meshDataHash[t.uid]={batched:t.batched,indexSize:null===(e=t._geometry.indices)||void 0===e?void 0:e.length,vertexSize:null===(r=t._geometry.positions)||void 0===r?void 0:r.length},t.on("destroyed",this._destroyRenderableBound),this._meshDataHash[t.uid]}_getBatchableMesh(t){return this._gpuBatchableMeshHash[t.uid]||this._initBatchableMesh(t)}_initBatchableMesh(t){const e=l.Z.get(u.U);return e.renderable=t,e.texture=t._texture,e.transform=t.groupTransform,e.roundPixels=this.renderer._roundPixels|t._roundPixels,this._gpuBatchableMeshHash[t.uid]=e,e}destroy(){for(const t in this._gpuBatchableMeshHash)this._gpuBatchableMeshHash[t]&&l.Z.return(this._gpuBatchableMeshHash[t]);this._gpuBatchableMeshHash=null,this._meshDataHash=null,this.localUniforms=null,this.localUniformsBindGroup=null,this._adaptor.destroy(),this._adaptor=null,this.renderer=null}}c.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"mesh"},i.XO.add(c)},40475:(t,e,r)=>{"use strict";r.d(e,{U:()=>i});class i{constructor(){this.batcherName="default",this.packAsQuad=!1,this.indexOffset=0,this.attributeOffset=0,this.roundPixels=0,this._batcher=null,this._batch=null,this._uvUpdateId=-1,this._textureMatrixUpdateId=-1}get blendMode(){return this.renderable.groupBlendMode}get topology(){return this._topology||this.geometry.topology}set topology(t){this._topology=t}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.geometry=null,this._uvUpdateId=-1,this._textureMatrixUpdateId=-1}get uvs(){const t=this.geometry.getBuffer("aUV"),e=t.data;let r=e;const i=this.texture.textureMatrix;return i.isSimple||(r=this._transformedUvs,this._textureMatrixUpdateId===i._updateID&&this._uvUpdateId===t._updateID||((!r||r.length<e.length)&&(r=this._transformedUvs=new Float32Array(e.length)),this._textureMatrixUpdateId=i._updateID,this._uvUpdateId=t._updateID,i.multiplyUvs(e,r))),r}get positions(){return this.geometry.positions}get indices(){return this.geometry.indices}get color(){return this.renderable.groupColorAlpha}get groupTransform(){return this.renderable.groupTransform}get attributeSize(){return this.geometry.positions.length/2}get indexSize(){return this.geometry.indices.length}}},59859:(t,e,r)=>{"use strict";r.d(e,{u:()=>h});var i=r(89379),n=r(95202),s=r(96333),a=r(69801),o=r(14811);const l=class t extends a.V{constructor(){var e;let r=null!==(e=arguments.length<=0?void 0:arguments[0])&&void 0!==e?e:{};r instanceof Float32Array&&((0,o.t6)(o.lj,"use new MeshGeometry({ positions, uvs, indices }) instead"),r={positions:r,uvs:arguments.length<=1?void 0:arguments[1],indices:arguments.length<=2?void 0:arguments[2]}),r=(0,i.A)((0,i.A)({},t.defaultOptions),r);const a=r.positions||new Float32Array([0,0,1,0,1,1,0,1]),l=r.uvs||new Float32Array([0,0,1,0,1,1,0,1]),h=r.indices||new Uint32Array([0,1,2,0,2,3]),u=r.shrinkBuffersToFit;super({attributes:{aPosition:{buffer:new n.h({data:a,label:"attribute-mesh-positions",shrinkToFit:u,usage:s.S.VERTEX|s.S.COPY_DST}),format:"float32x2",stride:8,offset:0},aUV:{buffer:new n.h({data:l,label:"attribute-mesh-uvs",shrinkToFit:u,usage:s.S.VERTEX|s.S.COPY_DST}),format:"float32x2",stride:8,offset:0}},indexBuffer:new n.h({data:h,label:"index-mesh-buffer",shrinkToFit:u,usage:s.S.INDEX|s.S.COPY_DST}),topology:r.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(t){this.attributes.aPosition.buffer.data=t}get uvs(){return this.attributes.aUV.buffer.data}set uvs(t){this.attributes.aUV.buffer.data=t}get indices(){return this.indexBuffer.data}set indices(t){this.indexBuffer.data=t}};l.defaultOptions={topology:"triangle-list",shrinkBuffersToFit:!1};let h=l},95231:(t,e,r)=>{"use strict";var i=r(91478);class n{execute(t,e){const r=t.state,i=t.renderer,n=e.shader||t.defaultShader;n.resources.uTexture=e.texture._source,n.resources.uniforms=t.localUniforms;const s=i.gl,a=t.getBuffers(e);i.shader.bind(n),i.state.set(r),i.geometry.bind(a.geometry,n.glProgram);const o=2===a.geometry.indexBuffer.data.BYTES_PER_ELEMENT?s.UNSIGNED_SHORT:s.UNSIGNED_INT;s.drawElements(s.TRIANGLES,6*e.particleChildren.length,o,0)}}var s=r(33596),a=r(5222),o=r(77820),l=r(90576),h=r(29385),u=r(95202),c=r(96333),d=r(69801),f=r(87393),p=r(81013);function g(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r=6*t;if(r>65535?e||(e=new Uint32Array(r)):e||(e=new Uint16Array(r)),e.length!==r)throw new Error("Out buffer length is incorrect, got ".concat(e.length," and expected ").concat(r));for(let i=0,n=0;i<r;i+=6,n+=4)e[i+0]=n+0,e[i+1]=n+1,e[i+2]=n+2,e[i+3]=n+0,e[i+4]=n+2,e[i+5]=n+3;return e}function m(t,e){const r=[];r.push("\n      \n        var index = 0;\n\n        for (let i = 0; i < ps.length; ++i)\n        {\n            const p = ps[i];\n\n            ");let i=0;for(const s in t){const n=t[s];if(e!==n.dynamic)continue;r.push("offset = index + ".concat(i)),r.push(n.code);i+=(0,f.m)(n.format).stride/4}r.push("\n            index += stride * 4;\n        }\n    "),r.unshift("\n        var stride = ".concat(i,";\n    "));const n=r.join("\n");return new Function("ps","f32v","u32v",n)}class x{constructor(t){var e;this._size=0,this._generateParticleUpdateCache={};const r=this._size=null!==(e=t.size)&&void 0!==e?e:1e3,i=t.properties;let n=0,s=0;for(const u in i){const t=i[u],e=(0,f.m)(t.format);t.dynamic?s+=e.stride:n+=e.stride}this._dynamicStride=s/4,this._staticStride=n/4,this.staticAttributeBuffer=new p.u(4*r*n),this.dynamicAttributeBuffer=new p.u(4*r*s),this.indexBuffer=g(r);const a=new d.V;let o=0,l=0;this._staticBuffer=new u.h({data:new Float32Array(1),label:"static-particle-buffer",shrinkToFit:!1,usage:c.S.VERTEX|c.S.COPY_DST}),this._dynamicBuffer=new u.h({data:new Float32Array(1),label:"dynamic-particle-buffer",shrinkToFit:!1,usage:c.S.VERTEX|c.S.COPY_DST});for(const u in i){const t=i[u],e=(0,f.m)(t.format);t.dynamic?(a.addAttribute(t.attributeName,{buffer:this._dynamicBuffer,stride:4*this._dynamicStride,offset:4*o,format:t.format}),o+=e.size):(a.addAttribute(t.attributeName,{buffer:this._staticBuffer,stride:4*this._staticStride,offset:4*l,format:t.format}),l+=e.size)}a.addIndex(this.indexBuffer);const h=this.getParticleUpdate(i);this._dynamicUpload=h.dynamicUpdate,this._staticUpload=h.staticUpdate,this.geometry=a}getParticleUpdate(t){const e=function(t){const e=[];for(const r in t){const i=t[r];e.push(r,i.code,i.dynamic?"d":"s")}return e.join("_")}(t);return this._generateParticleUpdateCache[e]||(this._generateParticleUpdateCache[e]=this.generateParticleUpdate(t)),this._generateParticleUpdateCache[e]}generateParticleUpdate(t){return function(t){return{dynamicUpdate:m(t,!0),staticUpdate:m(t,!1)}}(t)}update(t,e){t.length>this._size&&(e=!0,this._size=Math.max(t.length,1.5*this._size|0),this.staticAttributeBuffer=new p.u(this._size*this._staticStride*4*4),this.dynamicAttributeBuffer=new p.u(this._size*this._dynamicStride*4*4),this.indexBuffer=g(this._size),this.geometry.indexBuffer.setDataWithSize(this.indexBuffer,this.indexBuffer.byteLength,!0));const r=this.dynamicAttributeBuffer;if(this._dynamicUpload(t,r.float32View,r.uint32View),this._dynamicBuffer.setDataWithSize(this.dynamicAttributeBuffer.float32View,t.length*this._dynamicStride*4,!0),e){const e=this.staticAttributeBuffer;this._staticUpload(t,e.float32View,e.uint32View),this._staticBuffer.setDataWithSize(e.float32View,t.length*this._staticStride*4,!0)}}destroy(){this._staticBuffer.destroy(),this._dynamicBuffer.destroy(),this.geometry.destroy()}}var _=r(75242),y=r(95920),v=r(47699),b=r(53636),S=r(7663),w=r(30879),T="\nstruct ParticleUniforms {\n  uProjectionMatrix:mat3x3<f32>,\n  uColor:vec4<f32>,\n  uResolution:vec2<f32>,\n  uRoundPixels:f32,\n};\n\n@group(0) @binding(0) var<uniform> uniforms: ParticleUniforms;\n\n@group(1) @binding(0) var uTexture: texture_2d<f32>;\n@group(1) @binding(1) var uSampler : sampler;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>,\n    @location(1) color : vec4<f32>,\n  };\n@vertex\nfn mainVertex(\n  @location(0) aVertex: vec2<f32>,\n  @location(1) aPosition: vec2<f32>,\n  @location(2) aUV: vec2<f32>,\n  @location(3) aColor: vec4<f32>,\n  @location(4) aRotation: f32,\n) -> VSOutput {\n  \n   let v = vec2(\n       aVertex.x * cos(aRotation) - aVertex.y * sin(aRotation),\n       aVertex.x * sin(aRotation) + aVertex.y * cos(aRotation)\n   ) + aPosition;\n\n   let position = vec4((uniforms.uProjectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    let vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uniforms.uColor;\n\n  return VSOutput(\n   position,\n   aUV,\n   vColor,\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @location(1) color: vec4<f32>,\n  @builtin(position) position: vec4<f32>,\n) -> @location(0) vec4<f32> {\n\n    var sample = textureSample(uTexture, uSampler, uv) * color;\n   \n    return sample;\n}";class M extends b.M{constructor(){super({glProgram:y.M.from({vertex:"attribute vec2 aVertex;\nattribute vec2 aUV;\nattribute vec4 aColor;\n\nattribute vec2 aPosition;\nattribute float aRotation;\n\nuniform mat3 uTranslationMatrix;\nuniform float uRound;\nuniform vec2 uResolution;\nuniform vec4 uColor;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n\nvec2 roundPixels(vec2 position, vec2 targetSize)\n{       \n    return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n}\n\nvoid main(void){\n    float cosRotation = cos(aRotation);\n    float sinRotation = sin(aRotation);\n    float x = aVertex.x * cosRotation - aVertex.y * sinRotation;\n    float y = aVertex.x * sinRotation + aVertex.y * cosRotation;\n\n    vec2 v = vec2(x, y);\n    v = v + aPosition;\n\n    gl_Position = vec4((uTranslationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    if(uRound == 1.0)\n    {\n        gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n    }\n\n    vUV = aUV;\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uColor;\n}\n",fragment:"varying vec2 vUV;\nvarying vec4 vColor;\n\nuniform sampler2D uTexture;\n\nvoid main(void){\n    vec4 color = texture2D(uTexture, vUV) * vColor;\n    gl_FragColor = color;\n}"}),gpuProgram:v.B.from({fragment:{source:T,entryPoint:"mainFragment"},vertex:{source:T,entryPoint:"mainVertex"}}),resources:{uTexture:S.g.WHITE.source,uSampler:new w.n({}),uniforms:{uTranslationMatrix:{value:new s.u,type:"mat3x3<f32>"},uColor:{value:new _.Q(16777215),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}}})}}class P{constructor(t,e){this.state=l.U.for2d(),this._gpuBufferHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this.localUniforms=new a.k({uTranslationMatrix:{value:new s.u,type:"mat3x3<f32>"},uColor:{value:new Float32Array(4),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}),this.renderer=t,this.adaptor=e,this.defaultShader=new M,this.state=l.U.for2d()}validateRenderable(t){return!1}addRenderable(t,e){this.renderer.renderPipes.batch.break(e),e.add(t)}getBuffers(t){return this._gpuBufferHash[t.uid]||this._initBuffer(t)}_initBuffer(t){return this._gpuBufferHash[t.uid]=new x({size:t.particleChildren.length,properties:t._properties}),t.on("destroyed",this._destroyRenderableBound),this._gpuBufferHash[t.uid]}updateRenderable(t){}destroyRenderable(t){this._gpuBufferHash[t.uid].destroy(),this._gpuBufferHash[t.uid]=null,t.off("destroyed",this._destroyRenderableBound)}execute(t){const e=t.particleChildren;if(0===e.length)return;const r=this.renderer,i=this.getBuffers(t);t.texture||(t.texture=e[0].texture);const n=this.state;i.update(e,t._childrenDirty),t._childrenDirty=!1,n.blendMode=(0,o.i)(t.blendMode,t.texture._source);const s=this.localUniforms.uniforms,a=s.uTranslationMatrix;t.worldTransform.copyTo(a),a.prepend(r.globalUniforms.globalUniformData.projectionMatrix),s.uResolution=r.globalUniforms.globalUniformData.resolution,s.uRound=r._roundPixels|t._roundPixels,(0,h.V)(t.groupColorAlpha,s.uColor,0),this.adaptor.execute(this,t)}destroy(){this.defaultShader&&(this.defaultShader.destroy(),this.defaultShader=null)}}class C extends P{constructor(t){super(t,new n)}}C.extension={type:[i.Ag.WebGLPipes],name:"particle"};class A{execute(t,e){const r=t.renderer,i=e.shader||t.defaultShader;i.groups[0]=r.renderPipes.uniformBatch.getUniformBindGroup(t.localUniforms,!0),i.groups[1]=r.texture.getTextureBindGroup(e.texture);const n=t.state,s=t.getBuffers(e);r.encoder.draw({geometry:s.geometry,shader:e.shader||t.defaultShader,state:n,size:6*e.particleChildren.length})}}class k extends P{constructor(t){super(t,new A)}}k.extension={type:[i.Ag.WebGPUPipes],name:"particle"},i.XO.add(C),i.XO.add(k)},94821:(t,e,r)=>{"use strict";var i=r(91478),n=r(69769),s=r(40475),a=r(89379),o=r(14811),l=r(59859);const h=class t extends l.u{constructor(){var t;super({});let e=null!==(t=arguments.length<=0?void 0:arguments[0])&&void 0!==t?t:{};"number"===typeof e&&((0,o.t6)(o.lj,"PlaneGeometry constructor changed please use { width, height, verticesX, verticesY } instead"),e={width:e,height:arguments.length<=1?void 0:arguments[1],verticesX:arguments.length<=2?void 0:arguments[2],verticesY:arguments.length<=3?void 0:arguments[3]}),this.build(e)}build(e){var r,i,n,s;e=(0,a.A)((0,a.A)({},t.defaultOptions),e),this.verticesX=null!==(r=this.verticesX)&&void 0!==r?r:e.verticesX,this.verticesY=null!==(i=this.verticesY)&&void 0!==i?i:e.verticesY,this.width=null!==(n=this.width)&&void 0!==n?n:e.width,this.height=null!==(s=this.height)&&void 0!==s?s:e.height;const o=this.verticesX*this.verticesY,l=[],h=[],u=[],c=this.verticesX-1,d=this.verticesY-1,f=this.width/c,p=this.height/d;for(let t=0;t<o;t++){const e=t%this.verticesX,r=t/this.verticesX|0;l.push(e*f,r*p),h.push(e/c,r/d)}const g=c*d;for(let t=0;t<g;t++){const e=t%c,r=t/c|0,i=r*this.verticesX+e,n=r*this.verticesX+e+1,s=(r+1)*this.verticesX+e,a=(r+1)*this.verticesX+e+1;u.push(i,n,s,n,a,s)}this.buffers[0].data=new Float32Array(l),this.buffers[1].data=new Float32Array(h),this.indexBuffer.data=new Uint32Array(u),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};h.defaultOptions={width:100,height:100,verticesX:10,verticesY:10};let u=h;const c=class t extends u{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=(0,a.A)((0,a.A)({},t.defaultOptions),e),super({width:e.width,height:e.height,verticesX:4,verticesY:4}),this.update(e)}update(t){var e,r,i,n,s,a,o,l;this.width=null!==(e=t.width)&&void 0!==e?e:this.width,this.height=null!==(r=t.height)&&void 0!==r?r:this.height,this._originalWidth=null!==(i=t.originalWidth)&&void 0!==i?i:this._originalWidth,this._originalHeight=null!==(n=t.originalHeight)&&void 0!==n?n:this._originalHeight,this._leftWidth=null!==(s=t.leftWidth)&&void 0!==s?s:this._leftWidth,this._rightWidth=null!==(a=t.rightWidth)&&void 0!==a?a:this._rightWidth,this._topHeight=null!==(o=t.topHeight)&&void 0!==o?o:this._topHeight,this._bottomHeight=null!==(l=t.bottomHeight)&&void 0!==l?l:this._bottomHeight,this.updateUvs(),this.updatePositions()}updatePositions(){const t=this.positions,e=this._leftWidth+this._rightWidth,r=this.width>e?1:this.width/e,i=this._topHeight+this._bottomHeight,n=this.height>i?1:this.height/i,s=Math.min(r,n);t[9]=t[11]=t[13]=t[15]=this._topHeight*s,t[17]=t[19]=t[21]=t[23]=this.height-this._bottomHeight*s,t[25]=t[27]=t[29]=t[31]=this.height,t[2]=t[10]=t[18]=t[26]=this._leftWidth*s,t[4]=t[12]=t[20]=t[28]=this.width-this._rightWidth*s,t[6]=t[14]=t[22]=t[30]=this.width,this.getBuffer("aPosition").update()}updateUvs(){const t=this.uvs;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1;const e=1/this._originalWidth,r=1/this._originalHeight;t[2]=t[10]=t[18]=t[26]=e*this._leftWidth,t[9]=t[11]=t[13]=t[15]=r*this._topHeight,t[4]=t[12]=t[20]=t[28]=1-e*this._rightWidth,t[17]=t[19]=t[21]=t[23]=1-r*this._bottomHeight,this.getBuffer("aUV").update()}};c.defaultOptions={width:100,height:100,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10,originalWidth:100,originalHeight:100};let d=c;class f{constructor(t){this._gpuSpriteHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_gpuSpriteHash")}addRenderable(t,e){const r=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,r),this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){const e=this._gpuSpriteHash[t.uid];t.didViewUpdate&&this._updateBatchableSprite(t,e),e._batcher.updateElement(e)}validateRenderable(t){const e=this._getGpuSprite(t);return!e._batcher.checkAndUpdateTexture(e,t._texture)}destroyRenderable(t){const e=this._gpuSpriteHash[t.uid];n.Z.return(e.geometry),n.Z.return(e),this._gpuSpriteHash[t.uid]=null,t.off("destroyed",this._destroyRenderableBound)}_updateBatchableSprite(t,e){e.geometry.update(t),e.texture=t._texture}_getGpuSprite(t){return this._gpuSpriteHash[t.uid]||this._initGPUSprite(t)}_initGPUSprite(t){const e=n.Z.get(s.U);return e.geometry=n.Z.get(d),e.renderable=t,e.transform=t.groupTransform,e.texture=t._texture,e.roundPixels=this._renderer._roundPixels|t._roundPixels,this._gpuSpriteHash[t.uid]=e,t.didViewUpdate||this._updateBatchableSprite(t,e),t.on("destroyed",this._destroyRenderableBound),e}destroy(){for(const t in this._gpuSpriteHash){this._gpuSpriteHash[t].geometry.destroy()}this._gpuSpriteHash=null,this._renderer=null}}f.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"nineSliceSprite"},i.XO.add(f)},97121:(t,e,r)=>{"use strict";var i=r(91478),n=r(77820),s=r(90576),a=r(16650),o=r(29385),l=r(40475),h=r(59859),u=r(33596),c=r(89569),d=r(89379);const f={name:"local-uniform-bit",vertex:{header:"\n\n            struct LocalUniforms {\n                uTransformMatrix:mat3x3<f32>,\n                uColor:vec4<f32>,\n                uRound:f32,\n            }\n\n            @group(1) @binding(0) var<uniform> localUniforms : LocalUniforms;\n        ",main:"\n            vColor *= localUniforms.uColor;\n            modelMatrix *= localUniforms.uTransformMatrix;\n        ",end:"\n            if(localUniforms.uRound == 1)\n            {\n                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n            }\n        "}},p=((0,d.A)((0,d.A)({},f),{},{vertex:(0,d.A)((0,d.A)({},f.vertex),{},{header:f.vertex.header.replace("group(1)","group(2)")})}),{name:"local-uniform-bit",vertex:{header:"\n\n            uniform mat3 uTransformMatrix;\n            uniform vec4 uColor;\n            uniform float uRound;\n        ",main:"\n            vColor *= uColor;\n            modelMatrix = uTransformMatrix;\n        ",end:"\n            if(uRound == 1.)\n            {\n                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n            }\n        "}});var g=r(84994),m=r(53636),x=r(5222),_=r(7663);const y={name:"tiling-bit",vertex:{header:"\n            struct TilingUniforms {\n                uMapCoord:mat3x3<f32>,\n                uClampFrame:vec4<f32>,\n                uClampOffset:vec2<f32>,\n                uTextureTransform:mat3x3<f32>,\n                uSizeAnchor:vec4<f32>\n            };\n\n            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;\n            @group(2) @binding(1) var uTexture: texture_2d<f32>;\n            @group(2) @binding(2) var uSampler: sampler;\n        ",main:"\n            uv = (tilingUniforms.uTextureTransform * vec3(uv, 1.0)).xy;\n\n            position = (position - tilingUniforms.uSizeAnchor.zw) * tilingUniforms.uSizeAnchor.xy;\n        "},fragment:{header:"\n            struct TilingUniforms {\n                uMapCoord:mat3x3<f32>,\n                uClampFrame:vec4<f32>,\n                uClampOffset:vec2<f32>,\n                uTextureTransform:mat3x3<f32>,\n                uSizeAnchor:vec4<f32>\n            };\n\n            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;\n            @group(2) @binding(1) var uTexture: texture_2d<f32>;\n            @group(2) @binding(2) var uSampler: sampler;\n        ",main:"\n\n            var coord = vUV + ceil(tilingUniforms.uClampOffset - vUV);\n            coord = (tilingUniforms.uMapCoord * vec3(coord, 1.0)).xy;\n            var unclamped = coord;\n            coord = clamp(coord, tilingUniforms.uClampFrame.xy, tilingUniforms.uClampFrame.zw);\n\n            var bias = 0.;\n\n            if(unclamped.x == coord.x && unclamped.y == coord.y)\n            {\n                bias = -32.;\n            } \n\n            outColor = textureSampleBias(uTexture, uSampler, coord, bias);\n        "}},v={name:"tiling-bit",vertex:{header:"\n            uniform mat3 uTextureTransform;\n            uniform vec4 uSizeAnchor;\n        \n        ",main:"\n            uv = (uTextureTransform * vec3(aUV, 1.0)).xy;\n\n            position = (position - uSizeAnchor.zw) * uSizeAnchor.xy;\n        "},fragment:{header:"\n            uniform sampler2D uTexture;\n            uniform mat3 uMapCoord;\n            uniform vec4 uClampFrame;\n            uniform vec2 uClampOffset;\n        ",main:"\n\n        vec2 coord = vUV + ceil(uClampOffset - vUV);\n        coord = (uMapCoord * vec3(coord, 1.0)).xy;\n        vec2 unclamped = coord;\n        coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n        \n        outColor = texture(uTexture, coord, unclamped == coord ? 0.0 : -32.0);// lod-bias very negative to force lod 0\n    \n        "}};let b,S;class w extends m.M{constructor(){var t,e;null!==(t=b)&&void 0!==t||(b=(0,c.v)({name:"tiling-sprite-shader",bits:[f,y,g.b]})),null!==(e=S)&&void 0!==e||(S=(0,c.I)({name:"tiling-sprite-shader",bits:[p,v,g.m]}));const r=new x.k({uMapCoord:{value:new u.u,type:"mat3x3<f32>"},uClampFrame:{value:new Float32Array([0,0,1,1]),type:"vec4<f32>"},uClampOffset:{value:new Float32Array([0,0]),type:"vec2<f32>"},uTextureTransform:{value:new u.u,type:"mat3x3<f32>"},uSizeAnchor:{value:new Float32Array([100,100,.5,.5]),type:"vec4<f32>"}});super({glProgram:S,gpuProgram:b,resources:{localUniforms:new x.k({uTransformMatrix:{value:new u.u,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),tilingUniforms:r,uTexture:_.g.EMPTY.source,uSampler:_.g.EMPTY.source.style}})}updateUniforms(t,e,r,i,n,s){const a=this.resources.tilingUniforms,o=s.width,l=s.height,h=s.textureMatrix,u=a.uniforms.uTextureTransform;u.set(r.a*o/t,r.b*o/e,r.c*l/t,r.d*l/e,r.tx/t,r.ty/e),u.invert(),a.uniforms.uMapCoord=h.mapCoord,a.uniforms.uClampFrame=h.uClampFrame,a.uniforms.uClampOffset=h.uClampOffset,a.uniforms.uTextureTransform=u,a.uniforms.uSizeAnchor[0]=t,a.uniforms.uSizeAnchor[1]=e,a.uniforms.uSizeAnchor[2]=i,a.uniforms.uSizeAnchor[3]=n,s&&(this.resources.uTexture=s.source,this.resources.uSampler=s.source.style)}}class T extends h.u{constructor(){super({positions:new Float32Array([0,0,1,0,1,1,0,1]),uvs:new Float32Array([0,0,1,0,1,1,0,1]),indices:new Uint32Array([0,1,2,0,2,3])})}}const M=new T;class P{constructor(t){this._state=s.U.default2d,this._tilingSpriteDataHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_tilingSpriteDataHash")}validateRenderable(t){const e=this._getTilingSpriteData(t),r=e.canBatch;this._updateCanBatch(t);const i=e.canBatch;if(i&&i===r){const{batchableMesh:r}=e;return!r._batcher.checkAndUpdateTexture(r,t.texture)}return r!==i}addRenderable(t,e){const r=this._renderer.renderPipes.batch;this._updateCanBatch(t);const i=this._getTilingSpriteData(t),{geometry:n,canBatch:s}=i;if(s){i.batchableMesh||(i.batchableMesh=new l.U);const s=i.batchableMesh;t.didViewUpdate&&(this._updateBatchableMesh(t),s.geometry=n,s.renderable=t,s.transform=t.groupTransform,s.texture=t._texture),s.roundPixels=this._renderer._roundPixels|t._roundPixels,r.addToBatch(s,e)}else r.break(e),i.shader||(i.shader=new w),this.updateRenderable(t),e.add(t)}execute(t){const{shader:e}=this._tilingSpriteDataHash[t.uid];e.groups[0]=this._renderer.globalUniforms.bindGroup;const r=e.resources.localUniforms.uniforms;r.uTransformMatrix=t.groupTransform,r.uRound=this._renderer._roundPixels|t._roundPixels,(0,o.V)(t.groupColorAlpha,r.uColor,0),this._state.blendMode=(0,n.i)(t.groupBlendMode,t.texture._source),this._renderer.encoder.draw({geometry:M,shader:e,state:this._state})}updateRenderable(t){const e=this._getTilingSpriteData(t),{canBatch:r}=e;if(r){const{batchableMesh:r}=e;t.didViewUpdate&&this._updateBatchableMesh(t),r._batcher.updateElement(r)}else if(t.didViewUpdate){const{shader:r}=e;r.updateUniforms(t.width,t.height,t._tileTransform.matrix,t.anchor.x,t.anchor.y,t.texture)}}destroyRenderable(t){var e;const r=this._getTilingSpriteData(t);r.batchableMesh=null,null===(e=r.shader)||void 0===e||e.destroy(),this._tilingSpriteDataHash[t.uid]=null,t.off("destroyed",this._destroyRenderableBound)}_getTilingSpriteData(t){return this._tilingSpriteDataHash[t.uid]||this._initTilingSpriteData(t)}_initTilingSpriteData(t){const e=new h.u({indices:M.indices,positions:M.positions.slice(),uvs:M.uvs.slice()});return this._tilingSpriteDataHash[t.uid]={canBatch:!0,renderable:t,geometry:e},t.on("destroyed",this._destroyRenderableBound),this._tilingSpriteDataHash[t.uid]}_updateBatchableMesh(t){const e=this._getTilingSpriteData(t),{geometry:r}=e,i=t.texture.source.style;"repeat"!==i.addressMode&&(i.addressMode="repeat",i.update()),function(t,e){const r=t.texture,i=r.frame.width,n=r.frame.height;let s=0,a=0;t.applyAnchorToTexture&&(s=t.anchor.x,a=t.anchor.y),e[0]=e[6]=-s,e[2]=e[4]=1-s,e[1]=e[3]=-a,e[5]=e[7]=1-a;const o=u.u.shared;o.copyFrom(t._tileTransform.matrix),o.tx/=t.width,o.ty/=t.height,o.invert(),o.scale(t.width/i,t.height/n),function(t,e,r,i){let n=0;const s=t.length/(e||2),a=i.a,o=i.b,l=i.c,h=i.d,u=i.tx,c=i.ty;for(r*=e;n<s;){const i=t[r],s=t[r+1];t[r]=a*i+l*s+u,t[r+1]=o*i+h*s+c,r+=e,n++}}(e,2,0,o)}(t,r.uvs),function(t,e){const r=t.anchor.x,i=t.anchor.y;e[0]=-r*t.width,e[1]=-i*t.height,e[2]=(1-r)*t.width,e[3]=-i*t.height,e[4]=(1-r)*t.width,e[5]=(1-i)*t.height,e[6]=-r*t.width,e[7]=(1-i)*t.height}(t,r.positions)}destroy(){for(const t in this._tilingSpriteDataHash)this.destroyRenderable(this._tilingSpriteDataHash[t].renderable);this._tilingSpriteDataHash=null,this._renderer=null}_updateCanBatch(t){const e=this._getTilingSpriteData(t),r=t.texture;let i=!0;return this._renderer.type===a.W.WEBGL&&(i=this._renderer.context.supports.nonPowOf2wrapping),e.canBatch=r.textureMatrix.isSimple&&(i||r.source.isPowerOfTwo),e.canBatch}}P.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"tilingSprite"},i.XO.add(P)},31669:(t,e,r)=>{"use strict";r.d(e,{K:()=>i});class i{constructor(){this.batcherName="default",this.topology="triangle-list",this.attributeSize=4,this.indexSize=6,this.packAsQuad=!0,this.roundPixels=0,this._attributeStart=0,this._batcher=null,this._batch=null}get blendMode(){return this.renderable.groupBlendMode}get color(){return this.renderable.groupColorAlpha}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.bounds=null}}},60665:(t,e,r)=>{"use strict";var i=r(91478),n=r(98656),s=r(69769),a=r(89379),o=r(80045),l=r(14811),h=r(48674),u=r(97861);const c=["context","roundPixels"];class d extends h.l{constructor(t){t instanceof u.T&&(t={context:t});const e=t||{},{context:r,roundPixels:i}=e,n=(0,o.A)(e,c);super((0,a.A)({label:"Graphics"},n)),this.renderPipeId="graphics",this._context=r||(this._ownedContext=new u.T),this._context.on("update",this.onViewUpdate,this),this.allowChildren=!1,this.roundPixels=null!==i&&void 0!==i&&i}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):!0!==t&&!0!==(null===t||void 0===t?void 0:t.context)||this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("setFillStyle",e)}setStrokeStyle(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("setStrokeStyle",e)}fill(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("fill",e)}stroke(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("stroke",e)}texture(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("texture",e)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("arc",e)}arcTo(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("arcTo",e)}arcToSvg(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("arcToSvg",e)}bezierCurveTo(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("bezierCurveTo",e)}closePath(){return this._callContextMethod("closePath",[])}ellipse(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("ellipse",e)}circle(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("circle",e)}path(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("path",e)}lineTo(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("lineTo",e)}moveTo(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("moveTo",e)}quadraticCurveTo(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("quadraticCurveTo",e)}rect(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("rect",e)}roundRect(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("roundRect",e)}poly(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("poly",e)}regularPoly(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("regularPoly",e)}roundPoly(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("roundPoly",e)}roundShape(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("roundShape",e)}filletRect(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("filletRect",e)}chamferRect(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("chamferRect",e)}star(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("star",e)}svg(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("svg",e)}restore(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("restore",e)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("rotate",e)}scaleTransform(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("scale",e)}setTransform(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("setTransform",e)}transform(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("transform",e)}translateTransform(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("translate",e)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])return new d(this._context.clone());this._ownedContext=null;return new d(this._context)}lineStyle(t,e,r){(0,l.t6)(l.lj,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const i={};return t&&(i.width=t),e&&(i.color=e),r&&(i.alpha=r),this.context.strokeStyle=i,this}beginFill(t,e){(0,l.t6)(l.lj,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const r={};return void 0!==t&&(r.color=t),void 0!==e&&(r.alpha=e),this.context.fillStyle=r,this}endFill(){(0,l.t6)(l.lj,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return t.width===u.T.defaultStrokeStyle.width&&t.color===u.T.defaultStrokeStyle.color&&t.alpha===u.T.defaultStrokeStyle.alpha||this.context.stroke(),this}drawCircle(){(0,l.t6)(l.lj,"Graphics#drawCircle has been renamed to Graphics#circle");for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("circle",e)}drawEllipse(){(0,l.t6)(l.lj,"Graphics#drawEllipse has been renamed to Graphics#ellipse");for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("ellipse",e)}drawPolygon(){(0,l.t6)(l.lj,"Graphics#drawPolygon has been renamed to Graphics#poly");for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("poly",e)}drawRect(){(0,l.t6)(l.lj,"Graphics#drawRect has been renamed to Graphics#rect");for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("rect",e)}drawRoundedRect(){(0,l.t6)(l.lj,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect");for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("roundRect",e)}drawStar(){(0,l.t6)(l.lj,"Graphics#drawStar has been renamed to Graphics#star");for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._callContextMethod("star",e)}}var f=r(33596),p=r(94719),g=r(89569),m=r(63144),x=r(21193),_=r(84994),y=r(59963),v=r(53636),b=r(5222);const S={name:"local-uniform-msdf-bit",vertex:{header:"\n            struct LocalUniforms {\n                uColor:vec4<f32>,\n                uTransformMatrix:mat3x3<f32>,\n                uDistance: f32,\n                uRound:f32,\n            }\n\n            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;\n        ",main:"\n            vColor *= localUniforms.uColor;\n            modelMatrix *= localUniforms.uTransformMatrix;\n        ",end:"\n            if(localUniforms.uRound == 1)\n            {\n                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n            }\n        "},fragment:{header:"\n            struct LocalUniforms {\n                uColor:vec4<f32>,\n                uTransformMatrix:mat3x3<f32>,\n                uDistance: f32\n            }\n\n            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;\n         ",main:" \n            outColor = vec4<f32>(calculateMSDFAlpha(outColor, localUniforms.uColor, localUniforms.uDistance));\n        "}},w={name:"local-uniform-msdf-bit",vertex:{header:"\n            uniform mat3 uTransformMatrix;\n            uniform vec4 uColor;\n            uniform float uRound;\n        ",main:"\n            vColor *= uColor;\n            modelMatrix *= uTransformMatrix;\n        ",end:"\n            if(uRound == 1.)\n            {\n                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n            }\n        "},fragment:{header:"\n            uniform float uDistance;\n         ",main:" \n            outColor = vec4(calculateMSDFAlpha(outColor, vColor, uDistance));\n        "}},T={name:"msdf-bit",fragment:{header:"\n            fn calculateMSDFAlpha(msdfColor:vec4<f32>, shapeColor:vec4<f32>, distance:f32) -> f32 {\n                \n                // MSDF\n                var median = msdfColor.r + msdfColor.g + msdfColor.b -\n                    min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -\n                    max(msdfColor.r, max(msdfColor.g, msdfColor.b));\n            \n                // SDF\n                median = min(median, msdfColor.a);\n\n                var screenPxDistance = distance * (median - 0.5);\n                var alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n                if (median < 0.01) {\n                    alpha = 0.0;\n                } else if (median > 0.99) {\n                    alpha = 1.0;\n                }\n\n                // Gamma correction for coverage-like alpha\n                var luma: f32 = dot(shapeColor.rgb, vec3<f32>(0.299, 0.587, 0.114));\n                var gamma: f32 = mix(1.0, 1.0 / 2.2, luma);\n                var coverage: f32 = pow(shapeColor.a * alpha, gamma);\n\n                return coverage;\n             \n            }\n        "}},M={name:"msdf-bit",fragment:{header:"\n            float calculateMSDFAlpha(vec4 msdfColor, vec4 shapeColor, float distance) {\n                \n                // MSDF\n                float median = msdfColor.r + msdfColor.g + msdfColor.b -\n                                min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -\n                                max(msdfColor.r, max(msdfColor.g, msdfColor.b));\n               \n                // SDF\n                median = min(median, msdfColor.a);\n            \n                float screenPxDistance = distance * (median - 0.5);\n                float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n           \n                if (median < 0.01) {\n                    alpha = 0.0;\n                } else if (median > 0.99) {\n                    alpha = 1.0;\n                }\n\n                // Gamma correction for coverage-like alpha\n                float luma = dot(shapeColor.rgb, vec3(0.299, 0.587, 0.114));\n                float gamma = mix(1.0, 1.0 / 2.2, luma);\n                float coverage = pow(shapeColor.a * alpha, gamma);  \n              \n                return coverage;\n            }\n        "}};let P,C;class A extends v.M{constructor(){var t,e;const r=new b.k({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new f.u,type:"mat3x3<f32>"},uDistance:{value:4,type:"f32"},uRound:{value:0,type:"f32"}}),i=(0,p.a)();null!==(t=P)&&void 0!==t||(P=(0,g.v)({name:"sdf-shader",bits:[m.F,(0,x._)(i),S,T,_.b]})),null!==(e=C)&&void 0!==e||(C=(0,g.I)({name:"sdf-shader",bits:[m.a,(0,x.P)(i),w,M,_.m]})),super({glProgram:C,gpuProgram:P,resources:{localUniforms:r,batchSamplers:(0,y.n)(i)}})}}var k=r(60279),B=r(72100),R=r(75242),z=r(44307),U=r(59445),F=r(33682),I=r(7663),E=r(37821),G=r(91915),W=r(95435),V=r(28379);class O extends V.A{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return(0,l.t6)(l.lj,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return(0,l.t6)(l.lj,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return(0,l.t6)(l.lj,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return(0,l.t6)(l.lj,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return(0,l.t6)(l.lj,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.emit("destroy",this),this.removeAllListeners();for(const r in this.chars){var e;null===(e=this.chars[r].texture)||void 0===e||e.destroy()}this.chars=null,t&&(this.pages.forEach((t=>t.texture.destroy(!0))),this.pages=null)}}function D(t){if(""===t)return[];"string"===typeof t&&(t=[t]);const e=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];if(Array.isArray(i)){if(2!==i.length)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got ".concat(i.length,"."));if(0===i[0].length||0===i[1].length)throw new Error("[BitmapFont]: Invalid character delimiter.");const t=i[0].charCodeAt(0),r=i[1].charCodeAt(0);if(r<t)throw new Error("[BitmapFont]: Invalid character range.");for(let i=t,n=r;i<=n;i++)e.push(String.fromCharCode(i))}else e.push(...Array.from(i))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}const L=class t extends O{constructor(e){var r,i,n;super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentPageIndex=-1,this._skipKerning=!1;const s=(0,a.A)((0,a.A)({},t.defaultOptions),e);this._textureSize=s.textureSize,this._mipmap=s.mipmap;const o=s.style.clone();s.overrideFill&&(o._fill.color=16777215,o._fill.alpha=1,o._fill.texture=I.g.WHITE,o._fill.fill=null),this.applyFillAsTint=s.overrideFill;const l=o.fontSize;o.fontSize=this.baseMeasurementFontSize;const h=(0,G.Z)(o);s.overrideSize?o._stroke&&(o._stroke.width*=this.baseRenderedFontSize/l):o.fontSize=this.baseRenderedFontSize=l,this._style=o,this._skipKerning=null!==(r=s.skipKerning)&&void 0!==r&&r,this.resolution=null!==(i=s.resolution)&&void 0!==i?i:1,this._padding=null!==(n=s.padding)&&void 0!==n?n:4,this.fontMetrics=E.P.measureFont(h),this.lineHeight=o.lineHeight||this.fontMetrics.fontSize||o.fontSize}ensureCharacters(t){const e=D(t).filter((t=>!this._currentChars.includes(t))).filter(((t,e,r)=>r.indexOf(t)===e));if(!e.length)return;let r;this._currentChars=[...this._currentChars,...e],r=-1===this._currentPageIndex?this._nextPage():this.pages[this._currentPageIndex];let{canvas:i,context:n}=r.canvasAndContext,s=r.texture.source;const a=this._style;let o=this._currentX,l=this._currentY;const h=this.baseRenderedFontSize/this.baseMeasurementFontSize,u=this._padding*h;let c=0,d=!1;const f=i.width/this.resolution,p=i.height/this.resolution;for(let y=0;y<e.length;y++){var g,m,x,_;const t=e[y],r=E.P.measureText(t,a,i,!1);r.lineHeight=r.height;const v=r.width*h,b=Math.ceil(("italic"===a.fontStyle?2:1)*v)+2*u,S=r.height*h+2*u;if(d=!1,"\n"!==t&&"\r"!==t&&"\t"!==t&&" "!==t&&(d=!0,c=Math.ceil(Math.max(S,c))),o+b>f&&(l+=c,c=S,o=0,l+c>p)){s.update();const t=this._nextPage();i=t.canvasAndContext.canvas,n=t.canvasAndContext.context,s=t.texture.source,l=0}const w=v/h-(null!==(g=null===(m=a.dropShadow)||void 0===m?void 0:m.distance)&&void 0!==g?g:0)-(null!==(x=null===(_=a._stroke)||void 0===_?void 0:_.width)&&void 0!==x?x:0);if(this.chars[t]={id:t.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:w,kerning:{}},d){this._drawGlyph(n,r,o+u,l+u,h,a);const e=s.width*h,i=s.height*h,c=new z.M(o/e*s.width,l/i*s.height,b/e*s.width,S/i*s.height);this.chars[t].texture=new I.g({source:s,frame:c}),o+=Math.ceil(b)}}s.update(),this._currentX=o,this._currentY=l,this._skipKerning&&this._applyKerning(e,n)}get pageTextures(){return(0,l.t6)(l.lj,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(t,e){const r=this._measureCache;for(let i=0;i<t.length;i++){const n=t[i];for(let t=0;t<this._currentChars.length;t++){const i=this._currentChars[t];let s=r[n];s||(s=r[n]=e.measureText(n).width);let a=r[i];a||(a=r[i]=e.measureText(i).width);let o=e.measureText(n+i).width,l=o-(s+a);l&&(this.chars[n].kerning[i]=l),o=e.measureText(n+i).width,l=o-(s+a),l&&(this.chars[i].kerning[n]=l)}}}_nextPage(){this._currentPageIndex++;const t=this.resolution,e=U.N.getOptimalCanvasAndContext(this._textureSize,this._textureSize,t);this._setupContext(e.context,this._style,t);const r=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),i={canvasAndContext:e,texture:new I.g({source:new F.b({resource:e.canvas,resolution:r,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})})};return this.pages[this._currentPageIndex]=i,i}_setupContext(t,e,r){var i;e.fontSize=this.baseRenderedFontSize,t.scale(r,r),t.font=(0,G.Z)(e),e.fontSize=this.baseMeasurementFontSize,t.textBaseline=e.textBaseline;const n=e._stroke,s=null!==(i=null===n||void 0===n?void 0:n.width)&&void 0!==i?i:0;if(n&&(t.lineWidth=s,t.lineJoin=n.join,t.miterLimit=n.miterLimit,t.strokeStyle=(0,W.r)(n,t)),e._fill&&(t.fillStyle=(0,W.r)(e._fill,t)),e.dropShadow){const i=e.dropShadow,n=R.Q.shared.setValue(i.color).toArray(),s=i.blur*r,a=i.distance*r;t.shadowColor="rgba(".concat(255*n[0],",").concat(255*n[1],",").concat(255*n[2],",").concat(i.alpha,")"),t.shadowBlur=s,t.shadowOffsetX=Math.cos(i.angle)*a,t.shadowOffsetY=Math.sin(i.angle)*a}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}_drawGlyph(t,e,r,i,n,s){var a;const o=e.text,l=e.fontProperties,h=s._stroke,u=(null!==(a=null===h||void 0===h?void 0:h.width)&&void 0!==a?a:0)*n,c=r+u/2,d=i-u/2,f=l.descent*n,p=e.lineHeight*n;s.stroke&&u&&t.strokeText(o,c,d+p-f),s._fill&&t.fillText(o,c,d+p-f)}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{canvasAndContext:e,texture:r}=this.pages[t];U.N.returnCanvasAndContext(e),r.destroy(!0)}this.pages=null}};L.defaultOptions={textureSize:512,style:new B.x,mipmap:!0};let H=L;function j(t,e,r,i){const n={width:0,height:0,offsetY:0,scale:e.fontSize/r.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};n.offsetY=r.baseLineOffset;let s=n.lines[0],a=null,o=!0;const l={spaceWord:!1,width:0,start:0,index:0,positions:[],chars:[]},h=t=>{const e=s.width;for(let r=0;r<l.index;r++){const i=t.positions[r];s.chars.push(t.chars[r]),s.charPositions.push(i+e)}s.width+=t.width,o=!1,l.width=0,l.index=0,l.chars.length=0},u=()=>{let t=s.chars.length-1;if(i){let e=s.chars[t];for(;" "===e;)s.width-=r.chars[e].xAdvance,e=s.chars[--t]}n.width=Math.max(n.width,s.width),s={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},o=!0,n.lines.push(s),n.height+=r.lineHeight},c=r.baseMeasurementFontSize/e.fontSize,d=e.letterSpacing*c,f=e.wordWrapWidth*c;for(let p=0;p<t.length+1;p++){let i;const n=p===t.length;n||(i=t[p]);const c=r.chars[i]||r.chars[" "];if(/(?:\s)/.test(i)||"\r"===i||"\n"===i||n){if(!o&&e.wordWrap&&s.width+l.width-d>f?(u(),h(l),n||s.charPositions.push(0)):(l.start=s.width,h(l),n||s.charPositions.push(0)),"\r"===i||"\n"===i)0!==s.width&&u();else if(!n){const t=c.xAdvance+(c.kerning[a]||0)+d;s.width+=t,s.spaceWidth=t,s.spacesIndex.push(s.charPositions.length),s.chars.push(i)}}else{const t=c.kerning[a]||0,e=c.xAdvance+t+d;l.positions[l.index++]=l.width+t,l.chars.push(i),l.width+=e}a=i}return u(),"center"===e.align?function(t){for(let e=0;e<t.lines.length;e++){const r=t.lines[e],i=t.width/2-r.width/2;for(let t=0;t<r.charPositions.length;t++)r.charPositions[t]+=i}}(n):"right"===e.align?function(t){for(let e=0;e<t.lines.length;e++){const r=t.lines[e],i=t.width-r.width;for(let t=0;t<r.charPositions.length;t++)r.charPositions[t]+=i}}(n):"justify"===e.align&&function(t){const e=t.width;for(let r=0;r<t.lines.length;r++){const i=t.lines[r];let n=0,s=i.spacesIndex[n++],a=0;const o=i.spacesIndex.length,l=(e-i.width)/o;for(let t=0;t<i.charPositions.length;t++)t===s&&(s=i.spacesIndex[n++],a+=l),i.charPositions[t]+=a}}(n),n}let X=0;const N=new class{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1}}getFont(t,e){var r;let i="".concat(e.fontFamily,"-bitmap"),s=!0;if(e._fill.fill&&!e._stroke)i+=e._fill.fill.styleKey,s=!1;else if(e._stroke||e.dropShadow){let t=e.styleKey;t=t.substring(0,t.lastIndexOf("-")),i="".concat(t,"-bitmap"),s=!1}if(!n.l.has(i)){const t=new H((0,a.A)({style:e,overrideFill:s,overrideSize:!0},this.defaultOptions));X++,X>50&&(0,k.R)("BitmapText","You have dynamically created ".concat(X,' bitmap fonts, this can be inefficient. Try pre installing your font styles using `BitmapFont.install({name:"style1", style})`')),t.once("destroy",(()=>{X--,n.l.remove(i)})),n.l.set(i,t)}const o=n.l.get(i);return null===(r=o.ensureCharacters)||void 0===r||r.call(o,t),o}getLayout(t,e){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=this.getFont(t,e);return j([...t],e,i,r)}measureText(t,e){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.getLayout(t,e,r)}install(){var t;let e=arguments.length<=0?void 0:arguments[0];var r,i,s,o;"string"===typeof e&&(e={name:e,style:arguments.length<=1?void 0:arguments[1],chars:null===(r=arguments.length<=2?void 0:arguments[2])||void 0===r?void 0:r.chars,resolution:null===(i=arguments.length<=2?void 0:arguments[2])||void 0===i?void 0:i.resolution,padding:null===(s=arguments.length<=2?void 0:arguments[2])||void 0===s?void 0:s.padding,skipKerning:null===(o=arguments.length<=2?void 0:arguments[2])||void 0===o?void 0:o.skipKerning},(0,l.t6)(l.lj,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const h=null===(t=e)||void 0===t?void 0:t.name;if(!h)throw new Error("[BitmapFontManager] Property `name` is required.");e=(0,a.A)((0,a.A)({},this.defaultOptions),e);const u=e.style,c=u instanceof B.x?u:new B.x(u),d=null!==c._fill.fill&&void 0!==c._fill.fill,f=new H({style:c,overrideFill:d,skipKerning:e.skipKerning,padding:e.padding,resolution:e.resolution,overrideSize:!1}),p=D(e.chars);return f.ensureCharacters(p.join("")),n.l.set("".concat(h,"-bitmap"),f),f.once("destroy",(()=>n.l.remove("".concat(h,"-bitmap")))),f}uninstall(t){const e="".concat(t,"-bitmap"),r=n.l.get(e);r&&r.destroy()}};class Y{constructor(t){this._gpuBitmapText={},this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_gpuBitmapText")}validateRenderable(t){const e=this._getGpuBitmapText(t);return t._didTextUpdate&&(t._didTextUpdate=!1,this._updateContext(t,e)),this._renderer.renderPipes.graphics.validateRenderable(e)}addRenderable(t,e){const r=this._getGpuBitmapText(t);K(t,r),t._didTextUpdate&&(t._didTextUpdate=!1,this._updateContext(t,r)),this._renderer.renderPipes.graphics.addRenderable(r,e),r.context.customShader&&this._updateDistanceField(t)}destroyRenderable(t){t.off("destroyed",this._destroyRenderableBound),this._destroyRenderableByUid(t.uid)}_destroyRenderableByUid(t){const e=this._gpuBitmapText[t].context;e.customShader&&(s.Z.return(e.customShader),e.customShader=null),s.Z.return(this._gpuBitmapText[t]),this._gpuBitmapText[t]=null}updateRenderable(t){const e=this._getGpuBitmapText(t);K(t,e),this._renderer.renderPipes.graphics.updateRenderable(e),e.context.customShader&&this._updateDistanceField(t)}_updateContext(t,e){const{context:r}=e,i=N.getFont(t.text,t._style);r.clear(),"none"!==i.distanceField.type&&(r.customShader||(r.customShader=s.Z.get(A)));const n=Array.from(t.text),a=t._style;let o=i.baseLineOffset;const l=j(n,a,i,!0);let h=0;const u=a.padding,c=l.scale;let d=l.width,f=l.height+l.offsetY;a._stroke&&(d+=a._stroke.width/c,f+=a._stroke.width/c),r.translate(-t._anchor._x*d-u,-t._anchor._y*f-u).scale(c,c);const p=i.applyFillAsTint?a._fill.color:16777215;for(let s=0;s<l.lines.length;s++){const t=l.lines[s];for(let e=0;e<t.charPositions.length;e++){const s=n[h++],a=i.chars[s];null!==a&&void 0!==a&&a.texture&&r.texture(a.texture,p||"black",Math.round(t.charPositions[e]+a.xOffset),Math.round(o+a.yOffset))}o+=i.lineHeight}}_getGpuBitmapText(t){return this._gpuBitmapText[t.uid]||this.initGpuText(t)}initGpuText(t){const e=s.Z.get(d);return this._gpuBitmapText[t.uid]=e,this._updateContext(t,e),t.on("destroyed",this._destroyRenderableBound),this._gpuBitmapText[t.uid]}_updateDistanceField(t){const e=this._getGpuBitmapText(t).context,r=t._style.fontFamily,i=n.l.get("".concat(r,"-bitmap")),{a:s,b:a,c:o,d:l}=t.groupTransform,h=Math.sqrt(s*s+a*a),u=Math.sqrt(o*o+l*l),c=(Math.abs(h)+Math.abs(u))/2,d=i.baseRenderedFontSize/t._style.fontSize,f=c*i.distanceField.range*(1/d);e.customShader.resources.localUniforms.uniforms.uDistance=f}destroy(){for(const t in this._gpuBitmapText)this._destroyRenderableByUid(t);this._gpuBitmapText=null,this._renderer=null}}function K(t,e){e.groupTransform=t.groupTransform,e.groupColorAlpha=t.groupColorAlpha,e.groupColor=t.groupColor,e.groupBlendMode=t.groupBlendMode,e.globalDisplayStatus=t.globalDisplayStatus,e.groupTransform=t.groupTransform,e.localDisplayStatus=t.localDisplayStatus,e.groupAlpha=t.groupAlpha,e._roundPixels=t._roundPixels}Y.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"bitmapText"},i.XO.add(Y)},88480:(t,e,r)=>{"use strict";var i=r(91478),n=r(7663),s=r(53693),a=r(69769),o=r(31669);class l{constructor(t){this._gpuText=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=t,this._renderer.runners.resolutionChange.add(this),this._renderer.renderableGC.addManagedHash(this,"_gpuText")}resolutionChange(){for(const t in this._gpuText){const e=this._gpuText[t];if(!e)continue;const r=e.batchableSprite.renderable;r._autoResolution&&(r._resolution=this._renderer.resolution,r.onViewUpdate())}}validateRenderable(t){const e=this._getGpuText(t),r=t._getKey();return e.textureNeedsUploading?(e.textureNeedsUploading=!1,!0):e.currentKey!==r}addRenderable(t,e){const r=this._getGpuText(t).batchableSprite;t._didTextUpdate&&this._updateText(t),this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){const e=this._getGpuText(t).batchableSprite;t._didTextUpdate&&this._updateText(t),e._batcher.updateElement(e)}destroyRenderable(t){t.off("destroyed",this._destroyRenderableBound),this._destroyRenderableById(t.uid)}_destroyRenderableById(t){const e=this._gpuText[t];this._renderer.htmlText.decreaseReferenceCount(e.currentKey),a.Z.return(e.batchableSprite),this._gpuText[t]=null}_updateText(t){const e=t._getKey(),r=this._getGpuText(t),i=r.batchableSprite;r.currentKey!==e&&this._updateGpuText(t).catch((t=>{console.error(t)})),t._didTextUpdate=!1;const n=t._style.padding;(0,s.y)(i.bounds,t._anchor,i.texture,n)}async _updateGpuText(t){var e;t._didTextUpdate=!1;const r=this._getGpuText(t);if(r.generatingTexture)return;const i=t._getKey();this._renderer.htmlText.decreaseReferenceCount(r.currentKey),r.generatingTexture=!0,r.currentKey=i;const n=null!==(e=t.resolution)&&void 0!==e?e:this._renderer.resolution,a=await this._renderer.htmlText.getManagedTexture(t.text,n,t._style,t._getKey()),o=r.batchableSprite;o.texture=r.texture=a,r.generatingTexture=!1,r.textureNeedsUploading=!0,t.onViewUpdate();const l=t._style.padding;(0,s.y)(o.bounds,t._anchor,o.texture,l)}_getGpuText(t){return this._gpuText[t.uid]||this.initGpuText(t)}initGpuText(t){const e={texture:n.g.EMPTY,currentKey:"--",batchableSprite:a.Z.get(o.K),textureNeedsUploading:!1,generatingTexture:!1},r=e.batchableSprite;return r.renderable=t,r.transform=t.groupTransform,r.texture=n.g.EMPTY,r.bounds={minX:0,maxX:1,minY:0,maxY:0},r.roundPixels=this._renderer._roundPixels|t._roundPixels,t._resolution=t._autoResolution?this._renderer.resolution:t.resolution,this._gpuText[t.uid]=e,t.on("destroyed",this._destroyRenderableBound),e}destroy(){for(const t in this._gpuText)this._destroyRenderableById(t);this._gpuText=null,this._renderer=null}}l.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"htmlText"};var h=r(59445),u=r(3202),c=r(16650),d=r(23144);var f=r(60279),p=r(74749);const g="http://www.w3.org/2000/svg",m="http://www.w3.org/1999/xhtml";class x{constructor(){this.svgRoot=document.createElementNS(g,"svg"),this.foreignObject=document.createElementNS(g,"foreignObject"),this.domElement=document.createElementNS(m,"div"),this.styleElement=document.createElementNS(m,"style"),this.image=new Image;const{foreignObject:t,svgRoot:e,styleElement:r,domElement:i}=this;t.setAttribute("width","10000"),t.setAttribute("height","10000"),t.style.overflow="hidden",e.appendChild(t),t.appendChild(r),t.appendChild(i)}}var _=r(89379),y=r(72100),v=r(33686),b=r(75242);function S(t){const e=t._stroke,r=t._fill,i=["color: ".concat(b.Q.shared.setValue(r.color).toHex()),"font-size: ".concat(t.fontSize,"px"),"font-family: ".concat(t.fontFamily),"font-weight: ".concat(t.fontWeight),"font-style: ".concat(t.fontStyle),"font-variant: ".concat(t.fontVariant),"letter-spacing: ".concat(t.letterSpacing,"px"),"text-align: ".concat(t.align),"padding: ".concat(t.padding,"px"),"white-space: ".concat("pre"===t.whiteSpace&&t.wordWrap?"pre-wrap":t.whiteSpace),...t.lineHeight?["line-height: ".concat(t.lineHeight,"px")]:[],...t.wordWrap?["word-wrap: ".concat(t.breakWords?"break-all":"break-word"),"max-width: ".concat(t.wordWrapWidth,"px")]:[],...e?[T(e)]:[],...t.dropShadow?[w(t.dropShadow)]:[],...t.cssOverrides].join(";"),n=["div { ".concat(i," }")];return function(t,e){for(const r in t){const i=t[r],n=[];for(const t in i)P[t]?n.push(P[t](i[t])):M[t]&&n.push(M[t].replace("{{VALUE}}",i[t]));e.push("".concat(r," { ").concat(n.join(";")," }"))}}(t.tagStyles,n),n.join(" ")}function w(t){const e=b.Q.shared.setValue(t.color).setAlpha(t.alpha).toHexa(),r=Math.round(Math.cos(t.angle)*t.distance),i=Math.round(Math.sin(t.angle)*t.distance),n="".concat(r,"px ").concat(i,"px");return t.blur>0?"text-shadow: ".concat(n," ").concat(t.blur,"px ").concat(e):"text-shadow: ".concat(n," ").concat(e)}function T(t){return["-webkit-text-stroke-width: ".concat(t.width,"px"),"-webkit-text-stroke-color: ".concat(b.Q.shared.setValue(t.color).toHex()),"text-stroke-width: ".concat(t.width,"px"),"text-stroke-color: ".concat(b.Q.shared.setValue(t.color).toHex()),"paint-order: stroke"].join(";")}const M={fontSize:"font-size: {{VALUE}}px",fontFamily:"font-family: {{VALUE}}",fontWeight:"font-weight: {{VALUE}}",fontStyle:"font-style: {{VALUE}}",fontVariant:"font-variant: {{VALUE}}",letterSpacing:"letter-spacing: {{VALUE}}px",align:"text-align: {{VALUE}}",padding:"padding: {{VALUE}}px",whiteSpace:"white-space: {{VALUE}}",lineHeight:"line-height: {{VALUE}}px",wordWrapWidth:"max-width: {{VALUE}}px"},P={fill:t=>"color: ".concat(b.Q.shared.setValue(t).toHex()),breakWords:t=>"word-wrap: ".concat(t?"break-all":"break-word"),stroke:T,dropShadow:w};class C extends y.x{constructor(){var t,e;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(r),this._cssOverrides=[],null!==(t=this.cssOverrides)&&void 0!==t||(this.cssOverrides=r.cssOverrides),this.tagStyles=null!==(e=r.tagStyles)&&void 0!==e?e:{}}set cssOverrides(t){this._cssOverrides=t instanceof Array?t:[t],this.update()}get cssOverrides(){return this._cssOverrides}_generateKey(){return this._styleKey=(0,v.V)(this)+this._cssOverrides.join("-"),this._styleKey}update(){this._cssStyle=null,super.update()}clone(){return new C({align:this.align,breakWords:this.breakWords,dropShadow:this.dropShadow?(0,_.A)({},this.dropShadow):null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,cssOverrides:this.cssOverrides})}get cssStyle(){return this._cssStyle||(this._cssStyle=S(this)),this._cssStyle}addOverride(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];const i=e.filter((t=>!this.cssOverrides.includes(t)));i.length>0&&(this.cssOverrides.push(...i),this.update())}removeOverride(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];const i=e.filter((t=>this.cssOverrides.includes(t)));i.length>0&&(this.cssOverrides=this.cssOverrides.filter((t=>!i.includes(t))),this.update())}set fill(t){"string"!==typeof t&&"number"!==typeof t&&(0,f.R)("[HTMLTextStyle] only color fill is not supported by HTMLText"),super.fill=t}set stroke(t){t&&"string"!==typeof t&&"number"!==typeof t&&(0,f.R)("[HTMLTextStyle] only color stroke is not supported by HTMLText"),super.stroke=t}}var A=r(98656);async function k(t,e){const r=await async function(t){const e=await d.e.get().fetch(t),r=await e.blob(),i=new FileReader;return await new Promise(((t,e)=>{i.onloadend=()=>t(i.result),i.onerror=e,i.readAsDataURL(r)}))}(e);return'@font-face {\n        font-family: "'.concat(t.fontFamily,"\";\n        src: url('").concat(r,"');\n        font-weight: ").concat(t.fontWeight,";\n        font-style: ").concat(t.fontStyle,";\n    }")}const B=new Map;let R;class z{constructor(t){this._activeTextures={},this._renderer=t,this._createCanvas=t.type===c.W.WEBGPU}getTexture(t){return this._buildTexturePromise(t.text,t.resolution,t.style)}getManagedTexture(t,e,r,i){if(this._activeTextures[i])return this._increaseReferenceCount(i),this._activeTextures[i].promise;const n=this._buildTexturePromise(t,e,r).then((t=>(this._activeTextures[i].texture=t,t)));return this._activeTextures[i]={texture:null,promise:n,usageCount:1},n}async _buildTexturePromise(t,e,r){const i=a.Z.get(x),n=function(t,e){const r=e.fontFamily,i=[],n={},s=t.match(/font-family:([^;"\s]+)/g);function a(t){n[t]||(i.push(t),n[t]=!0)}if(Array.isArray(r))for(let o=0;o<r.length;o++)a(r[o]);else a(r);s&&s.forEach((t=>{a(t.split(":")[1].trim())}));for(const o in e.tagStyles)a(e.tagStyles[o].fontFamily);return i}(t,r),s=await async function(t,e,r){const i=t.filter((t=>A.l.has("".concat(t,"-and-url")))).map(((t,i)=>{if(!B.has(t)){const{url:n}=A.l.get("".concat(t,"-and-url"));0===i?B.set(t,k({fontWeight:e.fontWeight,fontStyle:e.fontStyle,fontFamily:t},n)):B.set(t,k({fontWeight:r.fontWeight,fontStyle:r.fontStyle,fontFamily:t},n))}return B.get(t)}));return(await Promise.all(i)).join("\n")}(n,r,C.defaultTextStyle),o=function(t,e,r,i){i||(i=R||(R=new x));const{domElement:n,styleElement:s,svgRoot:a}=i;n.innerHTML="<style>".concat(e.cssStyle,";</style><div style='padding:0'>").concat(t,"</div>"),n.setAttribute("style","transform-origin: top left; display: inline-block"),r&&(s.textContent=r),document.body.appendChild(a);const o=n.getBoundingClientRect();a.remove();const l=2*e.padding;return{width:o.width-l,height:o.height-l}}(t,r,s,i),l=Math.ceil(Math.ceil(Math.max(1,o.width)+2*r.padding)*e),u=Math.ceil(Math.ceil(Math.max(1,o.height)+2*r.padding)*e),c=i.image;c.width=2+(0|l),c.height=2+(0|u);const f=function(t,e,r,i,n){const{domElement:s,styleElement:a,svgRoot:o}=n;s.innerHTML="<style>".concat(e.cssStyle,"</style><div style='padding:0;'>").concat(t,"</div>"),s.setAttribute("style","transform: scale(".concat(r,");transform-origin: top left; display: inline-block")),a.textContent=i;const{width:l,height:h}=n.image;return o.setAttribute("width",l.toString()),o.setAttribute("height",h.toString()),(new XMLSerializer).serializeToString(o)}(t,r,e,s,i);await function(t,e,r){return new Promise((async i=>{r&&await new Promise((t=>setTimeout(t,100))),t.onload=()=>{i()},t.src="data:image/svg+xml;charset=utf8,".concat(encodeURIComponent(e)),t.crossOrigin="anonymous"}))}(c,f,function(){const{userAgent:t}=d.e.get().getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}()&&n.length>0);const g=c;let m;this._createCanvas&&(m=function(t,e){const r=h.N.getOptimalCanvasAndContext(t.width,t.height,e),{context:i}=r;return i.clearRect(0,0,t.width,t.height),i.drawImage(t,0,0),r}(c,e));const _=(0,p.M)(m?m.canvas:g,c.width-2,c.height-2,e);return this._createCanvas&&(this._renderer.texture.initSource(_.source),h.N.returnCanvasAndContext(m)),a.Z.return(i),_}_increaseReferenceCount(t){this._activeTextures[t].usageCount++}decreaseReferenceCount(t){const e=this._activeTextures[t];e&&(e.usageCount--,0===e.usageCount&&(e.texture?this._cleanUp(e):e.promise.then((t=>{e.texture=t,this._cleanUp(e)})).catch((()=>{(0,f.R)("HTMLTextSystem: Failed to clean texture")})),this._activeTextures[t]=null))}_cleanUp(t){u.W.returnTexture(t.texture),t.texture.source.resource=null,t.texture.source.uploadMethodId="unknown"}getReferenceCount(t){return this._activeTextures[t].usageCount}destroy(){this._activeTextures=null}}z.extension={type:[i.Ag.WebGLSystem,i.Ag.WebGPUSystem,i.Ag.CanvasSystem],name:"htmlText"},z.defaultFontOptions={fontFamily:"Arial",fontStyle:"normal",fontWeight:"normal"},i.XO.add(z),i.XO.add(l)},72100:(t,e,r)=>{"use strict";r.d(e,{x:()=>f});var i=r(89379),n=r(28379),s=r(75242),a=r(14811),o=r(34325),l=r(41201),h=r(97861),u=r(84839),c=r(33686);const d=class t extends n.A{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),function(t){const e=t;if("boolean"===typeof e.dropShadow&&e.dropShadow){var r,n,h,u,c;const i=f.defaultDropShadow;t.dropShadow={alpha:null!==(r=e.dropShadowAlpha)&&void 0!==r?r:i.alpha,angle:null!==(n=e.dropShadowAngle)&&void 0!==n?n:i.angle,blur:null!==(h=e.dropShadowBlur)&&void 0!==h?h:i.blur,color:null!==(u=e.dropShadowColor)&&void 0!==u?u:i.color,distance:null!==(c=e.dropShadowDistance)&&void 0!==c?c:i.distance}}if(void 0!==e.strokeThickness){(0,a.t6)(a.lj,"strokeThickness is now a part of stroke");const r=e.stroke;let n={};if(s.Q.isColorLike(r))n.color=r;else if(r instanceof o._||r instanceof l.m)n.fill=r;else{if(!Object.hasOwnProperty.call(r,"color")&&!Object.hasOwnProperty.call(r,"fill"))throw new Error("Invalid stroke value.");n=r}t.stroke=(0,i.A)((0,i.A)({},n),{},{width:e.strokeThickness})}if(Array.isArray(e.fillGradientStops)){let r;(0,a.t6)(a.lj,"gradient fill is now a fill pattern: `new FillGradient(...)`"),null==t.fontSize?t.fontSize=f.defaultTextStyle.fontSize:r="string"===typeof t.fontSize?parseInt(t.fontSize,10):t.fontSize;const i=new o._(0,0,0,1.7*r),n=e.fillGradientStops.map((t=>s.Q.shared.setValue(t).toNumber()));n.forEach(((t,e)=>{const r=e/(n.length-1);i.addColorStop(r,t)})),t.fill={fill:i}}}(e);const r=(0,i.A)((0,i.A)({},t.defaultTextStyle),e);for(const t in r){this[t]=r[t]}this.update()}get align(){return this._align}set align(t){this._align=t,this.update()}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords=t,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow=null!==e&&"object"===typeof e?this._createProxy((0,i.A)((0,i.A)({},t.defaultDropShadow),e)):e?this._createProxy((0,i.A)({},t.defaultDropShadow)):null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this.update()}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize="string"===typeof t?parseInt(t,10):t,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t.toLowerCase(),this.update()}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t,this.update()}get leading(){return this._leading}set leading(t){this._leading=t,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing=t,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.update()}get padding(){return this._padding}set padding(t){this._padding=t,this.update()}get trim(){return this._trim}set trim(t){this._trim=t,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace=t,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap=t,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth=t,this.update()}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy((0,i.A)((0,i.A)({},h.T.defaultFillStyle),t),(()=>{this._fill=(0,u.w)((0,i.A)({},this._originalFill),h.T.defaultFillStyle)}))),this._fill=(0,u.w)(0===t?"black":t,h.T.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy((0,i.A)((0,i.A)({},h.T.defaultStrokeStyle),t),(()=>{this._stroke=(0,u.T)((0,i.A)({},this._originalStroke),h.T.defaultStrokeStyle)}))),this._stroke=(0,u.T)(t,h.T.defaultStrokeStyle),this.update())}_generateKey(){return this._styleKey=(0,c.V)(this),this._styleKey}update(){this._styleKey=null,this.emit("update",this)}reset(){const e=t.defaultTextStyle;for(const t in e)this[t]=e[t]}get styleKey(){return this._styleKey||this._generateKey()}clone(){return new t({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?(0,i.A)({},this._dropShadow):null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth})}destroy(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.removeAllListeners();if("boolean"===typeof t?t:null===t||void 0===t?void 0:t.texture){var e,r,i,n;const s="boolean"===typeof t?t:null===t||void 0===t?void 0:t.textureSource;null!==(e=this._fill)&&void 0!==e&&e.texture&&this._fill.texture.destroy(s),null!==(r=this._originalFill)&&void 0!==r&&r.texture&&this._originalFill.texture.destroy(s),null!==(i=this._stroke)&&void 0!==i&&i.texture&&this._stroke.texture.destroy(s),null!==(n=this._originalStroke)&&void 0!==n&&n.texture&&this._originalStroke.texture.destroy(s)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(t,r,i)=>(t[r]=i,null===e||void 0===e||e(r,i),this.update(),!0)})}_isFillStyle(t){return null!==(null!==t&&void 0!==t?t:null)&&!(s.Q.isColorLike(t)||t instanceof o._||t instanceof l.m)}};d.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5},d.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let f=d},37821:(t,e,r)=>{"use strict";r.d(e,{P:()=>o});var i=r(23144),n=r(91915);const s={willReadFrequently:!0},a=class t{static get experimentalLetterSpacingSupported(){let e=t._experimentalLetterSpacingSupported;if(void 0!==e){const r=i.e.get().getCanvasRenderingContext2D().prototype;e=t._experimentalLetterSpacingSupported="letterSpacing"in r||"textLetterSpacing"in r}return e}constructor(t,e,r,i,n,s,a,o,l){this.text=t,this.style=e,this.width=r,this.height=i,this.lines=n,this.lineWidths=s,this.lineHeight=a,this.maxLineWidth=o,this.fontProperties=l}static measureText(){var e;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:" ",i=arguments.length>1?arguments[1]:void 0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t._canvas,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.wordWrap;const o="".concat(r,":").concat(i.styleKey);if(t._measurementCache[o])return t._measurementCache[o];const l=(0,n.Z)(i),h=t.measureFont(l);0===h.fontSize&&(h.fontSize=i.fontSize,h.ascent=i.fontSize);const u=t.__context;u.font=l;const c=(a?t._wordWrap(r,i,s):r).split(/(?:\r\n|\r|\n)/),d=new Array(c.length);let f=0;for(let n=0;n<c.length;n++){const e=t._measureText(c[n],i.letterSpacing,u);d[n]=e,f=Math.max(f,e)}const p=(null===(e=i._stroke)||void 0===e?void 0:e.width)||0;let g=f+p;i.dropShadow&&(g+=i.dropShadow.distance);const m=i.lineHeight||h.fontSize;let x=Math.max(m,h.fontSize+p)+(c.length-1)*(m+i.leading);i.dropShadow&&(x+=i.dropShadow.distance);return new t(r,i,g,x,c,d,m+i.leading,f,h)}static _measureText(e,r,i){let n=!1;t.experimentalLetterSpacingSupported&&(t.experimentalLetterSpacing?(i.letterSpacing="".concat(r,"px"),i.textLetterSpacing="".concat(r,"px"),n=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));const s=i.measureText(e);let a=s.width;const o=-s.actualBoundingBoxLeft;let l=s.actualBoundingBoxRight-o;if(a>0)if(n)a-=r,l-=r;else{const i=(t.graphemeSegmenter(e).length-1)*r;a+=i,l+=i}return Math.max(a,l)}static _wordWrap(e,r){const i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:t._canvas).getContext("2d",s);let n=0,a="",o="";const l=Object.create(null),{letterSpacing:h,whiteSpace:u}=r,c=t._collapseSpaces(u),d=t._collapseNewlines(u);let f=!c;const p=r.wordWrapWidth+h,g=t._tokenize(e);for(let s=0;s<g.length;s++){let e=g[s];if(t._isNewline(e)){if(!d){o+=t._addLine(a),f=!c,a="",n=0;continue}e=" "}if(c){const r=t.isBreakingSpace(e),i=t.isBreakingSpace(a[a.length-1]);if(r&&i)continue}const u=t._getFromCache(e,h,l,i);if(u>p)if(""!==a&&(o+=t._addLine(a),a="",n=0),t.canBreakWords(e,r.breakWords)){const s=t.wordWrapSplit(e);for(let u=0;u<s.length;u++){let c=s[u],d=c,g=1;for(;s[u+g];){const i=s[u+g];if(t.canBreakChars(d,i,e,u,r.breakWords))break;c+=i,d=i,g++}u+=g-1;const m=t._getFromCache(c,h,l,i);m+n>p&&(o+=t._addLine(a),f=!1,a="",n=0),a+=c,n+=m}}else{a.length>0&&(o+=t._addLine(a),a="",n=0);const r=s===g.length-1;o+=t._addLine(e,!r),f=!1,a="",n=0}else u+n>p&&(f=!1,o+=t._addLine(a),a="",n=0),(a.length>0||!t.isBreakingSpace(e)||f)&&(a+=e,n+=u)}return o+=t._addLine(a,!1),o}static _addLine(e){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e=t._trimRight(e),e=r?"".concat(e,"\n"):e}static _getFromCache(e,r,i,n){let s=i[e];return"number"!==typeof s&&(s=t._measureText(e,r,n)+r,i[e]=s),s}static _collapseSpaces(t){return"normal"===t||"pre-line"===t}static _collapseNewlines(t){return"normal"===t}static _trimRight(e){if("string"!==typeof e)return"";for(let r=e.length-1;r>=0;r--){const i=e[r];if(!t.isBreakingSpace(i))break;e=e.slice(0,-1)}return e}static _isNewline(e){return"string"===typeof e&&t._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,r){return"string"===typeof e&&t._breakingSpaces.includes(e.charCodeAt(0))}static _tokenize(e){const r=[];let i="";if("string"!==typeof e)return r;for(let n=0;n<e.length;n++){const s=e[n],a=e[n+1];t.isBreakingSpace(s,a)||t._isNewline(s)?(""!==i&&(r.push(i),i=""),r.push(s)):i+=s}return""!==i&&r.push(i),r}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,i,n){return!0}static wordWrapSplit(e){return t.graphemeSegmenter(e)}static measureFont(e){if(t._fonts[e])return t._fonts[e];const r=t._context;r.font=e;const i=r.measureText(t.METRICS_STRING+t.BASELINE_SYMBOL),n={ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,fontSize:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent};return t._fonts[e]=n,n}static clearMetrics(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";e?delete t._fonts[e]:t._fonts={}}static get _canvas(){if(!t.__canvas){let r;try{const e=new OffscreenCanvas(0,0),n=e.getContext("2d",s);if(null!==n&&void 0!==n&&n.measureText)return t.__canvas=e,e;r=i.e.get().createCanvas()}catch(e){r=i.e.get().createCanvas()}r.width=r.height=10,t.__canvas=r}return t.__canvas}static get _context(){return t.__context||(t.__context=t._canvas.getContext("2d",s)),t.__context}};a.METRICS_STRING="|\xc9q\xc5",a.BASELINE_SYMBOL="M",a.BASELINE_MULTIPLIER=1.4,a.HEIGHT_MULTIPLIER=2,a.graphemeSegmenter=(t=>{if("function"===typeof(null===(t=Intl)||void 0===t?void 0:t.Segmenter)){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map((t=>t.segment))}return t=>[...t]})(),a.experimentalLetterSpacing=!1,a._fonts={},a._newlines=[10,13],a._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288],a._measurementCache={};let o=a},91915:(t,e,r)=>{"use strict";r.d(e,{Z:()=>n});const i=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function n(t){const e="number"===typeof t.fontSize?"".concat(t.fontSize,"px"):t.fontSize;let r=t.fontFamily;Array.isArray(t.fontFamily)||(r=t.fontFamily.split(","));for(let n=r.length-1;n>=0;n--){let t=r[n].trim();/([\"\'])[^\'\"]+\1/.test(t)||i.includes(t)||(t='"'.concat(t,'"')),r[n]=t}return"".concat(t.fontStyle," ").concat(t.fontVariant," ").concat(t.fontWeight," ").concat(e," ").concat(r.join(","))}},95435:(t,e,r)=>{"use strict";r.d(e,{r:()=>h});var i=r(75242),n=r(33596),s=r(7663),a=r(60279),o=r(34325),l=r(41201);function h(t,e){var r;if(t.texture===s.g.WHITE&&!t.fill)return i.Q.shared.setValue(t.color).setAlpha(null!==(r=t.alpha)&&void 0!==r?r:1).toHexa();if(!t.fill){const r=e.createPattern(t.texture.source.resource,"repeat"),i=t.matrix.copyTo(n.u.shared);return i.scale(t.texture.frame.width,t.texture.frame.height),r.setTransform(i),r}if(t.fill instanceof l.m){const r=t.fill,i=e.createPattern(r.texture.source.resource,"repeat"),s=r.transform.copyTo(n.u.shared);return s.scale(r.texture.frame.width,r.texture.frame.height),i.setTransform(s),i}if(t.fill instanceof o._){const r=t.fill;if("linear"===r.type){const t=e.createLinearGradient(r.x0,r.y0,r.x1,r.y1);return r.gradientStops.forEach((e=>{t.addColorStop(e.offset,i.Q.shared.setValue(e.color).toHex())})),t}}return(0,a.R)("FillStyle not recognised",t),"red"}},12394:(t,e,r)=>{"use strict";var i=r(91478),n=r(53693),s=r(69769),a=r(31669);class o{constructor(t){this._gpuText=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=t,this._renderer.runners.resolutionChange.add(this),this._renderer.renderableGC.addManagedHash(this,"_gpuText")}resolutionChange(){for(const t in this._gpuText){const e=this._gpuText[t];if(!e)continue;const r=e.batchableSprite.renderable;r._autoResolution&&(r._resolution=this._renderer.resolution,r.onViewUpdate())}}validateRenderable(t){const e=this._getGpuText(t),r=t._getKey();return e.currentKey!==r}addRenderable(t,e){const r=this._getGpuText(t).batchableSprite;t._didTextUpdate&&this._updateText(t),this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){const e=this._getGpuText(t).batchableSprite;t._didTextUpdate&&this._updateText(t),e._batcher.updateElement(e)}destroyRenderable(t){t.off("destroyed",this._destroyRenderableBound),this._destroyRenderableById(t.uid)}_destroyRenderableById(t){const e=this._gpuText[t];this._renderer.canvasText.decreaseReferenceCount(e.currentKey),s.Z.return(e.batchableSprite),this._gpuText[t]=null}_updateText(t){const e=t._getKey(),r=this._getGpuText(t),i=r.batchableSprite;r.currentKey!==e&&this._updateGpuText(t),t._didTextUpdate=!1;const s=t._style.padding;(0,n.y)(i.bounds,t._anchor,i.texture,s)}_updateGpuText(t){const e=this._getGpuText(t),r=e.batchableSprite;e.texture&&this._renderer.canvasText.decreaseReferenceCount(e.currentKey),e.texture=r.texture=this._renderer.canvasText.getManagedTexture(t),e.currentKey=t._getKey(),r.texture=e.texture}_getGpuText(t){return this._gpuText[t.uid]||this.initGpuText(t)}initGpuText(t){const e={texture:null,currentKey:"--",batchableSprite:s.Z.get(a.K)};return e.batchableSprite.renderable=t,e.batchableSprite.transform=t.groupTransform,e.batchableSprite.bounds={minX:0,maxX:1,minY:0,maxY:0},e.batchableSprite.roundPixels=this._renderer._roundPixels|t._roundPixels,this._gpuText[t.uid]=e,t._resolution=t._autoResolution?this._renderer.resolution:t.resolution,this._updateText(t),t.on("destroyed",this._destroyRenderableBound),e}destroy(){for(const t in this._gpuText)this._destroyRenderableById(t);this._gpuText=null,this._renderer=null}}o.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"text"};var l=r(75242),h=r(8186),u=r(59445),c=r(3202),d=r(44307);function f(t,e,r){for(let i=0,n=4*r*e;i<e;++i,n+=4)if(0!==t[n+3])return!1;return!0}function p(t,e,r,i,n){const s=4*e;for(let a=i,o=i*s+4*r;a<=n;++a,o+=s)if(0!==t[o+3])return!1;return!0}var g=r(14811),m=r(72100),x=r(74749),_=r(37821),y=r(91915),v=r(95435);class b{constructor(t){this._activeTextures={},this._renderer=t}getTextureSize(t,e,r){const i=_.P.measureText(t||" ",r);let n=Math.ceil(Math.ceil(Math.max(1,i.width)+2*r.padding)*e),s=Math.ceil(Math.ceil(Math.max(1,i.height)+2*r.padding)*e);return n=Math.ceil(n-1e-6),s=Math.ceil(s-1e-6),n=(0,h.U5)(n),s=(0,h.U5)(s),{width:n,height:s}}getTexture(t,e,r,i){"string"===typeof t&&((0,g.t6)("8.0.0","CanvasTextSystem.getTexture: Use object TextOptions instead of separate arguments"),t={text:t,style:r,resolution:e}),t.style instanceof m.x||(t.style=new m.x(t.style));const{texture:n,canvasAndContext:s}=this.createTextureAndCanvas(t);return this._renderer.texture.initSource(n._source),u.N.returnCanvasAndContext(s),n}createTextureAndCanvas(t){var e;const{text:r,style:i}=t,n=null!==(e=t.resolution)&&void 0!==e?e:this._renderer.resolution,s=_.P.measureText(r||" ",i),a=Math.ceil(Math.ceil(Math.max(1,s.width)+2*i.padding)*n),o=Math.ceil(Math.ceil(Math.max(1,s.height)+2*i.padding)*n),l=u.N.getOptimalCanvasAndContext(a,o),{canvas:h}=l;this.renderTextToCanvas(r,i,n,l);const c=(0,x.M)(h,a,o,n);if(i.trim){const t=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const{width:r,height:i}=t,n=t.getContext("2d",{willReadFrequently:!0});if(null===n)throw new TypeError("Failed to get canvas 2D context");const s=n.getImageData(0,0,r,i).data;let a=0,o=0,l=r-1,h=i-1;for(;o<i&&f(s,r,o);)++o;if(o===i)return d.M.EMPTY;for(;f(s,r,h);)--h;for(;p(s,r,a,o,h);)++a;for(;p(s,r,l,o,h);)--l;return++l,++h,new d.M(a/e,o/e,(l-a)/e,(h-o)/e)}(h,n);c.frame.copyFrom(t),c.updateUvs()}return{texture:c,canvasAndContext:l}}getManagedTexture(t){t._resolution=t._autoResolution?this._renderer.resolution:t.resolution;const e=t._getKey();if(this._activeTextures[e])return this._increaseReferenceCount(e),this._activeTextures[e].texture;const{texture:r,canvasAndContext:i}=this.createTextureAndCanvas(t);return this._activeTextures[e]={canvasAndContext:i,texture:r,usageCount:1},r}_increaseReferenceCount(t){this._activeTextures[t].usageCount++}decreaseReferenceCount(t){const e=this._activeTextures[t];if(e.usageCount--,0===e.usageCount){u.N.returnCanvasAndContext(e.canvasAndContext),c.W.returnTexture(e.texture);const r=e.texture.source;r.resource=null,r.uploadMethodId="unknown",r.alphaMode="no-premultiply-alpha",this._activeTextures[t]=null}}getReferenceCount(t){return this._activeTextures[t].usageCount}renderTextToCanvas(t,e,r,i){var n;const{canvas:s,context:a}=i,o=(0,y.Z)(e),h=_.P.measureText(t||" ",e),u=h.lines,c=h.lineHeight,d=h.lineWidths,f=h.maxLineWidth,p=h.fontProperties,g=s.height;if(a.resetTransform(),a.scale(r,r),a.textBaseline=e.textBaseline,null!==(n=e._stroke)&&void 0!==n&&n.width){const t=e._stroke;a.lineWidth=t.width,a.miterLimit=t.miterLimit,a.lineJoin=t.join,a.lineCap=t.cap}let m,x;a.font=o;const b=e.dropShadow?2:1;for(let _=0;_<b;++_){var S,w;const t=e.dropShadow&&0===_,n=t?Math.ceil(Math.max(1,g)+2*e.padding):0,s=n*r;if(t){a.fillStyle="black",a.strokeStyle="black";const t=e.dropShadow,i=t.color,n=t.alpha;a.shadowColor=l.Q.shared.setValue(i).setAlpha(n).toRgbaString();const o=t.blur*r,h=t.distance*r;a.shadowBlur=o,a.shadowOffsetX=Math.cos(t.angle)*h,a.shadowOffsetY=Math.sin(t.angle)*h+s}else{var T;a.fillStyle=e._fill?(0,v.r)(e._fill,a):null,null!==(T=e._stroke)&&void 0!==T&&T.width&&(a.strokeStyle=(0,v.r)(e._stroke,a)),a.shadowColor="black"}let o=(c-p.fontSize)/2;c-p.fontSize<0&&(o=0);const h=null!==(S=null===(w=e._stroke)||void 0===w?void 0:w.width)&&void 0!==S?S:0;for(let r=0;r<u.length;r++){var M;m=h/2,x=h/2+r*c+p.ascent+o,"right"===e.align?m+=f-d[r]:"center"===e.align&&(m+=(f-d[r])/2),null!==(M=e._stroke)&&void 0!==M&&M.width&&this._drawLetterSpacing(u[r],e,i,m+e.padding,x+e.padding-n,!0),void 0!==e._fill&&this._drawLetterSpacing(u[r],e,i,m+e.padding,x+e.padding-n)}}}_drawLetterSpacing(t,e,r,i,n){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const{context:a}=r,o=e.letterSpacing;let l=!1;if(_.P.experimentalLetterSpacingSupported&&(_.P.experimentalLetterSpacing?(a.letterSpacing="".concat(o,"px"),a.textLetterSpacing="".concat(o,"px"),l=!0):(a.letterSpacing="0px",a.textLetterSpacing="0px")),0===o||l)return void(s?a.strokeText(t,i,n):a.fillText(t,i,n));let h=i;const u=_.P.graphemeSegmenter(t);let c=a.measureText(t).width,d=0;for(let f=0;f<u.length;++f){const t=u[f];s?a.strokeText(t,h,n):a.fillText(t,h,n);let e="";for(let r=f+1;r<u.length;++r)e+=u[r];d=a.measureText(e).width,h+=c-d+o,c=d}}destroy(){this._activeTextures=null}}b.extension={type:[i.Ag.WebGLSystem,i.Ag.WebGPUSystem,i.Ag.CanvasSystem],name:"canvasText"},i.XO.add(b),i.XO.add(o)},33686:(t,e,r)=>{"use strict";r.d(e,{V:()=>s});var i=r(75242);const n=["align","breakWords","cssOverrides","fontVariant","fontWeight","leading","letterSpacing","lineHeight","padding","textBaseline","trim","whiteSpace","wordWrap","wordWrapWidth","fontFamily","fontStyle","fontSize"];function s(t){const e=[];let r=0;for(let i=0;i<n.length;i++){const s="_".concat(n[i]);e[r++]=t[s]}return r=a(t._fill,e,r),r=function(t,e,r){return t?(r=a(t,e,r),e[r++]=t.width,e[r++]=t.alignment,e[r++]=t.cap,e[r++]=t.join,e[r++]=t.miterLimit,r):r}(t._stroke,e,r),r=function(t,e,r){return t?(e[r++]=t.alpha,e[r++]=t.angle,e[r++]=t.blur,e[r++]=t.distance,e[r++]=i.Q.shared.setValue(t.color).toNumber(),r):r}(t.dropShadow,e,r),e.join("-")}function a(t,e,r){var i;return t?(e[r++]=t.color,e[r++]=t.alpha,e[r++]=null===(i=t.fill)||void 0===i?void 0:i.styleKey,r):r}},74749:(t,e,r)=>{"use strict";r.d(e,{M:()=>s});var i=r(3202);const n=new(r(66373).c);function s(t,e,r,s){const a=n;a.minX=0,a.minY=0,a.maxX=t.width/s|0,a.maxY=t.height/s|0;const o=i.W.getOptimalTexture(a.width,a.height,s,!1);return o.source.uploadMethodId="image",o.source.resource=t,o.source.alphaMode="premultiply-alpha-on-upload",o.frame.width=e/s,o.frame.height=r/s,o.source.emit("update",o.source),o.updateUvs(),o}},81013:(t,e,r)=>{"use strict";r.d(e,{u:()=>i});class i{constructor(t){"number"===typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(t){return this["".concat(t,"View")]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error("".concat(t," isn't a valid view type"))}}}}}]);
//# sourceMappingURL=4.be5f9ae2.chunk.js.map